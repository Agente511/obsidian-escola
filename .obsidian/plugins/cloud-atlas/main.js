/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Vc=Object.create;var In=Object.defineProperty;var Xc=Object.getOwnPropertyDescriptor;var Kc=Object.getOwnPropertyNames;var Jc=Object.getPrototypeOf,Gc=Object.prototype.hasOwnProperty;var k=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Zi=(n,e)=>{for(var t in e)In(n,t,{get:e[t],enumerable:!0})},eo=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Kc(e))!Gc.call(n,s)&&s!==t&&In(n,s,{get:()=>e[s],enumerable:!(r=Xc(e,s))||r.enumerable});return n};var Lr=(n,e,t)=>(t=n!=null?Vc(Jc(n)):{},eo(e||!n||!n.__esModule?In(t,"default",{value:n,enumerable:!0}):t,n)),Yc=n=>eo(In({},"__esModule",{value:!0}),n);var so=k((Ep,ro)=>{var no=Buffer.from("D0CF11E0A1B11AE1","hex"),Br=class{constructor(){}load(e){for(let t=0;t<no.length;t++)if(no[t]!=e[t])return!1;this.secSize=1<<e.readInt16LE(30),this.shortSecSize=1<<e.readInt16LE(32),this.SATSize=e.readInt32LE(44),this.dirSecId=e.readInt32LE(48),this.shortStreamMax=e.readInt32LE(56),this.SSATSecId=e.readInt32LE(60),this.SSATSize=e.readInt32LE(64),this.MSATSecId=e.readInt32LE(68),this.MSATSize=e.readInt32LE(72),this.partialMSAT=new Array(109);for(let t=0;t<109;t++)this.partialMSAT[t]=e.readInt32LE(76+t*4);return!0}};ro.exports=Br});var oo=k((Ap,io)=>{var $r=class{constructor(e){this._doc=e}load(e){let t=this._doc,r=t._header;return this._table=new Array(e.length*(r.secSize/4)),t._readSectors(e).then(s=>{for(let i=0;i<s.length/4;i++)this._table[i]=s.readInt32LE(i*4)})}getSecIdChain(e){let t=e,r=[];for(;t>-1;){r.push(t);let s=t;if(t=this._table[t],t===s)break}return r}};io.exports=$r});var lo=k((Sp,ao)=>{var jr=class{constructor(e){this._doc=e}load(e){return this._doc._readSectors(e).then(r=>{let s=r.length/128;this._entries=new Array(s);for(let i=0;i<s;i++){let o=i*128,a=Math.max(r.readInt16LE(64+o)-1,0),l={};l.name=r.toString("utf16le",0+o,a+o),l.type=r.readInt8(66+o),l.nodeColor=r.readInt8(67+o),l.left=r.readInt32LE(68+o),l.right=r.readInt32LE(72+o),l.storageDirId=r.readInt32LE(76+o),l.secId=r.readInt32LE(116+o),l.size=r.readInt32LE(120+o),this._entries[i]=l}this.root=this._entries.find(i=>i.type===5),this._buildHierarchy(this.root)})}_buildHierarchy(e){let t=this._getChildIds(e);e.storages={},e.streams={};for(let r of t){let s=this._entries[r],i=s.name;s.type===1&&(e.storages[i]=s),s.type===2&&(e.streams[i]=s)}for(let r in e.storages)this._buildHierarchy(e.storages[r])}_getChildIds(e){let t=[],r=s=>{s.left!==-1&&(t.push(s.left),r(this._entries[s.left])),s.right!==-1&&(t.push(s.right),r(this._entries[s.right]))};if(e.storageDirId>-1){t.push(e.storageDirId);let s=this._entries[e.storageDirId];r(s)}return t}};ao.exports=jr});var uo=k((Pp,co)=>{var{Readable:tu}=require("stream"),zr=class extends tu{constructor(e,t){super(),this._doc=e,this._streamEntry=t,this.initialize()}initialize(){if(this._index=0,this._done=!0,!this._streamEntry)return;let e=this._doc;this._bytes=this._streamEntry.size,this._allocationTable=e._SAT,this._shortStream=!1,this._bytes<e._header.shortStreamMax&&(this._shortStream=!0,this._allocationTable=e._SSAT),this._secIds=this._allocationTable.getSecIdChain(this._streamEntry.secId),this._done=!1}_readSector(e){return this._shortStream?this._doc._readShortSector(e):this._doc._readSector(e)}_read(){return this._done?this.push(null):this._index>=this._secIds.length?(this._done=!0,this.push(null)):this._readSector(this._secIds[this._index]).then(e=>{this._bytes-e.length<0&&(e=e.slice(0,this._bytes)),this._bytes-=e.length,this._index++,this.push(e)})}};co.exports=zr});var ho=k((Rp,fo)=>{var nu=uo(),qr=class n{constructor(e,t){this._doc=e,this._dirEntry=t}storage(e){return new n(this._doc,this._dirEntry.storages[e])}stream(e){return new nu(this._doc,this._dirEntry.streams[e])}};fo.exports=qr});var go=k((Tp,mo)=>{var ru=so(),po=oo(),su=lo(),iu=ho(),Hr=class{constructor(e){this._reader=e,this._skipBytes=0}read(){return Promise.resolve().then(()=>this._readHeader()).then(()=>this._readMSAT()).then(()=>this._readSAT()).then(()=>this._readSSAT()).then(()=>this._readDirectoryTree()).then(()=>{if(this._skipBytes!=0)return this._readCustomHeader()}).then(()=>this)}_readCustomHeader(){let e=Buffer.alloc(this._skipBytes);return this._reader.read(e,0,this._skipBytes,0).then(t=>{this._customHeaderCallback(t)})}_readHeader(){let e=Buffer.alloc(512);return this._reader.read(e,0,512,0+this._skipBytes).then(t=>{if(!(this._header=new ru).load(t))throw new Error("Not a valid compound document")})}_readMSAT(){let e=this._header;if(this._MSAT=e.partialMSAT.slice(0),this._MSAT.length=e.SATSize,e.SATSize<=109||e.MSATSize==0)return Promise.resolve();let t=109,r=0,s=(i,o,a)=>i>=e.MSATSize?Promise.resolve():this._readSector(a).then(l=>{let c;for(c=0;c<e.secSize-4&&!(o>=e.SATSize);c+=4)this._MSAT[o]=l.readInt32LE(c),o++;return a=l.readInt32LE(e.secSize-4),s(i+1,o,a)});return s(r,t,e.MSATSecId)}_readSector(e){return this._readSectors([e])}_readSectors(e){let t=this._header,r=Buffer.alloc(e.length*t.secSize),s=i=>{if(i>=e.length)return Promise.resolve(r);let o=i*t.secSize,a=this._getFileOffsetForSec(e[i]);return this._reader.read(r,o,t.secSize,a).then(()=>s(i+1))};return s(0)}_readShortSector(e){return this._readShortSectors([e])}_readShortSectors(e){let t=this._header,r=Buffer.alloc(e.length*t.shortSecSize),s=i=>{if(i>=e.length)return Promise.resolve(r);let o=i*t.shortSecSize,a=this._getFileOffsetForShortSec(e[i]);return this._reader.read(r,o,t.shortSecSize,a).then(()=>s(i+1))};return s(0)}_readSAT(){return this._SAT=new po(this),this._SAT.load(this._MSAT)}_readSSAT(){let e=this._header,t=this._SAT.getSecIdChain(e.SSATSecId);return t.length!=e.SSATSize?Promise.reject(new Error("Invalid Short Sector Allocation Table")):(this._SSAT=new po(this),this._SSAT.load(t))}_readDirectoryTree(){let e=this._header;this._directoryTree=new su(this);let t=this._SAT.getSecIdChain(e.dirSecId);return this._directoryTree.load(t).then(()=>{let r=this._directoryTree.root;this._rootStorage=new iu(this,r),this._shortStreamSecIds=this._SAT.getSecIdChain(r.secId)})}_getFileOffsetForSec(e){let t=this._header.secSize;return this._skipBytes+(e+1)*t}_getFileOffsetForShortSec(e){let t=this._header.shortSecSize,r=e*t,s=this._header.secSize,i=Math.floor(r/s),o=r%s,a=this._shortStreamSecIds[i];return this._getFileOffsetForSec(a)+o}storage(e){return this._rootStorage.storage(e)}stream(e){return this._rootStorage.stream(e)}};mo.exports=Hr});var Wr=k((Ip,On)=>{var le=[];le[2]="\0";le[5]="\0";le[7]="	";le[8]="\0";le[10]=`
`;le[11]=`
`;le[12]=`
`;le[13]=`
`;le[30]="\u2011";var T=[];T[130]="\u201A";T[131]="\u0192";T[132]="\u201E";T[133]="\u2026";T[134]="\u2020";T[135]="\u2021";T[136]="\u02C6";T[137]="\u2030";T[138]="\u0160";T[139]="\u2039";T[140]="\u0152";T[142]="\u017D";T[145]="\u2018";T[146]="\u2019";T[147]="\u201C";T[148]="\u201D";T[149]="\u2022";T[150]="\u2013";T[151]="\u2014";T[152]="\u02DC";T[153]="\u2122";T[154]="\u0161";T[155]="\u203A";T[156]="\u0153";T[158]="\u017E";T[159]="\u0178";On.exports.binaryToUnicode=n=>n.replace(/([\x80-\x9f])/g,e=>T[e.charCodeAt(0)]);On.exports.clean=n=>{n=n.replace(/([\x02\x05\x07\x08\x0a\x0b\x0c\x0d\x1f])/g,t=>le[t.charCodeAt(0)]);let e=!0;for(;e;)e=!1,n=n.replace(/(?:\x13[^\x13\x14\x15]*\x14?([^\x13\x14\x15]*)\x15)/g,(t,r)=>(e=!0,r));return n.replace(/[\x00-\x07]/g,"")};var ce=[];ce[8194]=" ";ce[8195]=" ";ce[8210]="-";ce[8211]="-";ce[8212]="-";ce[8216]="'";ce[8217]="'";ce[8220]='"';ce[8221]='"';On.exports.filter=n=>n.replace(/[\u2002\u2003\u2012\u2013\u2014\u2018\u2019\u201c\u201d]/g,e=>ce[e.charCodeAt(0)])});var Xr=k((Fp,xo)=>{var{filter:Ye}=Wr(),Vr=class{constructor(){this._body="",this._footnotes="",this._endnotes="",this._headers="",this._footers="",this._annotations="",this._textboxes="",this._headerTextboxes=""}getBody(e){e=e||{};let t=this._body;return e.filterUnicode==!1?t:Ye(t)}getFootnotes(e){e=e||{};let t=this._footnotes;return e.filterUnicode==!1?t:Ye(t)}getEndnotes(e){e=e||{};let t=this._endnotes;return e.filterUnicode==!1?t:Ye(t)}getHeaders(e){e=e||{};let t=this._headers+(e.includeFooters==!1?"":this._footers);return e.filterUnicode==!1?t:Ye(t)}getFooters(e){e=e||{};let t=this._footers;return e.filterUnicode==!1?t:Ye(t)}getAnnotations(e){e=e||{};let t=this._annotations;return e.filterUnicode==!1?t:Ye(t)}getTextboxes(e){e=e||{};let t=[];e.includeBody!=!1&&t.push(this._textboxes),e.includeHeadersAndFooters!=!1&&t.push(this._headerTextboxes);let r=t.join(`
`);return e.filterUnicode==!1?r:Ye(r)}};xo.exports=Vr});var Eo=k((Op,vo)=>{var ou=go(),au=Xr(),{binaryToUnicode:lu,clean:Ie}=Wr(),cu=0,Nn=(n,e)=>{for(let t=0;t<n.length;t++){let r=n[t];if(e<=r.endCp)return t}},yo=(n,e)=>{for(let t=0;t<n.length;t++){let r=n[t];if(e<=r.endFilePos)return t}};function Qe(n,e,t){let r=Nn(n,e),s=Nn(n,t),i=[];for(let o=r,a=s;o<=a;o++){let l=n[o],c=o===r?e-l.startCp:0,u=o===s?t-l.startCp:l.endCp;i.push(l.text.substring(c,u))}return i.join("")}function uu(n,e,t,r){let s=n.startCp,i=s+n.length,o=n.text;e<s&&(e=s),t>i&&(t=i);let a=(e==s?"":o.slice(0,e-s))+"".padStart(t-e,r)+(t==i?"":o.slice(t-i));n.text=a}function du(n,e,t,r){let s=n.startFilePos,i=s+n.size,o=n.text;e<s&&(e=s),t>i&&(t=i);let a=(e==s?"":o.slice(0,(e-s)/n.bpc))+"".padStart((t-e)/n.bpc,r)+(t==i?"":o.slice((t-i)/n.bpc));n.text=a}function _o(n,e,t,r){let s=Nn(n,e),i=Nn(n,t);for(let o=s,a=i;o<=a;o++){let l=n[o];uu(l,e,t,r)}}function Co(n,e,t,r){let s=yo(n,e),i=yo(n,t);for(let o=s,a=i;o<=a;o++){let l=n[o];du(l,e,t,r)}}function wo(n,e,t){Co(n,e,t,"\0")}var bo=(n,e,t)=>{for(;e<n.length-1;){let r=n.readUInt16LE(e),s=r&31,i=r>>9&1,o=r>>10&7,a=r>>13&7;if(e+=2,t(n,e,r,s,i,o,a),a===0){e+=1;continue}else if(a===1){e+=1;continue}else if(a===2){e+=2;continue}else if(a===3){e+=4;continue}else if(a===4||a===5){e+=2;continue}else if(a===6){e+=n.readUInt8(e)+1;continue}else if(a===7){e+=3;continue}else throw new Error("Unparsed sprm")}},Kr=class{constructor(){this._pieces=[],this._bookmarks={},this._boundaries={},this._taggedHeaders=[]}extract(e){let t=new ou(e);return t.read().then(()=>this.documentStream(t,"WordDocument").then(r=>this.streamBuffer(r)).then(r=>this.extractWordDocument(t,r)))}buildDocument(){let e=new au,t=this._pieces,r=0;return e._body=Ie(Qe(t,r,r+this._boundaries.ccpText)),r+=this._boundaries.ccpText,this._boundaries.ccpFtn&&(e._footnotes=Ie(Qe(t,r,r+this._boundaries.ccpFtn-1)),r+=this._boundaries.ccpFtn),this._boundaries.ccpHdd&&(e._headers=Ie(this._taggedHeaders.filter(s=>s.type==="headers").map(s=>s.text).join("")),e._footers=Ie(this._taggedHeaders.filter(s=>s.type==="footers").map(s=>s.text).join("")),r+=this._boundaries.ccpHdd),this._boundaries.ccpAtn&&(e._annotations=Ie(Qe(t,r,r+this._boundaries.ccpAtn-1)),r+=this._boundaries.ccpAtn),this._boundaries.ccpEdn&&(e._endnotes=Ie(Qe(t,r,r+this._boundaries.ccpEdn-1)),r+=this._boundaries.ccpEdn),this._boundaries.ccpTxbx&&(e._textboxes=Ie(Qe(t,r,r+this._boundaries.ccpTxbx-1)),r+=this._boundaries.ccpTxbx),this._boundaries.ccpHdrTxbx&&(e._headerTextboxes=Ie(Qe(t,r,r+this._boundaries.ccpHdrTxbx-1)),r+=this._boundaries.ccpHdrTxbx),e}extractWordDocument(e,t){let r=t.readUInt16LE(0);if(r!==42476)return Promise.reject(new Error(`This does not seem to be a Word document: Invalid magic number: ${r.toString(16)}`));let i=t.readUInt16LE(10)&512?"1Table":"0Table";return this.documentStream(e,i).then(o=>this.streamBuffer(o)).then(o=>(this._boundaries.fcMin=t.readUInt32LE(24),this._boundaries.ccpText=t.readUInt32LE(76),this._boundaries.ccpFtn=t.readUInt32LE(80),this._boundaries.ccpHdd=t.readUInt32LE(84),this._boundaries.ccpAtn=t.readUInt32LE(92),this._boundaries.ccpEdn=t.readUInt32LE(96),this._boundaries.ccpTxbx=t.readUInt32LE(100),this._boundaries.ccpHdrTxbx=t.readUInt32LE(104),this.writeBookmarks(t,o),this.writePieces(t,o),this.writeCharacterProperties(t,o),this.writeParagraphProperties(t,o),this.normalizeHeaders(t,o),this.buildDocument()))}documentStream(e,t){return Promise.resolve(e.stream(t))}streamBuffer(e){return new Promise((t,r)=>{let s=[];return e.on("data",i=>s.push(i)),e.on("error",i=>r(i)),e.on("end",()=>t(Buffer.concat(s))),e})}writeFields(e,t,r){let s=e.readInt32LE(282),i=e.readUInt32LE(286);if(i==0)return;let o=(i-4)/6,a=(o+1)*4,l=t.slice(s,s+i);for(let c=0;c<o;c++){let u=l.readUInt32LE(c*4),d=l.readUInt16LE(a+c*2),f=d&255,p=d>>8;f&31}}writeBookmarks(e,t){let r=e.readUInt32LE(322),s=e.readUInt32LE(326),i=e.readUInt32LE(330),o=e.readUInt32LE(334),a=e.readUInt32LE(338),l=e.readUInt32LE(342);if(s===0)return;let c=t.slice(r,r+s),u=t.slice(i,i+o),d=t.slice(a,a+l),f=c.readUInt16LE(0),p=c.readUInt16LE(2),h=c.readUInt16LE(4);if(f!==65535)throw new Error("Internal error: unexpected single-byte bookmark data");let m=6,x=0;for(;m<s;){let y=c.readUInt16LE(m);y=y*2;let g=c.slice(m+2,m+2+y),_=u.readUInt32LE(x*4),b=d.readUInt32LE(x*4);this._bookmarks[g]={start:_,end:b},m=m+y+2}}writePieces(e,t){let r,s=e.readUInt32LE(418);for(;r=t.readUInt8(s),r===1;){s=s+1;let c=t.readUInt16LE(s);s=s+2+c}if(r=t.readUInt8(s),s=s+1,r!==2)throw new Error("Internal error: ccorrupted Word file");let i=t.readUInt32LE(s);s=s+4;let o=(i-4)/12,a=0,l=0;for(let c=0,u=o-1;c<=u;c++){let d=s+(o+1)*4+c*8+2,f=t.readUInt32LE(d),p=!1;f&1073741824?(f=f&-1073741825,f=Math.floor(f/2)):p=!0;let h=t.readUInt32LE(s+c*4),m=t.readUInt32LE(s+(c+1)*4),x=m-h,y={startCp:a,startStream:l,totLength:x,startFilePos:f,unicode:p,bpc:p?2:1};y.size=y.bpc*(m-h);let g=e.slice(f,f+y.size);p?y.text=g.toString("ucs2"):y.text=lu(g.toString("binary")),y.length=y.text.length,y.endCp=y.startCp+y.length,y.endStream=y.startStream+y.size,y.endFilePos=y.startFilePos+y.size,a=y.endCp,l=y.endStream,this._pieces.push(y)}}normalizeHeaders(e,t){let r=this._pieces,s=e.readUInt32LE(242),i=e.readUInt32LE(246);if(i<8)return;let o=this._boundaries.ccpText+this._boundaries.ccpFtn,a=this._boundaries.ccpHdd,l=t.slice(s,s+i),c=i/4,u=o+l.readUInt32LE(0);for(let d=1;d<c;d++){let f=o+l.readUInt32LE(d*4);f>o+a&&(f=o+a);let p=Qe(r,u,f),h=d-1;[0,1,2].includes(h)?this._taggedHeaders.push({type:"footnoteSeparators",text:p}):[3,4,5].includes(h)?this._taggedHeaders.push({type:"endSeparators",text:p}):[0,1,4].includes(h%6)?this._taggedHeaders.push({type:"headers",text:p}):[2,3,5].includes(h%6)&&this._taggedHeaders.push({type:"footers",text:p}),/[^\r\n\u0002-\u0008]/.test(p)?_o(r,f-1,f,"\0"):_o(r,u,f,"\0"),u=f}}writeParagraphProperties(e,t){let r=this._pieces,s=e.readUInt32LE(258),i=e.readUInt32LE(262),o=(i-4)/8,a=(o+1)*4,l=t.slice(s,s+i);for(let c=0;c<o;c++){let u=l.readUInt32LE(c*4),d=l.readUInt32LE(a+c*4),f=e.slice(d*512,(d+1)*512),p=f.readUInt8(511);for(let h=0;h<p;h++){let m=f.readUInt32LE(h*4),x=f.readUInt32LE((h+1)*4),y=(p+1)*4+h*13,g=f.readUInt8(y)*2,_=f.readUInt8(g),b=null;if(_!==0)b=f.slice(g+1,g+1+2*_-1);else{let P=f.readUInt8(g+1);b=f.slice(g+2,g+2+2*P)}let I=b.readUInt16LE(0);bo(b,2,(P,j,V,w,E,A,D)=>{V===9239&&Co(r,m,x,`
`)})}}}writeCharacterProperties(e,t){let r=this._pieces,s=e.readUInt32LE(250),i=e.readUInt32LE(254),o=(i-4)/8,a=(o+1)*4,l=t.slice(s,s+i),c=null;for(let u=0;u<o;u++){let d=l.readUInt32LE(u*4),f=l.readUInt32LE(a+u*4),p=e.slice(f*512,(f+1)*512),h=p.readUInt8(511);for(let m=0;m<h;m++){let x=p.readUInt32LE(m*4),y=p.readUInt32LE((m+1)*4),g=p.readUInt8((h+1)*4+m);if(g==0)continue;let _=g*2,b=p.readUInt8(_),I=p.slice(_+1,_+1+b);bo(I,0,(P,j,V,w)=>{if(w===cu){if((P[j]&1)!=1)return;c===x?wo(r,c,y):wo(r,x,y),c=y}})}}}};vo.exports=Kr});var So=k(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.CHAR=`	
\r -\uD7FF\uE000-\uFFFD\u{10000}-\u{10FFFF}`;F.S=` 	\r
`;F.NAME_START_CHAR=":A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u{10000}-\u{EFFFF}";F.NAME_CHAR="-"+F.NAME_START_CHAR+".0-9\xB7\u0300-\u036F\u203F-\u2040";F.CHAR_RE=new RegExp("^["+F.CHAR+"]$","u");F.S_RE=new RegExp("^["+F.S+"]+$","u");F.NAME_START_CHAR_RE=new RegExp("^["+F.NAME_START_CHAR+"]$","u");F.NAME_CHAR_RE=new RegExp("^["+F.NAME_CHAR+"]$","u");F.NAME_RE=new RegExp("^["+F.NAME_START_CHAR+"]["+F.NAME_CHAR+"]*$","u");F.NMTOKEN_RE=new RegExp("^["+F.NAME_CHAR+"]+$","u");var Jr=9,Gr=10,Yr=13,Qr=32;F.S_LIST=[Qr,Gr,Yr,Jr];function fu(n){return n>=Qr&&n<=55295||n===Gr||n===Yr||n===Jr||n>=57344&&n<=65533||n>=65536&&n<=1114111}F.isChar=fu;function hu(n){return n===Qr||n===Gr||n===Yr||n===Jr}F.isS=hu;function Ao(n){return n>=65&&n<=90||n>=97&&n<=122||n===58||n===95||n===8204||n===8205||n>=192&&n<=214||n>=216&&n<=246||n>=248&&n<=767||n>=880&&n<=893||n>=895&&n<=8191||n>=8304&&n<=8591||n>=11264&&n<=12271||n>=12289&&n<=55295||n>=63744&&n<=64975||n>=65008&&n<=65533||n>=65536&&n<=983039}F.isNameStartChar=Ao;function pu(n){return Ao(n)||n>=48&&n<=57||n===45||n===46||n===183||n>=768&&n<=879||n>=8255&&n<=8256}F.isNameChar=pu});var Oo=k(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.CHAR="-\uD7FF\uE000-\uFFFD\u{10000}-\u{10FFFF}";R.RESTRICTED_CHAR="-\b\v\f-\x7F-\x84\x86-\x9F";R.S=` 	\r
`;R.NAME_START_CHAR=":A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u{10000}-\u{EFFFF}";R.NAME_CHAR="-"+R.NAME_START_CHAR+".0-9\xB7\u0300-\u036F\u203F-\u2040";R.CHAR_RE=new RegExp("^["+R.CHAR+"]$","u");R.RESTRICTED_CHAR_RE=new RegExp("^["+R.RESTRICTED_CHAR+"]$","u");R.S_RE=new RegExp("^["+R.S+"]+$","u");R.NAME_START_CHAR_RE=new RegExp("^["+R.NAME_START_CHAR+"]$","u");R.NAME_CHAR_RE=new RegExp("^["+R.NAME_CHAR+"]$","u");R.NAME_RE=new RegExp("^["+R.NAME_START_CHAR+"]["+R.NAME_CHAR+"]*$","u");R.NMTOKEN_RE=new RegExp("^["+R.NAME_CHAR+"]+$","u");var Po=9,Ro=10,To=13,Io=32;R.S_LIST=[Io,Ro,To,Po];function mu(n){return n>=1&&n<=55295||n>=57344&&n<=65533||n>=65536&&n<=1114111}R.isChar=mu;function gu(n){return n>=1&&n<=8||n===11||n===12||n>=14&&n<=31||n>=127&&n<=132||n>=134&&n<=159}R.isRestrictedChar=gu;function xu(n){return n===9||n===10||n===13||n>31&&n<127||n===133||n>159&&n<=55295||n>=57344&&n<=65533||n>=65536&&n<=1114111}R.isCharAndNotRestricted=xu;function yu(n){return n===Io||n===Ro||n===To||n===Po}R.isS=yu;function Fo(n){return n>=65&&n<=90||n>=97&&n<=122||n===58||n===95||n===8204||n===8205||n>=192&&n<=214||n>=216&&n<=246||n>=248&&n<=767||n>=880&&n<=893||n>=895&&n<=8191||n>=8304&&n<=8591||n>=11264&&n<=12271||n>=12289&&n<=55295||n>=63744&&n<=64975||n>=65008&&n<=65533||n>=65536&&n<=983039}R.isNameStartChar=Fo;function _u(n){return Fo(n)||n>=48&&n<=57||n===45||n===46||n===183||n>=768&&n<=879||n>=8255&&n<=8256}R.isNameChar=_u});var Do=k(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.NC_NAME_START_CHAR="A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u{10000}-\u{EFFFF}";Q.NC_NAME_CHAR="-"+Q.NC_NAME_START_CHAR+".0-9\xB7\u0300-\u036F\u203F-\u2040";Q.NC_NAME_START_CHAR_RE=new RegExp("^["+Q.NC_NAME_START_CHAR+"]$","u");Q.NC_NAME_CHAR_RE=new RegExp("^["+Q.NC_NAME_CHAR+"]$","u");Q.NC_NAME_RE=new RegExp("^["+Q.NC_NAME_START_CHAR+"]["+Q.NC_NAME_CHAR+"]*$","u");function No(n){return n>=65&&n<=90||n===95||n>=97&&n<=122||n>=192&&n<=214||n>=216&&n<=246||n>=248&&n<=767||n>=880&&n<=893||n>=895&&n<=8191||n>=8204&&n<=8205||n>=8304&&n<=8591||n>=11264&&n<=12271||n>=12289&&n<=55295||n>=63744&&n<=64975||n>=65008&&n<=65533||n>=65536&&n<=983039}Q.isNCNameStartChar=No;function wu(n){return No(n)||n===45||n===46||n>=48&&n<=57||n===183||n>=768&&n<=879||n>=8255&&n<=8256}Q.isNCNameChar=wu});var ea=k($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});var Ot=So(),bu=Oo(),fs=Do(),Z=Ot.isS,Cu=Ot.isChar,sn=Ot.isNameStartChar,ko=Ot.isNameChar,Jo=Ot.S_LIST,vu=Ot.NAME_RE,Eu=bu.isChar,Au=fs.isNCNameStartChar,Su=fs.isNCNameChar,Pu=fs.NC_NAME_RE,Bn="http://www.w3.org/XML/1998/namespace",Ft="http://www.w3.org/2000/xmlns/",Ru={__proto__:null,xml:Bn,xmlns:Ft},Tu={__proto__:null,amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},O=-1,ue=-2,Lo=0,Iu=1,Zr=2,Fu=3,Rt=4,Ou=5,Nu=6,Du=7,es=8,ku=9,Lu=10,Mu=11,Uu=12,Y=13,Dn=14,ts=15,Bu=16,ns=17,$u=18,ju=19,rs=20,zu=21,qu=22,Hu=23,Mo=24,ss=25,kn=26,Uo=27,Wu=28,Vu=29,Bo=30,Xu=31,Ku=32,Ze=33,Ju=34,is=35,on=36,os=37,Gu=38,$o=39,jo=40,Yu=41,zo=42,Qu=43,Zu=44,as=9,se=10,ls=13,qo=32,Ho=33,Go=34,an=38,Yo=39,Ln=45,Mn=47,ed=59,Fe=60,Tt=61,z=62,K=63,Qo=91,It=93,Wo=133,Vo=8232,Un=n=>n===Go||n===Yo,Zo=[Go,Yo],td=[...Zo,Qo,z],nd=[...Zo,Fe,It],rd=[Tt,K,...Jo],sd=[...Jo,z,an,Fe];function us(n,e,t){switch(e){case"xml":t!==Bn&&n.fail(`xml prefix must be bound to ${Bn}.`);break;case"xmlns":t!==Ft&&n.fail(`xmlns prefix must be bound to ${Ft}.`);break;default:}switch(t){case Ft:n.fail(e===""?`the default namespace may not be set to ${t}.`:`may not assign a prefix (even "xmlns") to the URI ${Ft}.`);break;case Bn:switch(e){case"xml":break;case"":n.fail(`the default namespace may not be set to ${t}.`);break;default:n.fail("may not assign the xml namespace to another prefix.")}break;default:}}function id(n,e){for(let t of Object.keys(e))us(n,t,e[t])}var od=n=>Pu.test(n),ad=n=>vu.test(n),et=0,Xo=1,cs=2;$n.EVENTS=["xmldecl","text","processinginstruction","doctype","comment","opentagstart","attribute","opentag","closetag","cdata","error","end","ready"];var Ko={xmldecl:"xmldeclHandler",text:"textHandler",processinginstruction:"piHandler",doctype:"doctypeHandler",comment:"commentHandler",opentagstart:"openTagStartHandler",attribute:"attributeHandler",opentag:"openTagHandler",closetag:"closeTagHandler",cdata:"cdataHandler",error:"errorHandler",end:"endHandler",ready:"readyHandler"},ds=class{constructor(e){this.opt=e!=null?e:{},this.fragmentOpt=!!this.opt.fragment;let t=this.xmlnsOpt=!!this.opt.xmlns;if(this.trackPosition=this.opt.position!==!1,this.fileName=this.opt.fileName,t){this.nameStartCheck=Au,this.nameCheck=Su,this.isName=od,this.processAttribs=this.processAttribsNS,this.pushAttrib=this.pushAttribNS,this.ns=Object.assign({__proto__:null},Ru);let r=this.opt.additionalNamespaces;r!=null&&(id(this,r),Object.assign(this.ns,r))}else this.nameStartCheck=sn,this.nameCheck=ko,this.isName=ad,this.processAttribs=this.processAttribsPlain,this.pushAttrib=this.pushAttribPlain;this.stateTable=[this.sBegin,this.sBeginWhitespace,this.sDoctype,this.sDoctypeQuote,this.sDTD,this.sDTDQuoted,this.sDTDOpenWaka,this.sDTDOpenWakaBang,this.sDTDComment,this.sDTDCommentEnding,this.sDTDCommentEnded,this.sDTDPI,this.sDTDPIEnding,this.sText,this.sEntity,this.sOpenWaka,this.sOpenWakaBang,this.sComment,this.sCommentEnding,this.sCommentEnded,this.sCData,this.sCDataEnding,this.sCDataEnding2,this.sPIFirstChar,this.sPIRest,this.sPIBody,this.sPIEnding,this.sXMLDeclNameStart,this.sXMLDeclName,this.sXMLDeclEq,this.sXMLDeclValueStart,this.sXMLDeclValue,this.sXMLDeclSeparator,this.sXMLDeclEnding,this.sOpenTag,this.sOpenTagSlash,this.sAttrib,this.sAttribName,this.sAttribNameSawWhite,this.sAttribValue,this.sAttribValueQuoted,this.sAttribValueClosed,this.sAttribValueUnquoted,this.sCloseTag,this.sCloseTagSawWhite],this._init()}get closed(){return this._closed}_init(){var e;this.openWakaBang="",this.text="",this.name="",this.piTarget="",this.entity="",this.q=null,this.tags=[],this.tag=null,this.topNS=null,this.chunk="",this.chunkPosition=0,this.i=0,this.prevI=0,this.carriedFromPrevious=void 0,this.forbiddenState=et,this.attribList=[];let{fragmentOpt:t}=this;this.state=t?Y:Lo,this.reportedTextBeforeRoot=this.reportedTextAfterRoot=this.closedRoot=this.sawRoot=t,this.xmlDeclPossible=!t,this.xmlDeclExpects=["version"],this.entityReturnState=void 0;let{defaultXMLVersion:r}=this.opt;if(r===void 0){if(this.opt.forceXMLVersion===!0)throw new Error("forceXMLVersion set but defaultXMLVersion is not set");r="1.0"}this.setXMLVersion(r),this.positionAtNewLine=0,this.doctype=!1,this._closed=!1,this.xmlDecl={version:void 0,encoding:void 0,standalone:void 0},this.line=1,this.column=0,this.ENTITIES=Object.create(Tu),(e=this.readyHandler)===null||e===void 0||e.call(this)}get position(){return this.chunkPosition+this.i}get columnIndex(){return this.position-this.positionAtNewLine}on(e,t){this[Ko[e]]=t}off(e){this[Ko[e]]=void 0}makeError(e){var t;let r=(t=this.fileName)!==null&&t!==void 0?t:"";return this.trackPosition&&(r.length>0&&(r+=":"),r+=`${this.line}:${this.column}`),r.length>0&&(r+=": "),new Error(r+e)}fail(e){let t=this.makeError(e),r=this.errorHandler;if(r===void 0)throw t;return r(t),this}write(e){if(this.closed)return this.fail("cannot write after close; assign an onready handler.");let t=!1;e===null?(t=!0,e=""):typeof e=="object"&&(e=e.toString()),this.carriedFromPrevious!==void 0&&(e=`${this.carriedFromPrevious}${e}`,this.carriedFromPrevious=void 0);let r=e.length,s=e.charCodeAt(r-1);!t&&(s===ls||s>=55296&&s<=56319)&&(this.carriedFromPrevious=e[r-1],r--,e=e.slice(0,r));let{stateTable:i}=this;for(this.chunk=e,this.i=0;this.i<r;)i[this.state].call(this);return this.chunkPosition+=r,t?this.end():this}close(){return this.write(null)}getCode10(){let{chunk:e,i:t}=this;if(this.prevI=t,this.i=t+1,t>=e.length)return O;let r=e.charCodeAt(t);if(this.column++,r<55296){if(r>=qo||r===as)return r;switch(r){case se:return this.line++,this.column=0,this.positionAtNewLine=this.position,se;case ls:return e.charCodeAt(t+1)===se&&(this.i=t+2),this.line++,this.column=0,this.positionAtNewLine=this.position,ue;default:return this.fail("disallowed character."),r}}if(r>56319)return r>=57344&&r<=65533||this.fail("disallowed character."),r;let s=65536+(r-55296)*1024+(e.charCodeAt(t+1)-56320);return this.i=t+2,s>1114111&&this.fail("disallowed character."),s}getCode11(){let{chunk:e,i:t}=this;if(this.prevI=t,this.i=t+1,t>=e.length)return O;let r=e.charCodeAt(t);if(this.column++,r<55296){if(r>31&&r<127||r>159&&r!==Vo||r===as)return r;switch(r){case se:return this.line++,this.column=0,this.positionAtNewLine=this.position,se;case ls:{let i=e.charCodeAt(t+1);(i===se||i===Wo)&&(this.i=t+2)}case Wo:case Vo:return this.line++,this.column=0,this.positionAtNewLine=this.position,ue;default:return this.fail("disallowed character."),r}}if(r>56319)return r>=57344&&r<=65533||this.fail("disallowed character."),r;let s=65536+(r-55296)*1024+(e.charCodeAt(t+1)-56320);return this.i=t+2,s>1114111&&this.fail("disallowed character."),s}getCodeNorm(){let e=this.getCode();return e===ue?se:e}unget(){this.i=this.prevI,this.column--}captureTo(e){let{i:t}=this,{chunk:r}=this;for(;;){let s=this.getCode(),i=s===ue,o=i?se:s;if(o===O||e.includes(o))return this.text+=r.slice(t,this.prevI),o;i&&(this.text+=`${r.slice(t,this.prevI)}
`,t=this.i)}}captureToChar(e){let{i:t}=this,{chunk:r}=this;for(;;){let s=this.getCode();switch(s){case ue:this.text+=`${r.slice(t,this.prevI)}
`,t=this.i,s=se;break;case O:return this.text+=r.slice(t),!1;default:}if(s===e)return this.text+=r.slice(t,this.prevI),!0}}captureNameChars(){let{chunk:e,i:t}=this;for(;;){let r=this.getCode();if(r===O)return this.name+=e.slice(t),O;if(!ko(r))return this.name+=e.slice(t,this.prevI),r===ue?se:r}}skipSpaces(){for(;;){let e=this.getCodeNorm();if(e===O||!Z(e))return e}}setXMLVersion(e){this.currentXMLVersion=e,e==="1.0"?(this.isChar=Cu,this.getCode=this.getCode10):(this.isChar=Eu,this.getCode=this.getCode11)}sBegin(){this.chunk.charCodeAt(0)===65279&&(this.i++,this.column++),this.state=Iu}sBeginWhitespace(){let e=this.i,t=this.skipSpaces();switch(this.prevI!==e&&(this.xmlDeclPossible=!1),t){case Fe:if(this.state=ts,this.text.length!==0)throw new Error("no-empty text at start");break;case O:break;default:this.unget(),this.state=Y,this.xmlDeclPossible=!1}}sDoctype(){var e;let t=this.captureTo(td);switch(t){case z:{(e=this.doctypeHandler)===null||e===void 0||e.call(this,this.text),this.text="",this.state=Y,this.doctype=!0;break}case O:break;default:this.text+=String.fromCodePoint(t),t===Qo?this.state=Rt:Un(t)&&(this.state=Fu,this.q=t)}}sDoctypeQuote(){let e=this.q;this.captureToChar(e)&&(this.text+=String.fromCodePoint(e),this.q=null,this.state=Zr)}sDTD(){let e=this.captureTo(nd);e!==O&&(this.text+=String.fromCodePoint(e),e===It?this.state=Zr:e===Fe?this.state=Nu:Un(e)&&(this.state=Ou,this.q=e))}sDTDQuoted(){let e=this.q;this.captureToChar(e)&&(this.text+=String.fromCodePoint(e),this.state=Rt,this.q=null)}sDTDOpenWaka(){let e=this.getCodeNorm();switch(this.text+=String.fromCodePoint(e),e){case Ho:this.state=Du,this.openWakaBang="";break;case K:this.state=Mu;break;default:this.state=Rt}}sDTDOpenWakaBang(){let e=String.fromCodePoint(this.getCodeNorm()),t=this.openWakaBang+=e;this.text+=e,t!=="-"&&(this.state=t==="--"?es:Rt,this.openWakaBang="")}sDTDComment(){this.captureToChar(Ln)&&(this.text+="-",this.state=ku)}sDTDCommentEnding(){let e=this.getCodeNorm();this.text+=String.fromCodePoint(e),this.state=e===Ln?Lu:es}sDTDCommentEnded(){let e=this.getCodeNorm();this.text+=String.fromCodePoint(e),e===z?this.state=Rt:(this.fail("malformed comment."),this.state=es)}sDTDPI(){this.captureToChar(K)&&(this.text+="?",this.state=Uu)}sDTDPIEnding(){let e=this.getCodeNorm();this.text+=String.fromCodePoint(e),e===z&&(this.state=Rt)}sText(){this.tags.length!==0?this.handleTextInRoot():this.handleTextOutsideRoot()}sEntity(){let{i:e}=this,{chunk:t}=this;e:for(;;)switch(this.getCode()){case ue:this.entity+=`${t.slice(e,this.prevI)}
`,e=this.i;break;case ed:{let{entityReturnState:r}=this,s=this.entity+t.slice(e,this.prevI);this.state=r;let i;s===""?(this.fail("empty entity name."),i="&;"):(i=this.parseEntity(s),this.entity=""),(r!==Y||this.textHandler!==void 0)&&(this.text+=i);break e}case O:this.entity+=t.slice(e);break e;default:}}sOpenWaka(){let e=this.getCode();if(sn(e))this.state=Ju,this.unget(),this.xmlDeclPossible=!1;else switch(e){case Mn:this.state=Qu,this.xmlDeclPossible=!1;break;case Ho:this.state=Bu,this.openWakaBang="",this.xmlDeclPossible=!1;break;case K:this.state=Hu;break;default:this.fail("disallowed character in tag name"),this.state=Y,this.xmlDeclPossible=!1}}sOpenWakaBang(){switch(this.openWakaBang+=String.fromCodePoint(this.getCodeNorm()),this.openWakaBang){case"[CDATA[":!this.sawRoot&&!this.reportedTextBeforeRoot&&(this.fail("text data outside of root node."),this.reportedTextBeforeRoot=!0),this.closedRoot&&!this.reportedTextAfterRoot&&(this.fail("text data outside of root node."),this.reportedTextAfterRoot=!0),this.state=rs,this.openWakaBang="";break;case"--":this.state=ns,this.openWakaBang="";break;case"DOCTYPE":this.state=Zr,(this.doctype||this.sawRoot)&&this.fail("inappropriately located doctype declaration."),this.openWakaBang="";break;default:this.openWakaBang.length>=7&&this.fail("incorrect syntax.")}}sComment(){this.captureToChar(Ln)&&(this.state=$u)}sCommentEnding(){var e;let t=this.getCodeNorm();t===Ln?(this.state=ju,(e=this.commentHandler)===null||e===void 0||e.call(this,this.text),this.text=""):(this.text+=`-${String.fromCodePoint(t)}`,this.state=ns)}sCommentEnded(){let e=this.getCodeNorm();e!==z?(this.fail("malformed comment."),this.text+=`--${String.fromCodePoint(e)}`,this.state=ns):this.state=Y}sCData(){this.captureToChar(It)&&(this.state=zu)}sCDataEnding(){let e=this.getCodeNorm();e===It?this.state=qu:(this.text+=`]${String.fromCodePoint(e)}`,this.state=rs)}sCDataEnding2(){var e;let t=this.getCodeNorm();switch(t){case z:{(e=this.cdataHandler)===null||e===void 0||e.call(this,this.text),this.text="",this.state=Y;break}case It:this.text+="]";break;default:this.text+=`]]${String.fromCodePoint(t)}`,this.state=rs}}sPIFirstChar(){let e=this.getCodeNorm();this.nameStartCheck(e)?(this.piTarget+=String.fromCodePoint(e),this.state=Mo):e===K||Z(e)?(this.fail("processing instruction without a target."),this.state=e===K?kn:ss):(this.fail("disallowed character in processing instruction name."),this.piTarget+=String.fromCodePoint(e),this.state=Mo)}sPIRest(){let{chunk:e,i:t}=this;for(;;){let r=this.getCodeNorm();if(r===O){this.piTarget+=e.slice(t);return}if(!this.nameCheck(r)){this.piTarget+=e.slice(t,this.prevI);let s=r===K;s||Z(r)?this.piTarget==="xml"?(this.xmlDeclPossible||this.fail("an XML declaration must be at the start of the document."),this.state=s?Ze:Uo):this.state=s?kn:ss:(this.fail("disallowed character in processing instruction name."),this.piTarget+=String.fromCodePoint(r));break}}}sPIBody(){if(this.text.length===0){let e=this.getCodeNorm();e===K?this.state=kn:Z(e)||(this.text=String.fromCodePoint(e))}else this.captureToChar(K)&&(this.state=kn)}sPIEnding(){var e;let t=this.getCodeNorm();if(t===z){let{piTarget:r}=this;r.toLowerCase()==="xml"&&this.fail("the XML declaration must appear at the start of the document."),(e=this.piHandler)===null||e===void 0||e.call(this,{target:r,body:this.text}),this.piTarget=this.text="",this.state=Y}else t===K?this.text+="?":(this.text+=`?${String.fromCodePoint(t)}`,this.state=ss);this.xmlDeclPossible=!1}sXMLDeclNameStart(){let e=this.skipSpaces();if(e===K){this.state=Ze;return}e!==O&&(this.state=Wu,this.name=String.fromCodePoint(e))}sXMLDeclName(){let e=this.captureTo(rd);if(e===K){this.state=Ze,this.name+=this.text,this.text="",this.fail("XML declaration is incomplete.");return}if(Z(e)||e===Tt){if(this.name+=this.text,this.text="",!this.xmlDeclExpects.includes(this.name))switch(this.name.length){case 0:this.fail("did not expect any more name/value pairs.");break;case 1:this.fail(`expected the name ${this.xmlDeclExpects[0]}.`);break;default:this.fail(`expected one of ${this.xmlDeclExpects.join(", ")}`)}this.state=e===Tt?Bo:Vu}}sXMLDeclEq(){let e=this.getCodeNorm();if(e===K){this.state=Ze,this.fail("XML declaration is incomplete.");return}Z(e)||(e!==Tt&&this.fail("value required."),this.state=Bo)}sXMLDeclValueStart(){let e=this.getCodeNorm();if(e===K){this.state=Ze,this.fail("XML declaration is incomplete.");return}Z(e)||(Un(e)?this.q=e:(this.fail("value must be quoted."),this.q=qo),this.state=Xu)}sXMLDeclValue(){let e=this.captureTo([this.q,K]);if(e===K){this.state=Ze,this.text="",this.fail("XML declaration is incomplete.");return}if(e===O)return;let t=this.text;switch(this.text="",this.name){case"version":{this.xmlDeclExpects=["encoding","standalone"];let r=t;this.xmlDecl.version=r,/^1\.[0-9]+$/.test(r)?this.opt.forceXMLVersion||this.setXMLVersion(r):this.fail("version number must match /^1\\.[0-9]+$/.");break}case"encoding":/^[A-Za-z][A-Za-z0-9._-]*$/.test(t)||this.fail("encoding value must match /^[A-Za-z0-9][A-Za-z0-9._-]*$/."),this.xmlDeclExpects=["standalone"],this.xmlDecl.encoding=t;break;case"standalone":t!=="yes"&&t!=="no"&&this.fail('standalone value must match "yes" or "no".'),this.xmlDeclExpects=[],this.xmlDecl.standalone=t;break;default:}this.name="",this.state=Ku}sXMLDeclSeparator(){let e=this.getCodeNorm();if(e===K){this.state=Ze;return}Z(e)||(this.fail("whitespace required."),this.unget()),this.state=Uo}sXMLDeclEnding(){var e;this.getCodeNorm()===z?(this.piTarget!=="xml"?this.fail("processing instructions are not allowed before root."):this.name!=="version"&&this.xmlDeclExpects.includes("version")&&this.fail("XML declaration must contain a version."),(e=this.xmldeclHandler)===null||e===void 0||e.call(this,this.xmlDecl),this.name="",this.piTarget=this.text="",this.state=Y):this.fail("The character ? is disallowed anywhere in XML declarations."),this.xmlDeclPossible=!1}sOpenTag(){var e;let t=this.captureNameChars();if(t===O)return;let r=this.tag={name:this.name,attributes:Object.create(null)};switch(this.name="",this.xmlnsOpt&&(this.topNS=r.ns=Object.create(null)),(e=this.openTagStartHandler)===null||e===void 0||e.call(this,r),this.sawRoot=!0,!this.fragmentOpt&&this.closedRoot&&this.fail("documents may contain only one root."),t){case z:this.openTag();break;case Mn:this.state=is;break;default:Z(t)||this.fail("disallowed character in tag name."),this.state=on}}sOpenTagSlash(){this.getCode()===z?this.openSelfClosingTag():(this.fail("forward-slash in opening tag not followed by >."),this.state=on)}sAttrib(){let e=this.skipSpaces();e!==O&&(sn(e)?(this.unget(),this.state=os):e===z?this.openTag():e===Mn?this.state=is:this.fail("disallowed character in attribute name."))}sAttribName(){let e=this.captureNameChars();e===Tt?this.state=$o:Z(e)?this.state=Gu:e===z?(this.fail("attribute without value."),this.pushAttrib(this.name,this.name),this.name=this.text="",this.openTag()):e!==O&&this.fail("disallowed character in attribute name.")}sAttribNameSawWhite(){let e=this.skipSpaces();switch(e){case O:return;case Tt:this.state=$o;break;default:this.fail("attribute without value."),this.text="",this.name="",e===z?this.openTag():sn(e)?(this.unget(),this.state=os):(this.fail("disallowed character in attribute name."),this.state=on)}}sAttribValue(){let e=this.getCodeNorm();Un(e)?(this.q=e,this.state=jo):Z(e)||(this.fail("unquoted attribute value."),this.state=zo,this.unget())}sAttribValueQuoted(){let{q:e,chunk:t}=this,{i:r}=this;for(;;)switch(this.getCode()){case e:this.pushAttrib(this.name,this.text+t.slice(r,this.prevI)),this.name=this.text="",this.q=null,this.state=Yu;return;case an:this.text+=t.slice(r,this.prevI),this.state=Dn,this.entityReturnState=jo;return;case se:case ue:case as:this.text+=`${t.slice(r,this.prevI)} `,r=this.i;break;case Fe:this.text+=t.slice(r,this.prevI),this.fail("disallowed character.");return;case O:this.text+=t.slice(r);return;default:}}sAttribValueClosed(){let e=this.getCodeNorm();Z(e)?this.state=on:e===z?this.openTag():e===Mn?this.state=is:sn(e)?(this.fail("no whitespace between attributes."),this.unget(),this.state=os):this.fail("disallowed character in attribute name.")}sAttribValueUnquoted(){let e=this.captureTo(sd);switch(e){case an:this.state=Dn,this.entityReturnState=zo;break;case Fe:this.fail("disallowed character.");break;case O:break;default:this.text.includes("]]>")&&this.fail('the string "]]>" is disallowed in char data.'),this.pushAttrib(this.name,this.text),this.name=this.text="",e===z?this.openTag():this.state=on}}sCloseTag(){let e=this.captureNameChars();e===z?this.closeTag():Z(e)?this.state=Zu:e!==O&&this.fail("disallowed character in closing tag.")}sCloseTagSawWhite(){switch(this.skipSpaces()){case z:this.closeTag();break;case O:break;default:this.fail("disallowed character in closing tag.")}}handleTextInRoot(){let{i:e,forbiddenState:t}=this,{chunk:r,textHandler:s}=this;e:for(;;)switch(this.getCode()){case Fe:{if(this.state=ts,s!==void 0){let{text:i}=this,o=r.slice(e,this.prevI);i.length!==0?(s(i+o),this.text=""):o.length!==0&&s(o)}t=et;break e}case an:this.state=Dn,this.entityReturnState=Y,s!==void 0&&(this.text+=r.slice(e,this.prevI)),t=et;break e;case It:switch(t){case et:t=Xo;break;case Xo:t=cs;break;case cs:break;default:throw new Error("impossible state")}break;case z:t===cs&&this.fail('the string "]]>" is disallowed in char data.'),t=et;break;case ue:s!==void 0&&(this.text+=`${r.slice(e,this.prevI)}
`),e=this.i,t=et;break;case O:s!==void 0&&(this.text+=r.slice(e));break e;default:t=et}this.forbiddenState=t}handleTextOutsideRoot(){let{i:e}=this,{chunk:t,textHandler:r}=this,s=!1;e:for(;;){let i=this.getCode();switch(i){case Fe:{if(this.state=ts,r!==void 0){let{text:o}=this,a=t.slice(e,this.prevI);o.length!==0?(r(o+a),this.text=""):a.length!==0&&r(a)}break e}case an:this.state=Dn,this.entityReturnState=Y,r!==void 0&&(this.text+=t.slice(e,this.prevI)),s=!0;break e;case ue:r!==void 0&&(this.text+=`${t.slice(e,this.prevI)}
`),e=this.i;break;case O:r!==void 0&&(this.text+=t.slice(e));break e;default:Z(i)||(s=!0)}}s&&(!this.sawRoot&&!this.reportedTextBeforeRoot&&(this.fail("text data outside of root node."),this.reportedTextBeforeRoot=!0),this.closedRoot&&!this.reportedTextAfterRoot&&(this.fail("text data outside of root node."),this.reportedTextAfterRoot=!0))}pushAttribNS(e,t){var r;let{prefix:s,local:i}=this.qname(e),o={name:e,prefix:s,local:i,value:t};if(this.attribList.push(o),(r=this.attributeHandler)===null||r===void 0||r.call(this,o),s==="xmlns"){let a=t.trim();this.currentXMLVersion==="1.0"&&a===""&&this.fail("invalid attempt to undefine prefix in XML 1.0"),this.topNS[i]=a,us(this,i,a)}else if(e==="xmlns"){let a=t.trim();this.topNS[""]=a,us(this,"",a)}}pushAttribPlain(e,t){var r;let s={name:e,value:t};this.attribList.push(s),(r=this.attributeHandler)===null||r===void 0||r.call(this,s)}end(){var e,t;this.sawRoot||this.fail("document must contain a root element.");let{tags:r}=this;for(;r.length>0;){let i=r.pop();this.fail(`unclosed tag: ${i.name}`)}this.state!==Lo&&this.state!==Y&&this.fail("unexpected end.");let{text:s}=this;return s.length!==0&&((e=this.textHandler)===null||e===void 0||e.call(this,s),this.text=""),this._closed=!0,(t=this.endHandler)===null||t===void 0||t.call(this),this._init(),this}resolve(e){var t,r;let s=this.topNS[e];if(s!==void 0)return s;let{tags:i}=this;for(let o=i.length-1;o>=0;o--)if(s=i[o].ns[e],s!==void 0)return s;return s=this.ns[e],s!==void 0?s:(r=(t=this.opt).resolvePrefix)===null||r===void 0?void 0:r.call(t,e)}qname(e){let t=e.indexOf(":");if(t===-1)return{prefix:"",local:e};let r=e.slice(t+1),s=e.slice(0,t);return(s===""||r===""||r.includes(":"))&&this.fail(`malformed name: ${e}.`),{prefix:s,local:r}}processAttribsNS(){var e;let{attribList:t}=this,r=this.tag;{let{prefix:o,local:a}=this.qname(r.name);r.prefix=o,r.local=a;let l=r.uri=(e=this.resolve(o))!==null&&e!==void 0?e:"";o!==""&&(o==="xmlns"&&this.fail('tags may not have "xmlns" as prefix.'),l===""&&(this.fail(`unbound namespace prefix: ${JSON.stringify(o)}.`),r.uri=o))}if(t.length===0)return;let{attributes:s}=r,i=new Set;for(let o of t){let{name:a,prefix:l,local:c}=o,u,d;l===""?(u=a==="xmlns"?Ft:"",d=a):(u=this.resolve(l),u===void 0&&(this.fail(`unbound namespace prefix: ${JSON.stringify(l)}.`),u=l),d=`{${u}}${c}`),i.has(d)&&this.fail(`duplicate attribute: ${d}.`),i.add(d),o.uri=u,s[a]=o}this.attribList=[]}processAttribsPlain(){let{attribList:e}=this,t=this.tag.attributes;for(let{name:r,value:s}of e)t[r]!==void 0&&this.fail(`duplicate attribute: ${r}.`),t[r]=s;this.attribList=[]}openTag(){var e;this.processAttribs();let{tags:t}=this,r=this.tag;r.isSelfClosing=!1,(e=this.openTagHandler)===null||e===void 0||e.call(this,r),t.push(r),this.state=Y,this.name=""}openSelfClosingTag(){var e,t,r;this.processAttribs();let{tags:s}=this,i=this.tag;i.isSelfClosing=!0,(e=this.openTagHandler)===null||e===void 0||e.call(this,i),(t=this.closeTagHandler)===null||t===void 0||t.call(this,i),(this.tag=(r=s[s.length-1])!==null&&r!==void 0?r:null)===null&&(this.closedRoot=!0),this.state=Y,this.name=""}closeTag(){let{tags:e,name:t}=this;if(this.state=Y,this.name="",t===""){this.fail("weird empty close tag."),this.text+="</>";return}let r=this.closeTagHandler,s=e.length;for(;s-- >0;){let i=this.tag=e.pop();if(this.topNS=i.ns,r==null||r(i),i.name===t)break;this.fail("unexpected close tag.")}s===0?this.closedRoot=!0:s<0&&(this.fail(`unmatched closing tag: ${t}.`),this.text+=`</${t}>`)}parseEntity(e){if(e[0]!=="#"){let r=this.ENTITIES[e];return r!==void 0?r:(this.fail(this.isName(e)?"undefined entity.":"disallowed character in entity name."),`&${e};`)}let t=NaN;return e[1]==="x"&&/^#x[0-9a-f]+$/i.test(e)?t=parseInt(e.slice(2),16):/^#[0-9]+$/.test(e)&&(t=parseInt(e.slice(1),10)),this.isChar(t)?String.fromCodePoint(t):(this.fail("malformed character entity."),`&${e};`)}};$n.SaxesParser=ds});var sa=k((Mp,ra)=>{ra.exports=jn;function jn(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}jn.prototype.go=function(n){this.pending<this.max?na(this,n):this.waiting.push(n)};jn.prototype.wait=function(n){this.pending===0?n(this.error):this.listeners.push(n)};jn.prototype.hold=function(){return ta(this)};function ta(n){n.pending+=1;var e=!1;return t;function t(s){if(e)throw new Error("callback called twice");if(e=!0,n.error=n.error||s,n.pending-=1,n.waiting.length>0&&n.pending<n.max)na(n,n.waiting.shift());else if(n.pending===0){var i=n.listeners;n.listeners=[],i.forEach(r)}}function r(s){s(n.error)}}function na(n,e){e(ta(n))}});var oa=k(cn=>{var ln=require("fs"),zn=require("util"),hs=require("stream"),ia=hs.Readable,ps=hs.Writable,ld=hs.PassThrough,cd=sa(),qn=require("events").EventEmitter;cn.createFromBuffer=ud;cn.createFromFd=dd;cn.BufferSlicer=be;cn.FdSlicer=we;zn.inherits(we,qn);function we(n,e){e=e||{},qn.call(this),this.fd=n,this.pend=new cd,this.pend.max=1,this.refCount=0,this.autoClose=!!e.autoClose}we.prototype.read=function(n,e,t,r,s){var i=this;i.pend.go(function(o){ln.read(i.fd,n,e,t,r,function(a,l,c){o(),s(a,l,c)})})};we.prototype.write=function(n,e,t,r,s){var i=this;i.pend.go(function(o){ln.write(i.fd,n,e,t,r,function(a,l,c){o(),s(a,l,c)})})};we.prototype.createReadStream=function(n){return new Hn(this,n)};we.prototype.createWriteStream=function(n){return new Wn(this,n)};we.prototype.ref=function(){this.refCount+=1};we.prototype.unref=function(){var n=this;if(n.refCount-=1,n.refCount>0)return;if(n.refCount<0)throw new Error("invalid unref");n.autoClose&&ln.close(n.fd,e);function e(t){t?n.emit("error",t):n.emit("close")}};zn.inherits(Hn,ia);function Hn(n,e){e=e||{},ia.call(this,e),this.context=n,this.context.ref(),this.start=e.start||0,this.endOffset=e.end,this.pos=this.start,this.destroyed=!1}Hn.prototype._read=function(n){var e=this;if(!e.destroyed){var t=Math.min(e._readableState.highWaterMark,n);if(e.endOffset!=null&&(t=Math.min(t,e.endOffset-e.pos)),t<=0){e.destroyed=!0,e.push(null),e.context.unref();return}e.context.pend.go(function(r){if(e.destroyed)return r();var s=new Buffer(t);ln.read(e.context.fd,s,0,t,e.pos,function(i,o){i?e.destroy(i):o===0?(e.destroyed=!0,e.push(null),e.context.unref()):(e.pos+=o,e.push(s.slice(0,o))),r()})})}};Hn.prototype.destroy=function(n){this.destroyed||(n=n||new Error("stream destroyed"),this.destroyed=!0,this.emit("error",n),this.context.unref())};zn.inherits(Wn,ps);function Wn(n,e){e=e||{},ps.call(this,e),this.context=n,this.context.ref(),this.start=e.start||0,this.endOffset=e.end==null?1/0:+e.end,this.bytesWritten=0,this.pos=this.start,this.destroyed=!1,this.on("finish",this.destroy.bind(this))}Wn.prototype._write=function(n,e,t){var r=this;if(!r.destroyed){if(r.pos+n.length>r.endOffset){var s=new Error("maximum file length exceeded");s.code="ETOOBIG",r.destroy(),t(s);return}r.context.pend.go(function(i){if(r.destroyed)return i();ln.write(r.context.fd,n,0,n.length,r.pos,function(o,a){o?(r.destroy(),i(),t(o)):(r.bytesWritten+=a,r.pos+=a,r.emit("progress"),i(),t())})})}};Wn.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.context.unref())};zn.inherits(be,qn);function be(n,e){qn.call(this),e=e||{},this.refCount=0,this.buffer=n,this.maxChunkSize=e.maxChunkSize||Number.MAX_SAFE_INTEGER}be.prototype.read=function(n,e,t,r,s){var i=r+t,o=i-this.buffer.length,a=o>0?o:t;this.buffer.copy(n,e,r,i),setImmediate(function(){s(null,a)})};be.prototype.write=function(n,e,t,r,s){n.copy(this.buffer,r,e,e+t),setImmediate(function(){s(null,t,n)})};be.prototype.createReadStream=function(n){n=n||{};var e=new ld(n);e.destroyed=!1,e.start=n.start||0,e.endOffset=n.end,e.pos=e.endOffset||this.buffer.length;for(var t=this.buffer.slice(e.start,e.pos),r=0;;){var s=r+this.maxChunkSize;if(s>=t.length){r<t.length&&e.write(t.slice(r,t.length));break}e.write(t.slice(r,s)),r=s}return e.end(),e.destroy=function(){e.destroyed=!0},e};be.prototype.createWriteStream=function(n){var e=this;n=n||{};var t=new ps(n);return t.start=n.start||0,t.endOffset=n.end==null?this.buffer.length:+n.end,t.bytesWritten=0,t.pos=t.start,t.destroyed=!1,t._write=function(r,s,i){if(!t.destroyed){var o=t.pos+r.length;if(o>t.endOffset){var a=new Error("maximum file length exceeded");a.code="ETOOBIG",t.destroyed=!0,i(a);return}r.copy(e.buffer,t.pos,0,r.length),t.bytesWritten+=r.length,t.pos=o,t.emit("progress"),i()}},t.destroy=function(){t.destroyed=!0},t};be.prototype.ref=function(){this.refCount+=1};be.prototype.unref=function(){if(this.refCount-=1,this.refCount<0)throw new Error("invalid unref")};function ud(n,e){return new be(n,e)}function dd(n,e){return new we(n,e)}});var ca=k((Bp,la)=>{var Oe=require("buffer").Buffer,ms=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array!="undefined"&&(ms=new Int32Array(ms));function aa(n){if(Oe.isBuffer(n))return n;var e=typeof Oe.alloc=="function"&&typeof Oe.from=="function";if(typeof n=="number")return e?Oe.alloc(n):new Oe(n);if(typeof n=="string")return e?Oe.from(n):new Oe(n);throw new Error("input must be buffer, number, or string, received "+typeof n)}function fd(n){var e=aa(4);return e.writeInt32BE(n,0),e}function gs(n,e){n=aa(n),Oe.isBuffer(e)&&(e=e.readUInt32BE(0));for(var t=~~e^-1,r=0;r<n.length;r++)t=ms[(t^n[r])&255]^t>>>8;return t^-1}function xs(){return fd(gs.apply(null,arguments))}xs.signed=function(){return gs.apply(null,arguments)};xs.unsigned=function(){return gs.apply(null,arguments)>>>0};la.exports=xs});var ga=k(fe=>{var ys=require("fs"),hd=require("zlib"),ua=oa(),pd=ca(),Kn=require("util"),Jn=require("events").EventEmitter,da=require("stream").Transform,_s=require("stream").PassThrough,md=require("stream").Writable;fe.open=gd;fe.fromFd=fa;fe.fromBuffer=xd;fe.fromRandomAccessReader=ws;fe.dosDateTimeToDate=pa;fe.validateFileName=ma;fe.ZipFile=Ne;fe.Entry=un;fe.RandomAccessReader=De;function gd(n,e,t){typeof e=="function"&&(t=e,e=null),e==null&&(e={}),e.autoClose==null&&(e.autoClose=!0),e.lazyEntries==null&&(e.lazyEntries=!1),e.decodeStrings==null&&(e.decodeStrings=!0),e.validateEntrySizes==null&&(e.validateEntrySizes=!0),e.strictFileNames==null&&(e.strictFileNames=!1),t==null&&(t=Xn),ys.open(n,"r",function(r,s){if(r)return t(r);fa(s,e,function(i,o){i&&ys.close(s,Xn),t(i,o)})})}function fa(n,e,t){typeof e=="function"&&(t=e,e=null),e==null&&(e={}),e.autoClose==null&&(e.autoClose=!1),e.lazyEntries==null&&(e.lazyEntries=!1),e.decodeStrings==null&&(e.decodeStrings=!0),e.validateEntrySizes==null&&(e.validateEntrySizes=!0),e.strictFileNames==null&&(e.strictFileNames=!1),t==null&&(t=Xn),ys.fstat(n,function(r,s){if(r)return t(r);var i=ua.createFromFd(n,{autoClose:!0});ws(i,s.size,e,t)})}function xd(n,e,t){typeof e=="function"&&(t=e,e=null),e==null&&(e={}),e.autoClose=!1,e.lazyEntries==null&&(e.lazyEntries=!1),e.decodeStrings==null&&(e.decodeStrings=!0),e.validateEntrySizes==null&&(e.validateEntrySizes=!0),e.strictFileNames==null&&(e.strictFileNames=!1);var r=ua.createFromBuffer(n,{maxChunkSize:65536});ws(r,n.length,e,t)}function ws(n,e,t,r){typeof t=="function"&&(r=t,t=null),t==null&&(t={}),t.autoClose==null&&(t.autoClose=!0),t.lazyEntries==null&&(t.lazyEntries=!1),t.decodeStrings==null&&(t.decodeStrings=!0);var s=!!t.decodeStrings;if(t.validateEntrySizes==null&&(t.validateEntrySizes=!0),t.strictFileNames==null&&(t.strictFileNames=!1),r==null&&(r=Xn),typeof e!="number")throw new Error("expected totalSize parameter to be a number");if(e>Number.MAX_SAFE_INTEGER)throw new Error("zip file too large. only file sizes up to 2^52 are supported due to JavaScript's Number type being an IEEE 754 double.");n.ref();var i=22,o=65535,a=Math.min(i+o,e),l=de(a),c=e-l.length;Nt(n,l,0,a,c,function(u){if(u)return r(u);for(var d=a-i;d>=0;d-=1)if(l.readUInt32LE(d)===101010256){var f=l.slice(d),p=f.readUInt16LE(4);if(p!==0)return r(new Error("multi-disk zip files are not supported: found disk number: "+p));var h=f.readUInt16LE(10),m=f.readUInt32LE(16),x=f.readUInt16LE(20),y=f.length-i;if(x!==y)return r(new Error("invalid comment length. expected: "+y+". found: "+x));var g=s?Vn(f,22,f.length,!1):f.slice(22);if(!(h===65535||m===4294967295))return r(null,new Ne(n,m,e,h,g,t.autoClose,t.lazyEntries,s,t.validateEntrySizes,t.strictFileNames));var _=de(20),b=c+d-_.length;Nt(n,_,0,_.length,b,function(I){if(I)return r(I);if(_.readUInt32LE(0)!==117853008)return r(new Error("invalid zip64 end of central directory locator signature"));var P=Dt(_,8),j=de(56);Nt(n,j,0,j.length,P,function(V){return V?r(V):j.readUInt32LE(0)!==101075792?r(new Error("invalid zip64 end of central directory record signature")):(h=Dt(j,32),m=Dt(j,48),r(null,new Ne(n,m,e,h,g,t.autoClose,t.lazyEntries,s,t.validateEntrySizes,t.strictFileNames)))})});return}r(new Error("end of central directory record signature not found"))})}Kn.inherits(Ne,Jn);function Ne(n,e,t,r,s,i,o,a,l,c){var u=this;Jn.call(u),u.reader=n,u.reader.on("error",function(d){ha(u,d)}),u.reader.once("close",function(){u.emit("close")}),u.readEntryCursor=e,u.fileSize=t,u.entryCount=r,u.comment=s,u.entriesRead=0,u.autoClose=!!i,u.lazyEntries=!!o,u.decodeStrings=!!a,u.validateEntrySizes=!!l,u.strictFileNames=!!c,u.isOpen=!0,u.emittedError=!1,u.lazyEntries||u._readEntry()}Ne.prototype.close=function(){this.isOpen&&(this.isOpen=!1,this.reader.unref())};function ie(n,e){n.autoClose&&n.close(),ha(n,e)}function ha(n,e){n.emittedError||(n.emittedError=!0,n.emit("error",e))}Ne.prototype.readEntry=function(){if(!this.lazyEntries)throw new Error("readEntry() called without lazyEntries:true");this._readEntry()};Ne.prototype._readEntry=function(){var n=this;if(n.entryCount===n.entriesRead){setImmediate(function(){n.autoClose&&n.close(),!n.emittedError&&n.emit("end")});return}if(!n.emittedError){var e=de(46);Nt(n.reader,e,0,e.length,n.readEntryCursor,function(t){if(t)return ie(n,t);if(!n.emittedError){var r=new un,s=e.readUInt32LE(0);if(s!==33639248)return ie(n,new Error("invalid central directory file header signature: 0x"+s.toString(16)));if(r.versionMadeBy=e.readUInt16LE(4),r.versionNeededToExtract=e.readUInt16LE(6),r.generalPurposeBitFlag=e.readUInt16LE(8),r.compressionMethod=e.readUInt16LE(10),r.lastModFileTime=e.readUInt16LE(12),r.lastModFileDate=e.readUInt16LE(14),r.crc32=e.readUInt32LE(16),r.compressedSize=e.readUInt32LE(20),r.uncompressedSize=e.readUInt32LE(24),r.fileNameLength=e.readUInt16LE(28),r.extraFieldLength=e.readUInt16LE(30),r.fileCommentLength=e.readUInt16LE(32),r.internalFileAttributes=e.readUInt16LE(36),r.externalFileAttributes=e.readUInt32LE(38),r.relativeOffsetOfLocalHeader=e.readUInt32LE(42),r.generalPurposeBitFlag&64)return ie(n,new Error("strong encryption is not supported"));n.readEntryCursor+=46,e=de(r.fileNameLength+r.extraFieldLength+r.fileCommentLength),Nt(n.reader,e,0,e.length,n.readEntryCursor,function(i){if(i)return ie(n,i);if(!n.emittedError){var o=(r.generalPurposeBitFlag&2048)!==0;r.fileName=n.decodeStrings?Vn(e,0,r.fileNameLength,o):e.slice(0,r.fileNameLength);var a=r.fileNameLength+r.extraFieldLength,l=e.slice(r.fileNameLength,a);r.extraFields=[];for(var c=0;c<l.length-3;){var u=l.readUInt16LE(c+0),d=l.readUInt16LE(c+2),f=c+4,p=f+d;if(p>l.length)return ie(n,new Error("extra field length exceeds extra field buffer size"));var h=de(d);l.copy(h,0,f,p),r.extraFields.push({id:u,data:h}),c=p}if(r.fileComment=n.decodeStrings?Vn(e,a,a+r.fileCommentLength,o):e.slice(a,a+r.fileCommentLength),r.comment=r.fileComment,n.readEntryCursor+=e.length,n.entriesRead+=1,r.uncompressedSize===4294967295||r.compressedSize===4294967295||r.relativeOffsetOfLocalHeader===4294967295){for(var m=null,c=0;c<r.extraFields.length;c++){var x=r.extraFields[c];if(x.id===1){m=x.data;break}}if(m==null)return ie(n,new Error("expected zip64 extended information extra field"));var y=0;if(r.uncompressedSize===4294967295){if(y+8>m.length)return ie(n,new Error("zip64 extended information extra field does not include uncompressed size"));r.uncompressedSize=Dt(m,y),y+=8}if(r.compressedSize===4294967295){if(y+8>m.length)return ie(n,new Error("zip64 extended information extra field does not include compressed size"));r.compressedSize=Dt(m,y),y+=8}if(r.relativeOffsetOfLocalHeader===4294967295){if(y+8>m.length)return ie(n,new Error("zip64 extended information extra field does not include relative header offset"));r.relativeOffsetOfLocalHeader=Dt(m,y),y+=8}}if(n.decodeStrings)for(var c=0;c<r.extraFields.length;c++){var x=r.extraFields[c];if(x.id===28789){if(x.data.length<6||x.data.readUInt8(0)!==1)continue;var g=x.data.readUInt32LE(1);if(pd.unsigned(e.slice(0,r.fileNameLength))!==g)continue;r.fileName=Vn(x.data,5,x.data.length,!0);break}}if(n.validateEntrySizes&&r.compressionMethod===0){var _=r.uncompressedSize;if(r.isEncrypted()&&(_+=12),r.compressedSize!==_){var b="compressed/uncompressed size mismatch for stored file: "+r.compressedSize+" != "+r.uncompressedSize;return ie(n,new Error(b))}}if(n.decodeStrings){n.strictFileNames||(r.fileName=r.fileName.replace(/\\/g,"/"));var I=ma(r.fileName,n.validateFileNameOptions);if(I!=null)return ie(n,new Error(I))}n.emit("entry",r),n.lazyEntries||n._readEntry()}})}})}};Ne.prototype.openReadStream=function(n,e,t){var r=this,s=0,i=n.compressedSize;if(t==null)t=e,e={};else{if(e.decrypt!=null){if(!n.isEncrypted())throw new Error("options.decrypt can only be specified for encrypted entries");if(e.decrypt!==!1)throw new Error("invalid options.decrypt value: "+e.decrypt);if(n.isCompressed()&&e.decompress!==!1)throw new Error("entry is encrypted and compressed, and options.decompress !== false")}if(e.decompress!=null){if(!n.isCompressed())throw new Error("options.decompress can only be specified for compressed entries");if(!(e.decompress===!1||e.decompress===!0))throw new Error("invalid options.decompress value: "+e.decompress)}if(e.start!=null||e.end!=null){if(n.isCompressed()&&e.decompress!==!1)throw new Error("start/end range not allowed for compressed entry without options.decompress === false");if(n.isEncrypted()&&e.decrypt!==!1)throw new Error("start/end range not allowed for encrypted entry without options.decrypt === false")}if(e.start!=null){if(s=e.start,s<0)throw new Error("options.start < 0");if(s>n.compressedSize)throw new Error("options.start > entry.compressedSize")}if(e.end!=null){if(i=e.end,i<0)throw new Error("options.end < 0");if(i>n.compressedSize)throw new Error("options.end > entry.compressedSize");if(i<s)throw new Error("options.end < options.start")}}if(!r.isOpen)return t(new Error("closed"));if(n.isEncrypted()&&e.decrypt!==!1)return t(new Error("entry is encrypted, and options.decrypt !== false"));r.reader.ref();var o=de(30);Nt(r.reader,o,0,o.length,n.relativeOffsetOfLocalHeader,function(a){try{if(a)return t(a);var l=o.readUInt32LE(0);if(l!==67324752)return t(new Error("invalid local file header signature: 0x"+l.toString(16)));var c=o.readUInt16LE(26),u=o.readUInt16LE(28),d=n.relativeOffsetOfLocalHeader+o.length+c+u,f;if(n.compressionMethod===0)f=!1;else if(n.compressionMethod===8)f=e.decompress!=null?e.decompress:!0;else return t(new Error("unsupported compression method: "+n.compressionMethod));var p=d,h=p+n.compressedSize;if(n.compressedSize!==0&&h>r.fileSize)return t(new Error("file data overflows file bounds: "+p+" + "+n.compressedSize+" > "+r.fileSize));var m=r.reader.createReadStream({start:p+s,end:p+i}),x=m;if(f){var y=!1,g=hd.createInflateRaw();m.on("error",function(_){setImmediate(function(){y||g.emit("error",_)})}),m.pipe(g),r.validateEntrySizes?(x=new dn(n.uncompressedSize),g.on("error",function(_){setImmediate(function(){y||x.emit("error",_)})}),g.pipe(x)):x=g,x.destroy=function(){y=!0,g!==x&&g.unpipe(x),m.unpipe(g),m.destroy()}}t(null,x)}finally{r.reader.unref()}})};function un(){}un.prototype.getLastModDate=function(){return pa(this.lastModFileDate,this.lastModFileTime)};un.prototype.isEncrypted=function(){return(this.generalPurposeBitFlag&1)!==0};un.prototype.isCompressed=function(){return this.compressionMethod===8};function pa(n,e){var t=n&31,r=(n>>5&15)-1,s=(n>>9&127)+1980,i=0,o=(e&31)*2,a=e>>5&63,l=e>>11&31;return new Date(s,r,t,l,a,o,i)}function ma(n){return n.indexOf("\\")!==-1?"invalid characters in fileName: "+n:/^[a-zA-Z]:/.test(n)||/^\//.test(n)?"absolute path: "+n:n.split("/").indexOf("..")!==-1?"invalid relative path: "+n:null}function Nt(n,e,t,r,s,i){if(r===0)return setImmediate(function(){i(null,de(0))});n.read(e,t,r,s,function(o,a){if(o)return i(o);if(a<r)return i(new Error("unexpected EOF"));i()})}Kn.inherits(dn,da);function dn(n){da.call(this),this.actualByteCount=0,this.expectedByteCount=n}dn.prototype._transform=function(n,e,t){if(this.actualByteCount+=n.length,this.actualByteCount>this.expectedByteCount){var r="too many bytes in the stream. expected "+this.expectedByteCount+". got at least "+this.actualByteCount;return t(new Error(r))}t(null,n)};dn.prototype._flush=function(n){if(this.actualByteCount<this.expectedByteCount){var e="not enough bytes in the stream. expected "+this.expectedByteCount+". got only "+this.actualByteCount;return n(new Error(e))}n()};Kn.inherits(De,Jn);function De(){Jn.call(this),this.refCount=0}De.prototype.ref=function(){this.refCount+=1};De.prototype.unref=function(){var n=this;if(n.refCount-=1,n.refCount>0)return;if(n.refCount<0)throw new Error("invalid unref");n.close(e);function e(t){if(t)return n.emit("error",t);n.emit("close")}};De.prototype.createReadStream=function(n){var e=n.start,t=n.end;if(e===t){var r=new _s;return setImmediate(function(){r.end()}),r}var s=this._readStreamForRange(e,t),i=!1,o=new Gn(this);s.on("error",function(l){setImmediate(function(){i||o.emit("error",l)})}),o.destroy=function(){s.unpipe(o),o.unref(),s.destroy()};var a=new dn(t-e);return o.on("error",function(l){setImmediate(function(){i||a.emit("error",l)})}),a.destroy=function(){i=!0,o.unpipe(a),o.destroy()},s.pipe(o).pipe(a)};De.prototype._readStreamForRange=function(n,e){throw new Error("not implemented")};De.prototype.read=function(n,e,t,r,s){var i=this.createReadStream({start:r,end:r+t}),o=new md,a=0;o._write=function(l,c,u){l.copy(n,e+a,0,l.length),a+=l.length,u()},o.on("finish",s),i.on("error",function(l){s(l)}),i.pipe(o)};De.prototype.close=function(n){setImmediate(n)};Kn.inherits(Gn,_s);function Gn(n){_s.call(this),this.context=n,this.context.ref(),this.unreffedYet=!1}Gn.prototype._flush=function(n){this.unref(),n()};Gn.prototype.unref=function(n){this.unreffedYet||(this.unreffedYet=!0,this.context.unref())};var yd="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0\xA0";function Vn(n,e,t,r){if(r)return n.toString("utf8",e,t);for(var s="",i=e;i<t;i++)s+=yd[n[i]];return s}function Dt(n,e){var t=n.readUInt32LE(e),r=n.readUInt32LE(e+4);return r*4294967296+t}var de;typeof Buffer.allocUnsafe=="function"?de=function(n){return Buffer.allocUnsafe(n)}:de=function(n){return new Buffer(n)};function Xn(n){if(n)throw n}});var Cs=k((jp,xa)=>{var bs=class n{constructor(e){this._buffer=e}open(){return Promise.resolve()}close(){return Promise.resolve()}read(e,t,r,s){return this._buffer.copy(e,t,s,s+r),Promise.resolve(e)}buffer(){return this._buffer}static isBufferReader(e){return e instanceof n}};xa.exports=bs});var As=k((zp,ya)=>{var vs=require("fs"),Es=class n{constructor(e){this._filename=e}open(){return new Promise((e,t)=>{vs.open(this._filename,"r",438,(r,s)=>{if(r)return t(r);this._fd=s,e()})})}close(){return new Promise((e,t)=>{this._fd?vs.close(this._fd,r=>{if(r)return t(r);delete this._fd,e()}):e()})}read(e,t,r,s){return new Promise((i,o)=>{if(!this._fd)return o(new Error("file not open"));vs.read(this._fd,e,t,r,s,(a,l,c)=>{if(a)return o(a);i(c)})})}fd(){return this._fd}static isFileReader(e){return e instanceof n}};ya.exports=Es});var Ca=k((qp,ba)=>{var _d=require("path"),wd=ea(),_a=ga(),bd=Cs(),Cd=As(),vd=Xr();function wa(n,e,t){return t===e.length?Promise.resolve():Promise.resolve(n(e[t++])).then(()=>wa(n,e,t))}var Ss=class{constructor(){this._streamTypes={"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.commentsExtended+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.header+xml":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":!0,"application/vnd.openxmlformats-package.relationships+xml":!0},this._headerTypes={"http://schemas.openxmlformats.org/officeDocument/2006/relationships/header":!0,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer":!0},this._actions={},this._defaults={}}shouldProcess(e){if(this._actions[e])return!0;let t=_d.posix.extname(e).replace(/^\./,"");if(!t)return!1;let r=this._defaults[t];return!!(r&&this._streamTypes[r])}openArchive(e){if(bd.isBufferReader(e))return new Promise((t,r)=>{_a.fromBuffer(e.buffer(),{lazyEntries:!0},function(s,i){if(s)return r(s);t(i)})});if(Cd.isFileReader(e))return new Promise((t,r)=>{_a.fromFd(e.fd(),{lazyEntries:!0,autoClose:!1},function(s,i){if(s)return r(s);t(i)})});throw new Error("Unexpected reader type: "+e.constructor.name)}processEntries(e){let t={},r=[];return new Promise((s,i)=>{e.readEntry(),e.on("error",i),e.on("entry",o=>{let a=o.fileName;t[a]=o,r.push(a),e.readEntry()}),e.on("end",()=>s(this._document))}).then(()=>{let s=r.indexOf("[Content_Types].xml");if(s===-1)throw new Error("Invalid Open Office XML: missing content types");return r.splice(s,1),r.unshift("[Content_Types].xml"),this._actions["[Content_Types].xml"]=!0,wa(i=>{if(this.shouldProcess(i))return this.handleEntry(e,t[i])},r,0)})}extract(e){let t=this.openArchive(e);return this._document=new vd,this._relationships={},this._entryTable={},this._entries=[],t.then(r=>this.processEntries(r)).then(()=>{let r=this._document;return r._textboxes&&r._textboxes.length>0&&(r._textboxes=r._textboxes+`
`),r._headerTextboxes&&r._headerTextboxes.length>0&&(r._headerTextboxes=r._headerTextboxes+`
`),r})}handleOpenTag(e){if(e.name==="Override"){let t=this._streamTypes[e.attributes.ContentType];if(t){let r=e.attributes.PartName.replace(/^[/]+/,""),s={action:t,type:e.attributes.ContentType};this._actions[r]=s}}else if(e.name==="Default"){let t=e.attributes.Extension,r=e.attributes.ContentType;this._defaults[t]=r}else if(e.name==="Relationship")this._relationships[e.attributes.Id]={type:e.attributes.Type,target:e.attributes.Target};else if(e.name==="w:document"||e.name==="w:footnotes"||e.name==="w:endnotes"||e.name==="w:comments")this._context=["content","body"],this._pieces=[];else if(e.name==="w:hdr"||e.name==="w:ftr")this._context=["content","header"],this._pieces=[];else if(e.name==="w:endnote"||e.name==="w:footnote"){let t=e.attributes["w:type"]||this._context[0];this._context.unshift(t)}else e.name==="w:tab"&&this._context[0]==="content"?this._pieces.push("	"):e.name==="w:br"&&this._context[0]==="content"?(e.attributes["w:type"]||"")==="page"?this._pieces.push(`
`):this._pieces.push(`
`):e.name==="w:del"||e.name==="w:instrText"?this._context.unshift("deleted"):e.name==="w:tabs"?this._context.unshift("tabs"):e.name==="w:tc"?this._context.unshift("cell"):e.name==="w:drawing"?this._context.unshift("drawing"):e.name==="w:txbxContent"&&(this._context.unshift(this._pieces),this._context.unshift("textbox"),this._pieces=[])}handleCloseTag(e){if(e.name==="w:document")this._context=null,this._document._body=this._pieces.join("");else if(e.name==="w:footnote"||e.name==="w:endnote")this._context.shift();else if(e.name==="w:footnotes")this._context=null,this._document._footnotes=this._pieces.join("");else if(e.name==="w:endnotes")this._context=null,this._document._endnotes=this._pieces.join("");else if(e.name==="w:comments")this._context=null,this._document._annotations=this._pieces.join("");else if(e.name==="w:hdr")this._context=null,this._document._headers=this._document._headers+this._pieces.join("");else if(e.name==="w:ftr")this._context=null,this._document._footers=this._document._footers+this._pieces.join("");else if(e.name==="w:p")(this._context[0]==="content"||this._context[0]==="cell"||this._context[0]==="textbox")&&this._pieces.push(`
`);else if(e.name==="w:del"||e.name==="w:instrText")this._context.shift();else if(e.name==="w:tabs")this._context.shift();else if(e.name==="w:tc")this._pieces.pop(),this._pieces.push("	"),this._context.shift();else if(e.name==="w:tr")this._pieces.push(`
`);else if(e.name==="w:drawing")this._context.shift();else if(e.name==="w:txbxContent"){let t=this._pieces.join("");if(this._context.shift()!=="textbox")throw new Error("Invalid textbox context");if(this._pieces=this._context.shift(),this._context[0]==="drawing"||t.length==0)return;let i=this._context.includes("header")?"_headerTextboxes":"_textboxes";this._document[i]?this._document[i]=this._document[i]+`
`+t:this._document[i]=t}}createXmlParser(){let e=new wd.SaxesParser;return e.on("opentag",t=>{try{this.handleOpenTag(t)}catch(r){e.fail(r.message)}}),e.on("closetag",t=>{try{this.handleCloseTag(t)}catch(r){e.fail(r.message)}}),e.on("text",t=>{try{if(!this._context)return;(this._context[0]==="content"||this._context[0]==="cell"||this._context[0]==="textbox")&&this._pieces.push(t)}catch(r){e.fail(r.message)}}),e}handleEntry(e,t){return new Promise((r,s)=>{e.openReadStream(t,(i,o)=>{if(i)return s(i);this._source=t.fileName;let a=this.createXmlParser();a.on("error",l=>{o.destroy(l),s(l)}),a.on("end",()=>r()),o.on("end",()=>a.close()),o.on("error",l=>s(l)),o.on("readable",()=>{for(;;){let l=o.read(4096);if(l===null)return;a.write(l)}})})})}};ba.exports=Ss});var Aa=k((Hp,Ea)=>{var{Buffer:va}=require("buffer"),Ed=Eo(),Ad=Ca(),Sd=Cs(),Pd=As(),Ps=class{constructor(){}extract(e){let t=null;va.isBuffer(e)?t=new Sd(e):typeof e=="string"&&(t=new Pd(e));let r=va.alloc(512);return t.open().then(()=>t.read(r,0,512,0)).then(s=>{let i=null;if(s.readUInt16BE(0)===53455)i=Ed;else if(s.readUInt16BE(0)===20555){let o=s.readUInt16BE(2);(o===772||o===1286||o===1800)&&(i=Ad)}if(!i)throw new Error("Unable to read this type of file");return new i().extract(t)}).finally(()=>t.close())}};Ea.exports=Ps});var ks=k((nm,Ds)=>{"use strict";var Ns=(()=>{var n=Object.defineProperty,e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(g,_,b)=>_ in g?n(g,_,{enumerable:!0,configurable:!0,writable:!0,value:b}):g[_]=b,a=(g,_)=>{for(var b in _||(_={}))s.call(_,b)&&o(g,b,_[b]);if(r)for(var b of r(_))i.call(_,b)&&o(g,b,_[b]);return g},l=(g,_)=>{for(var b in _)n(g,b,{get:_[b],enumerable:!0})},c=(g,_,b,I)=>{if(_&&typeof _=="object"||typeof _=="function")for(let P of t(_))!s.call(g,P)&&P!==b&&n(g,P,{get:()=>_[P],enumerable:!(I=e(_,P))||I.enumerable});return g},u=g=>c(n({},"__esModule",{value:!0}),g),d=(g,_,b)=>(o(g,typeof _!="symbol"?_+"":_,b),b),f={};l(f,{DEFAULT_OPTIONS:()=>m,DEFAULT_UUID_LENGTH:()=>h,default:()=>y});var p="5.0.3",h=6,m={dictionary:"alphanum",shuffle:!0,debug:!1,length:h,counter:0},x=class{constructor(_={}){d(this,"counter"),d(this,"debug"),d(this,"dict"),d(this,"version"),d(this,"dictIndex",0),d(this,"dictRange",[]),d(this,"lowerBound",0),d(this,"upperBound",0),d(this,"dictLength",0),d(this,"uuidLength"),d(this,"_digit_first_ascii",48),d(this,"_digit_last_ascii",58),d(this,"_alpha_lower_first_ascii",97),d(this,"_alpha_lower_last_ascii",123),d(this,"_hex_last_ascii",103),d(this,"_alpha_upper_first_ascii",65),d(this,"_alpha_upper_last_ascii",91),d(this,"_number_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii]}),d(this,"_alpha_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),d(this,"_alpha_lower_dict_ranges",{lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),d(this,"_alpha_upper_dict_ranges",{upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),d(this,"_alphanum_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),d(this,"_alphanum_lower_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]}),d(this,"_alphanum_upper_dict_ranges",{digits:[this._digit_first_ascii,this._digit_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]}),d(this,"_hex_dict_ranges",{decDigits:[this._digit_first_ascii,this._digit_last_ascii],alphaDigits:[this._alpha_lower_first_ascii,this._hex_last_ascii]}),d(this,"_dict_ranges",{_number_dict_ranges:this._number_dict_ranges,_alpha_dict_ranges:this._alpha_dict_ranges,_alpha_lower_dict_ranges:this._alpha_lower_dict_ranges,_alpha_upper_dict_ranges:this._alpha_upper_dict_ranges,_alphanum_dict_ranges:this._alphanum_dict_ranges,_alphanum_lower_dict_ranges:this._alphanum_lower_dict_ranges,_alphanum_upper_dict_ranges:this._alphanum_upper_dict_ranges,_hex_dict_ranges:this._hex_dict_ranges}),d(this,"log",(...w)=>{let E=[...w];if(E[0]=`[short-unique-id] ${w[0]}`,this.debug===!0&&typeof console!="undefined"&&console!==null)return console.log(...E)}),d(this,"setDictionary",(w,E)=>{let A;if(w&&Array.isArray(w)&&w.length>1)A=w;else{A=[];let D;this.dictIndex=D=0;let M=`_${w}_dict_ranges`,J=this._dict_ranges[M];Object.keys(J).forEach(_e=>{let kr=_e;for(this.dictRange=J[kr],this.lowerBound=this.dictRange[0],this.upperBound=this.dictRange[1],this.dictIndex=D=this.lowerBound;this.lowerBound<=this.upperBound?D<this.upperBound:D>this.upperBound;this.dictIndex=this.lowerBound<=this.upperBound?D+=1:D-=1)A.push(String.fromCharCode(this.dictIndex))})}E&&(A=A.sort(()=>Math.random()-.5)),this.dict=A,this.dictLength=this.dict.length,this.setCounter(0)}),d(this,"seq",()=>this.sequentialUUID()),d(this,"sequentialUUID",()=>{let w,E,A="";w=this.counter;do E=w%this.dictLength,w=Math.trunc(w/this.dictLength),A+=this.dict[E];while(w!==0);return this.counter+=1,A}),d(this,"rnd",(w=this.uuidLength||h)=>this.randomUUID(w)),d(this,"randomUUID",(w=this.uuidLength||h)=>{let E,A,D;if(w===null||typeof w=="undefined"||w<1)throw new Error("Invalid UUID Length Provided");let M=w>=0;for(E="",D=0;D<w;D+=1)A=parseInt((Math.random()*this.dictLength).toFixed(0),10)%this.dictLength,E+=this.dict[A];return E}),d(this,"fmt",(w,E)=>this.formattedUUID(w,E)),d(this,"formattedUUID",(w,E)=>{let A={$r:this.randomUUID,$s:this.sequentialUUID,$t:this.stamp};return w.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,M=>{let J=M.slice(0,2),_e=parseInt(M.slice(2),10);return J==="$s"?A[J]().padStart(_e,"0"):J==="$t"&&E?A[J](_e,E):A[J](_e)})}),d(this,"availableUUIDs",(w=this.uuidLength)=>parseFloat(Math.pow([...new Set(this.dict)].length,w).toFixed(0))),d(this,"approxMaxBeforeCollision",(w=this.availableUUIDs(this.uuidLength))=>parseFloat(Math.sqrt(Math.PI/2*w).toFixed(20))),d(this,"collisionProbability",(w=this.availableUUIDs(this.uuidLength),E=this.uuidLength)=>parseFloat((this.approxMaxBeforeCollision(w)/this.availableUUIDs(E)).toFixed(20))),d(this,"uniqueness",(w=this.availableUUIDs(this.uuidLength))=>{let E=parseFloat((1-this.approxMaxBeforeCollision(w)/w).toFixed(20));return E>1?1:E<0?0:E}),d(this,"getVersion",()=>this.version),d(this,"stamp",(w,E)=>{let A=Math.floor(+(E||new Date)/1e3).toString(16);if(typeof w=="number"&&w===0)return A;if(typeof w!="number"||w<10)throw new Error(["Param finalLength must be a number greater than or equal to 10,","or 0 if you want the raw hexadecimal timestamp"].join(`
`));let D=w-9,M=Math.round(Math.random()*(D>15?15:D)),J=this.randomUUID(D);return`${J.substring(0,M)}${A}${J.substring(M)}${M.toString(16)}`}),d(this,"parseStamp",(w,E)=>{if(E&&!/t0|t[1-9]\d{1,}/.test(E))throw new Error("Cannot extract date from a formated UUID with no timestamp in the format");let A=E?E.replace(/\$[rs]\d{0,}|\$t0|\$t[1-9]\d{1,}/g,M=>{let J={$r:rn=>[...Array(rn)].map(()=>"r").join(""),$s:rn=>[...Array(rn)].map(()=>"s").join(""),$t:rn=>[...Array(rn)].map(()=>"t").join("")},_e=M.slice(0,2),kr=parseInt(M.slice(2),10);return J[_e](kr)}).replace(/^(.*?)(t{8,})(.*)$/g,(M,J,_e)=>w.substring(J.length,J.length+_e.length)):w;if(A.length===8)return new Date(parseInt(A,16)*1e3);if(A.length<10)throw new Error("Stamp length invalid");let D=parseInt(A.substring(A.length-1),16);return new Date(parseInt(A.substring(D,D+8),16)*1e3)}),d(this,"setCounter",w=>{this.counter=w});let b=a(a({},m),_);this.counter=0,this.debug=!1,this.dict=[],this.version=p;let{dictionary:I,shuffle:P,length:j,counter:V}=b;return this.uuidLength=j,this.setDictionary(I,P),this.setCounter(V),this.debug=b.debug,this.log(this.dict),this.log(`Generator instantiated with Dictionary Size ${this.dictLength} and counter set to ${this.counter}`),this.log=this.log.bind(this),this.setDictionary=this.setDictionary.bind(this),this.setCounter=this.setCounter.bind(this),this.seq=this.seq.bind(this),this.sequentialUUID=this.sequentialUUID.bind(this),this.rnd=this.rnd.bind(this),this.randomUUID=this.randomUUID.bind(this),this.fmt=this.fmt.bind(this),this.formattedUUID=this.formattedUUID.bind(this),this.availableUUIDs=this.availableUUIDs.bind(this),this.approxMaxBeforeCollision=this.approxMaxBeforeCollision.bind(this),this.collisionProbability=this.collisionProbability.bind(this),this.uniqueness=this.uniqueness.bind(this),this.getVersion=this.getVersion.bind(this),this.stamp=this.stamp.bind(this),this.parseStamp=this.parseStamp.bind(this),this}};d(x,"default",x);var y=x;return u(f)})();typeof Ds!="undefined"&&(Ds.exports=Ns.default),typeof window!="undefined"&&(Ns=Ns.default)});var hp={};Zi(hp,{default:()=>Dr});module.exports=Yc(hp);var N=require("obsidian");var Fn,Qc=new Uint8Array(16);function Mr(){if(!Fn&&(Fn=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fn(Qc)}var X=[];for(let n=0;n<256;++n)X.push((n+256).toString(16).slice(1));function to(n,e=0){return X[n[e+0]]+X[n[e+1]]+X[n[e+2]]+X[n[e+3]]+"-"+X[n[e+4]]+X[n[e+5]]+"-"+X[n[e+6]]+X[n[e+7]]+"-"+X[n[e+8]]+X[n[e+9]]+"-"+X[n[e+10]]+X[n[e+11]]+X[n[e+12]]+X[n[e+13]]+X[n[e+14]]+X[n[e+15]]}var Zc=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ur={randomUUID:Zc};function eu(n,e,t){if(Ur.randomUUID&&!e&&!n)return Ur.randomUUID();n=n||{};let r=n.random||(n.rng||Mr)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return to(r)}var Te=eu;var Ia=Lr(Aa()),tt=require("obsidian");var kt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF1ZWd3aG55Y2Z2Y2Jsb3VjbWh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTc4MTkzMTIsImV4cCI6MjAxMzM5NTMxMn0.q2GoWOzLHecS8wS8GlpFTxN6kzcIE-Xx4KS7Jkr7-30",Yn="auegwhnycfvcbloucmhv.supabase.co",Sa="Use the content in 'input' as the main context, consider the 'additional_context' map for related information, and respond based on the instructions in 'user_prompt'. Assist the user by synthesizing information from these elements into coherent and useful insights or actions.",fn="\u{1F4C4}\u2194\u{1F916}",Pa={apiKey:"",advancedOptions:!1,previewMode:!1,entityRecognition:!1,generateEmbeddings:!1,wikify:[],canvasResolveLinks:!1,canvasResolveBacklinks:!1,useOpenAi:!1,developmentMode:!1,llmOptions:{temperature:.8,max_tokens:2e3},timeoutMins:5,openAiSettings:{apiKey:"",modelId:""},azureAiSettings:{apiKey:"",deploymentId:"",endpoint:""},provider:"openai",registeredFlows:[]},Rs=`---
system_instructions: You are a helpful assistant.
resolveBacklinks: true
resolveForwardLinks: true
exclusionPattern: ["^Private/", ".*-confidential.*"]
---

Say hello to the user.
`,Ra={nodes:[{id:"9ca0dce906eb2b17",type:"file",file:"CloudAtlas/example/user.md",x:-80,y:-220,width:340,height:120,color:"1"},{id:"bdda4ed7429cf432",x:-391,y:-201,width:222,height:82,color:"2",type:"file",file:"CloudAtlas/example/user_prompt.md"},{id:"5641ca8bb2160e07",type:"file",file:"CloudAtlas/example/additional context.md",x:-55,y:-460,width:290,height:100,color:"4"},{id:"9faa2aea9699bf3f",x:-53,y:20,width:288,height:147,color:"5",type:"file",file:"CloudAtlas/example/system.md"}],edges:[{id:"89a5ba1776cd58a5",fromNode:"5641ca8bb2160e07",fromSide:"bottom",toNode:"9ca0dce906eb2b17",toSide:"top"},{id:"4864dab35edffc85",fromNode:"9faa2aea9699bf3f",fromSide:"top",toNode:"9ca0dce906eb2b17",toSide:"bottom"},{id:"6a6497073b3e0475",fromNode:"bdda4ed7429cf432",fromSide:"right",toNode:"9ca0dce906eb2b17",toSide:"left"}]};var Ta="/";function he(n,e){let t=e.vault.getAbstractFileByPath(n);if(t instanceof tt.TFile)return t;throw new Error(`The path ${n} does not refer to a valid file.`)}async function Fa(n,e){try{return await e.metadataCache.getBacklinksForFile(n)}catch(t){return new tt.Notice("Backlink resolution failed. Consider installing the Backlink Cache Plugin."),{}}}function Oa(n,e){if(!n){if(!e)throw new Error("No base or override payload");return e}if(!e)return n;let t={};Object.assign(t,n.user.additional_context),Object.assign(t,e.user.additional_context);let r=Qn(n.user.input,e.user.input);return{user:{user_prompt:Qn(n.user.user_prompt,e.user.user_prompt),input:r,additional_context:t},system:e.system||n.system,options:e.options||n.options,provider:e.provider||n.provider,llmOptions:e.llmOptions||n.llmOptions,requestId:e.requestId||n.requestId}}function Qn(n,e){return[n,e].filter(t=>t).join(`
`)}async function Ts(n){try{let e=await this.app.vault.readBinary(this.app.vault.getFileByPath(n)),t=Buffer.from(e).toString("base64");return n.endsWith(".jpg")||n.endsWith(".jpeg")?`data:image/jpeg;base64,${t}`:n.endsWith(".gif")?`data:image/gif;base64,${t}`:`data:image/png;base64,${t}`}catch(e){return console.debug("Error reading image file",n,e),""}}function Is(n){return n.endsWith(".png")||n.endsWith(".jpg")||n.endsWith(".jpeg")||n.endsWith(".gif")}function Na(n){return n.endsWith(".flowrun.md")}function Da(n){return n.endsWith(".flow.canvas")}function ka(n){return n.endsWith(".docx")||n.endsWith(".doc")}function Rd(n){return n.endsWith(".md")}function La(n){return!(Is(n)&&!Rd(n))}async function Ma(n,e){try{return(await new Ia.default().extract((0,tt.normalizePath)([n,e].join(Ta)))).getBody()}catch(t){return console.debug("Error reading word file",(0,tt.normalizePath)([n,e].join(Ta)),t),null}}async function Ua(n){try{return await this.app.vault.cachedRead(this.app.vault.getFileByPath(n))}catch(e){return console.debug("Error reading file",n,e),null}}async function Ba(n,e,t){return await fetch(`https://${Yn}/rest/v1/apikeys_flows`,{headers:{apikey:kt,Authorization:`Bearer ${kt}`,"Content-Type":"application/json","x-api-key":n},body:JSON.stringify({api_key:n,flow:e,payload:t}),method:"POST"})}function Fs(n){return!!n.file}function Lt(n,e,t,r,s){return{id:Te(),type:"text",text:n,x:e||0,y:t||0,width:s||200,height:r||200,color:void 0}}var hn=(n,e)=>e.filter(t=>Td(t)===n),Os=n=>hn(0,n);var Td=n=>{if(n.color=="1")return 0;if(n.color=="2")return 3;if(n.color=="5")return 1;if(n.color=="4")return 2},$a=n=>{var u,d,f;let e=[],t=[],r,s,i;if((u=n.user)!=null&&u.input&&(s=Lt(n.user.input,600,500),s.color="1",e.push(s)),(d=n.user)!=null&&d.user_prompt&&(r=Lt(n.user.user_prompt,500,750),r.color="2",e.push(r)),r&&s){let p={id:Te(),fromNode:r.id,fromSide:"top",toNode:s.id,toSide:"bottom"};t.push(p)}if(n.system&&(i=Lt(n.system,500,250),i.color="5",e.push(i)),i&&s){let p={id:Te(),fromNode:i.id,fromSide:"bottom",toNode:s.id,toSide:"top"};t.push(p)}let o=[],a=250,l=350;(f=n.user)!=null&&f.additional_context&&Object.keys(n.user.additional_context).forEach((p,h)=>{let m=Lt(n.user.additional_context[p],a,l);m.color="4",o.push(m),e.push(m),a+=25,l+=25});let c=[];return s&&o.forEach(p=>{let h={id:Te(),fromNode:p.id,fromSide:"right",toNode:s.id,toSide:"left"};c.push(h),t.push(h)}),{nodes:e,edges:t}};var Nr=Lr(ks()),Wc=require("@codemirror/view");var U=require("obsidian"),Zn=class extends U.PluginSettingTab{constructor(t,r){super(t,r);this.wikifySetting=(t,r)=>{new U.Setting(t).setName(r).setDesc("Convert entity names into wikilinks.").addToggle(s=>s.setValue(this.plugin.settings.wikify.includes(r)).onChange(async i=>{i?this.plugin.settings.wikify.push(r):this.plugin.settings.wikify=this.plugin.settings.wikify.filter(o=>o!==r),console.log(this.plugin.settings.wikify),await this.plugin.saveSettings()}))};this.plugin=r}display(){let{containerEl:t}=this;t.empty(),new U.Setting(t).setName("Provider").setDesc("Choose the LLM provider").addDropdown(r=>{r.addOption("openai","OpenAI"),r.addOption("cloudatlas","Cloud Atlas"),r.setValue(this.plugin.settings.provider),r.onChange(async s=>{this.plugin.settings.provider=s,this.display(),await this.plugin.saveSettings()})}),this.plugin.settings.provider==="openai"&&(t.createEl("h2",{text:"OpenAI"}),new U.Setting(t).setName("OpenAI API Key").setDesc("Provision an API key at https://platform.openai.com/api-keys.").addText(r=>r.setPlaceholder("Enter OpenAI API key").setValue(this.plugin.settings.openAiSettings.apiKey.substring(0,8)+"...").onChange(async s=>{this.plugin.settings.openAiSettings.apiKey=s,await this.plugin.saveSettings()})),new U.Setting(t).setName("Model ID").setDesc("Open AI model ID, for example 'gpt-4-vision-preview'").addText(r=>{r.setValue(this.plugin.settings.openAiSettings.modelId).onChange(async s=>{this.plugin.settings.openAiSettings.modelId=s,await this.plugin.saveSettings()})})),this.plugin.settings.provider==="azureai"&&(t.createEl("h2",{text:"AzureAI"}),new U.Setting(t).setName("AzureAI API Key").setDesc("Get it from the 'Keys & Endpoint' section, visible when viewing a resource on Azure Portal'").addText(r=>r.setPlaceholder("Enter AzureAi API key").setValue(this.plugin.settings.azureAiSettings.apiKey.substring(0,8)+"...").onChange(async s=>{this.plugin.settings.azureAiSettings.apiKey=s,await this.plugin.saveSettings()})),new U.Setting(t).setName("Deployment ID").setDesc("Azure AI deployment ID, can be found at https://oai.azure.com/, under 'Management -> Deployments'").addText(r=>{r.setValue(this.plugin.settings.azureAiSettings.deploymentId).onChange(async s=>{this.plugin.settings.azureAiSettings.deploymentId=s,await this.plugin.saveSettings()})}),new U.Setting(t).setName("Endpoint").setDesc("Azure AI endpoint, found under the 'Keys & Endpoint' when viewing a resource on Azure Portal").addText(r=>{r.setValue(this.plugin.settings.azureAiSettings.endpoint).onChange(async s=>{this.plugin.settings.azureAiSettings.endpoint=s,await this.plugin.saveSettings()})})),this.plugin.settings.provider==="cloudatlas"&&(t.createEl("h2",{text:"Cloud Atlas"}),new U.Setting(t).setName("Cloud Atlas API Key").setDesc("Use Cloud Atlas backend service").addText(r=>r.setPlaceholder("Enter API key").setValue(this.plugin.settings.apiKey.substring(0,8)+"...").onChange(async s=>{this.plugin.settings.apiKey=s,await this.plugin.saveSettings()})),new U.Setting(t).setName("Preview mode").setDesc("Use unstable API with more features and less stability.").addToggle(r=>r.setValue(this.plugin.settings.previewMode).onChange(async s=>{this.plugin.settings.previewMode=s,await this.plugin.saveSettings()})),new U.Setting(t).setName("Use OpenAI").setDesc("We use AzureAI by default, this will use OpenAI, models are identical, so there should not be a meaningful difference in results.").addToggle(r=>r.setValue(this.plugin.settings.useOpenAi).onChange(async s=>{this.plugin.settings.useOpenAi=s,await this.plugin.saveSettings()}))),new U.Setting(t).setName("Advanced Options").setDesc("Show advanced options.").addToggle(r=>{r.setValue(this.plugin.settings.advancedOptions).onChange(async s=>{this.plugin.settings.advancedOptions=s,this.display(),await this.plugin.saveSettings()})}),this.plugin.settings.advancedOptions&&(t.createEl("h2",{text:"LLM"}),new U.Setting(t).setName("LLM temperature").setDesc('Set default temperature for the LLM, the higher the temperature the more "creative" the LLM will be, default is usually around 0.8.').addText(r=>{var s;return r.setValue(((s=this.plugin.settings.llmOptions.temperature)==null?void 0:s.toString())||"0.8").onChange(async i=>{this.plugin.settings.llmOptions.temperature=Number(i),await this.plugin.saveSettings()})}),new U.Setting(t).setName("LLM max response tokens").setDesc("Set maximum tokens returned in the response, defaults to 2000, and maximum is 4096.").addText(r=>{var s;return r.setValue(((s=this.plugin.settings.llmOptions.max_tokens)==null?void 0:s.toString())||"2000").onChange(async i=>{let o=Number(i)>4096?4096:Number(i);this.plugin.settings.llmOptions.max_tokens=o,await this.plugin.saveSettings()})}),this.plugin.settings.provider==="cloudatlas"&&(new U.Setting(t).setName("Timeout minutes").setDesc("How many minutes to wait for the results from server side processing. Obsidian will poll the server every 5 seconds, until results are returned or timeout is reached, defaults to 5 minutes.").addText(i=>i.setValue(this.plugin.settings.timeoutMins.toString()).onChange(async o=>{this.plugin.settings.timeoutMins=Number(o),await this.plugin.saveSettings()})),t.createEl("h2",{text:"Canvas flows"}),new U.Setting(t).setName("Resolve links").setDesc("Adds resolved links as additional prompt context, specific to canvas flows.").addToggle(i=>i.setValue(this.plugin.settings.canvasResolveLinks).onChange(async o=>{this.plugin.settings.canvasResolveLinks=o,await this.plugin.saveSettings()})),new U.Setting(t).setName("Resolve backlinks").setDesc("Adds resolved backlinks as additional prompt context, specific to canvas flows.").addToggle(i=>i.setValue(this.plugin.settings.canvasResolveBacklinks).onChange(async o=>{this.plugin.settings.canvasResolveBacklinks=o,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Development"}),new U.Setting(t).setName("Development mode").setDesc("Redirects requests to http://localhost:8787").addToggle(i=>i.setValue(this.plugin.settings.developmentMode).onChange(async o=>{this.plugin.settings.developmentMode=o,await this.plugin.saveSettings()})),t.createEl("h2",{text:"Register commands"}),this.app.vault.getMarkdownFiles().filter(i=>i.path.startsWith("CloudAtlas/")&&i.path.endsWith(".flow.md")).forEach(i=>{let o=i.path.split("/")[1].split(".flow.md")[0];new U.Setting(t).setName(o).setDesc(`Register ${o} command`).addToggle(a=>{a.setValue(this.plugin.settings.registeredFlows.indexOf(o)>-1).onChange(async l=>{l?this.plugin.settings.registeredFlows.push(o):this.plugin.settings.registeredFlows=this.plugin.settings.registeredFlows.filter(c=>c!==o),await this.plugin.saveSettings()})})})))}};var ja=["admiring","adoring","affectionate","agitated","amazing","angry","awesome","blissful","boring","brave","clever","cocky","compassionate","competent","condescending","confident","cranky","dazzling","determined","distracted","dreamy","eager","ecstatic","elastic","elated","elegant","eloquent","epic","fervent","festive","flamboyant","focused","friendly","frosty","gallant","gifted","goofy","gracious","happy","hardcore","heuristic","hopeful","hungry","infallible","inspiring","jolly","jovial","keen","kind","laughing","loving","lucid","mystifying","modest","musing","naughty","nervous","nifty","nostalgic","objective","optimistic","peaceful","pedantic","pensive","practical","priceless","quirky","quizzical","relaxed","reverent","romantic","sad","serene","sharp","silly","sleepy","stoic","stupefied","suspicious","tender","thirsty","trusting","unruffled","upbeat","vibrant","vigilant","vigorous","wizardly","wonderful","xenodochial","youthful","zealous","zen"],za=["albattani","allen","almeida","agnesi","archimedes","ardinghelli","aryabhata","austin","babbage","banach","bardeen","bartik","bassi","beaver","bell","benz","bhabha","bhaskara","blackwell","bohr","booth","borg","bose","boyd","brahmagupta","brattain","brown","carson","chandrasekhar","shannon","clarke","colden","cori","cray","curran","curie","darwin","davinci","dijkstra","dubinsky","easley","edison","einstein","elion","engelbart","euclid","euler","fermat","fermi","feynman","franklin","galileo","gates","goldberg","goldstine","goldwasser","golick","goodall","haibt","hamilton","hawking","heisenberg","hermann","heyrovsky","hodgkin","hoover","hopper","hugle","hypatia","jackson","jang","jennings","jepsen","johnson","joliot","jones","kalam","kare","keller","kepler","khorana","kilby","kirch","knuth","kowalevski","lalande","lamarr","lamport","leakey","leavitt","lewin","lichterman","liskov","lovelace","lumiere","mahavira","mayer","mccarthy","mcclintock","mclean","mcnulty","meitner","meninsky","mestorf","minsky","mirzakhani","morse","murdock","neumann","newton","nightingale","nobel","noether","northcutt","noyce","panini","pare","pasteur","payne","perlman","pike","poincare","poitras","ptolemy","raman","ramanujan","ride","montalcini","ritchie","roentgen","rosalind","saha","sammet","shaw","shirley","shockley","sinoussi","snyder","spence","stallman","stonebraker","swanson","swartz","swirles","tesla","thompson","torvalds","turing","varahamihira","visvesvaraya","volhard","wescoff","wiles","williams","wilson","wing","wozniak","wright","yalow","yonath"],qa=n=>Math.floor(Math.random()*(n+1)),Ha=()=>ja[qa(ja.length)]+"-"+za[qa(za.length)];var nt="4.28.4";var Wa=!1,rt,Ls,Id,Fd,Od,Ms,Nd,er,Us,Bs,$s,tr,js;function Va(n,e={auto:!1}){if(Wa)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(rt)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${rt}'\``);Wa=e.auto,rt=n.kind,Ls=n.fetch,Id=n.Request,Fd=n.Response,Od=n.Headers,Ms=n.FormData,Nd=n.Blob,er=n.File,Us=n.ReadableStream,Bs=n.getMultipartRequestOptions,$s=n.getDefaultAgent,tr=n.fileFromPath,js=n.isFsReadStream}var nr=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Xa({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData!="undefined"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob!="undefined"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File!="undefined"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream!="undefined"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new nr(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}rt||Va(Xa(),{auto:!0});var zs={};Zi(zs,{APIConnectionError:()=>Ce,APIConnectionTimeoutError:()=>ve,APIError:()=>q,APIUserAbortError:()=>ee,AuthenticationError:()=>Ut,BadRequestError:()=>Mt,ConflictError:()=>jt,InternalServerError:()=>Ht,NotFoundError:()=>$t,OpenAIError:()=>v,PermissionDeniedError:()=>Bt,RateLimitError:()=>qt,UnprocessableEntityError:()=>zt});var v=class extends Error{},q=class n extends v{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s;let i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){let s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new Ce({cause:rr(t)});let i=t==null?void 0:t.error;return e===400?new Mt(e,i,r,s):e===401?new Ut(e,i,r,s):e===403?new Bt(e,i,r,s):e===404?new $t(e,i,r,s):e===409?new jt(e,i,r,s):e===422?new zt(e,i,r,s):e===429?new qt(e,i,r,s):e>=500?new Ht(e,i,r,s):new n(e,i,r,s)}},ee=class extends q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Ce=class extends q{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},ve=class extends Ce{constructor({message:e}={}){super({message:e!=null?e:"Request timed out."})}},Mt=class extends q{constructor(){super(...arguments),this.status=400}},Ut=class extends q{constructor(){super(...arguments),this.status=401}},Bt=class extends q{constructor(){super(...arguments),this.status=403}},$t=class extends q{constructor(){super(...arguments),this.status=404}},jt=class extends q{constructor(){super(...arguments),this.status=409}},zt=class extends q{constructor(){super(...arguments),this.status=422}},qt=class extends q{constructor(){super(...arguments),this.status=429}},Ht=class extends q{};var st=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,s=new qs;async function*i(){if(!e.body)throw t.abort(),new v("Attempted to iterate over a response with no body");let a=new Wt,l=Ka(e.body);for await(let c of l)for(let u of a.decode(c)){let d=s.decode(u);d&&(yield d)}for(let c of a.flush()){let u=s.decode(c);u&&(yield u)}}async function*o(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let l of i())if(!a){if(l.data.startsWith("[DONE]")){a=!0;continue}if(l.event===null){let c;try{c=JSON.parse(l.data)}catch(u){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),u}if(c&&c.error)throw new q(void 0,c.error,void 0,void 0);yield c}}a=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{a||t.abort()}}return new n(o,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let o=new Wt,a=Ka(e);for await(let l of a)for(let c of o.decode(l))yield c;for(let l of o.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let a of s())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||t.abort()}}return new n(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Us({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:o}=await t.next();if(o)return s.close();let a=r.encode(JSON.stringify(i)+`
`);s.enqueue(a)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}},qs=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=kd(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},Wt=class n{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=n.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(n.NEWLINE_REGEXP);return s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){var t;if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer!="undefined"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new v(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder!="undefined"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return(t=this.textDecoder)!=null||(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new v(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new v("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};Wt.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);Wt.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function kd(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function Ka(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Ja=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Ld=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Ga(n),Ga=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Md=n=>Ld(n)||Ja(n)||js(n);async function Vs(n,e,t={}){var s,i,o;if(n=await n,Ja(n)){let a=await n.blob();return e||(e=(s=new URL(n.url).pathname.split(/[\\/]/).pop())!=null?s:"unknown_file"),new er([a],e,t)}let r=await Ud(n);if(e||(e=(i=$d(n))!=null?i:"unknown_file"),!t.type){let a=(o=r[0])==null?void 0:o.type;typeof a=="string"&&(t={...t,type:a})}return new er(r,e,t)}async function Ud(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Ga(n))e.push(await n.arrayBuffer());else if(jd(n))for await(let r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Bd(n)}`);return e}function Bd(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function $d(n){var e;return Hs(n.name)||Hs(n.filename)||((e=Hs(n.path))==null?void 0:e.split(/[\\/]/).pop())}var Hs=n=>{if(typeof n=="string")return n;if(typeof Buffer!="undefined"&&n instanceof Buffer)return String(n)},jd=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Xs=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var pe=async n=>{let e=await Ya(n.body);return Bs(e,n)},Ya=async n=>{let e=new Ms;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Ws(e,t,r))),e};var Ws=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Md(t)){let r=await Vs(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Ws(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Ws(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var qd=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Hd=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},sr;async function tl(n){let{response:e}=n;if(n.options.stream)return Vt("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):st.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){let i=await e.json();return Vt("response",e.status,e.url,e.headers,i),i}let s=await e.text();return Vt("response",e.status,e.url,e.headers,s),s}var or=class n extends Promise{constructor(e,t=tl){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},ar=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Ks("maxRetries",t),this.timeout=Ks("timeout",r),this.httpAgent=s,this.fetch=i!=null?i:Ls}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Jd(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Zd()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer!="undefined")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder!="undefined")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){var h,m,x,y,g,_;let{method:t,path:r,query:s,headers:i={}}=e,o=Xs(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(o),l=this.buildURL(r,s);"timeout"in e&&Ks("timeout",e.timeout);let c=(h=e.timeout)!=null?h:this.timeout,u=(x=(m=e.httpAgent)!=null?m:this.httpAgent)!=null?x:$s(l),d=c+1e3;typeof((y=u==null?void 0:u.options)==null?void 0:y.timeout)=="number"&&d>((g=u.options.timeout)!=null?g:0)&&(u.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:e,headers:i,contentLength:a});return{req:{method:t,...o&&{body:o},headers:f,...u&&{agent:u},signal:(_=e.signal)!=null?_:null},url:l,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r}){let s={};r&&(s["content-length"]=r);let i=this.defaultHeaders(e);return el(s,i),el(s,t),Xs(e.body)&&rt!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return q.generate(e,t,r,s)}request(e,t=null){return new or(this.makeRequest(e,t))}async makeRequest(e,t){var u,d,f;let r=await e;t==null&&(t=(u=r.maxRetries)!=null?u:this.maxRetries),await this.prepareOptions(r);let{req:s,url:i,timeout:o}=this.buildRequest(r);if(await this.prepareRequest(s,{url:i,options:r}),Vt("request",i,r,s.headers),(d=r.signal)!=null&&d.aborted)throw new ee;let a=new AbortController,l=await this.fetchWithTimeout(i,s,o,a).catch(rr);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new ee;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new ve:new Ce({cause:l})}let c=Wd(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let g=`retrying, ${t} attempts remaining`;return Vt(`response (error; ${g})`,l.status,i,c),this.retryRequest(r,t,c)}let p=await l.text().catch(g=>rr(g).message),h=Gd(p),m=h?void 0:p;throw Vt(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,c,m),this.makeStatusError(l.status,h,m,c)}return{response:l,options:r,controller:a}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new Js(this,r,e)}buildURL(e,t){let r=Qd(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return nl(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r!="undefined").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new v(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:i,...o}=t||{};i&&i.addEventListener("abort",()=>s.abort());let a=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...o}).finally(()=>{clearTimeout(a)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){var a;let s,i=r==null?void 0:r["retry-after-ms"];if(i){let l=parseFloat(i);Number.isNaN(l)||(s=l)}let o=r==null?void 0:r["retry-after"];if(o&&!s){let l=parseFloat(o);Number.isNaN(l)?s=Date.parse(o)-Date.now():s=l*1e3}if(!(s&&0<=s&&s<60*1e3)){let l=(a=e.maxRetries)!=null?a:this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,l)}return await Gs(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${nt}`}},pn=class{constructor(e,t,r,s){sr.set(this,void 0),qd(this,sr,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new v("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Hd(this,sr,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(sr=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Js=class extends or{constructor(e,t,r){super(t,async s=>new r(e,s.response,await tl(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Wd=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),Vd={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},H=n=>typeof n=="object"&&n!==null&&!nl(n)&&Object.keys(n).every(e=>rl(Vd,e)),Xd=()=>{if(typeof Deno!="undefined"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nt,"X-Stainless-OS":Za(Deno.build.os),"X-Stainless-Arch":Qa(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime!="undefined")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nt,"X-Stainless-OS":Za(process.platform),"X-Stainless-Arch":Qa(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=Kd();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Kd(){if(typeof navigator=="undefined"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${s}.${i}.${o}`}}}return null}var Qa=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Za=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),ir,Jd=()=>ir!=null?ir:ir=Xd(),Gd=n=>{try{return JSON.parse(n)}catch(e){return}},Yd=new RegExp("^(?:[a-z]+:)?//","i"),Qd=n=>Yd.test(n),Gs=n=>new Promise(e=>setTimeout(e,n)),Ks=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new v(`${n} must be an integer`);if(e<0)throw new v(`${n} must be a positive integer`);return e},rr=n=>n instanceof Error?n:new Error(n);var lr=n=>{var e,t,r,s,i,o;if(typeof process!="undefined")return(r=(t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())!=null?r:void 0;if(typeof Deno!="undefined")return(o=(i=(s=Deno.env)==null?void 0:s.get)==null?void 0:i.call(s,n))==null?void 0:o.trim()};function nl(n){if(!n)return!0;for(let e in n)return!1;return!0}function rl(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function el(n,e){for(let t in e){if(!rl(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Vt(n,...e){typeof process!="undefined"&&process.env.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${n}`,...e)}var Zd=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),sl=()=>typeof window!="undefined"&&typeof window.document!="undefined"&&typeof navigator!="undefined";var ke=class extends pn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){return null}nextPageInfo(){return null}},W=class extends pn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){var e;return(e=this.data)!=null?e:[]}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;let e=this.getPaginatedItems();if(!e.length)return null;let t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}};var C=class{constructor(e){this._client=e}};var it=class extends C{create(e,t){var r;return this._client.post("/chat/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};it||(it={});var Le=class extends C{constructor(){super(...arguments),this.completions=new it(this._client)}};(function(n){n.Completions=it})(Le||(Le={}));var ot=class extends C{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}};ot||(ot={});var at=class extends C{create(e,t){return this._client.post("/audio/transcriptions",pe({body:e,...t}))}};at||(at={});var lt=class extends C{create(e,t){return this._client.post("/audio/translations",pe({body:e,...t}))}};lt||(lt={});var Me=class extends C{constructor(){super(...arguments),this.transcriptions=new at(this._client),this.translations=new lt(this._client),this.speech=new ot(this._client)}};(function(n){n.Transcriptions=at,n.Translations=lt,n.Speech=ot})(Me||(Me={}));var ct=class extends C{create(e,t,r){return this._client.post(`/assistants/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e,t={},r){return H(t)?this.list(e,{},t):this._client.getAPIList(`/assistants/${e}/files`,ut,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/assistants/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}},ut=class extends W{};(function(n){n.AssistantFilesPage=ut})(ct||(ct={}));var dt=class extends C{constructor(){super(...arguments),this.files=new ct(this._client)}create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/assistants",ft,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}},ft=class extends W{};(function(n){n.AssistantsPage=ft,n.Files=ct,n.AssistantFilesPage=ut})(dt||(dt={}));function Ys(n){return typeof n.parse=="function"}var Ue=n=>(n==null?void 0:n.role)==="assistant",Qs=n=>(n==null?void 0:n.role)==="function",Zs=n=>(n==null?void 0:n.role)==="tool";var oe=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},S=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},G,cr,ur,mn,gn,dr,xn,Ee,yn,fr,hr,Xt,ei,pr,ti,ni,ri,si,ll,ii,al=10,Kt=class{constructor(){G.add(this),this.controller=new AbortController,cr.set(this,void 0),ur.set(this,()=>{}),mn.set(this,()=>{}),gn.set(this,void 0),dr.set(this,()=>{}),xn.set(this,()=>{}),Ee.set(this,{}),this._chatCompletions=[],this.messages=[],yn.set(this,!1),fr.set(this,!1),hr.set(this,!1),Xt.set(this,!1),si.set(this,e=>{if(oe(this,fr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ee),e instanceof ee)return oe(this,hr,!0,"f"),this._emit("abort",e);if(e instanceof v)return this._emit("error",e);if(e instanceof Error){let t=new v(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new v(String(e)))}),oe(this,cr,new Promise((e,t)=>{oe(this,ur,e,"f"),oe(this,mn,t,"f")}),"f"),oe(this,gn,new Promise((e,t)=>{oe(this,dr,e,"f"),oe(this,xn,t,"f")}),"f"),S(this,cr,"f").catch(()=>{}),S(this,gn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},S(this,si,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Qs(e)||Zs(e))&&e.content)this._emit("functionCallResult",e.content);else if(Ue(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Ue(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(S(this,ur,"f").call(this),this._emit("connect"))}get ended(){return S(this,yn,"f")}get errored(){return S(this,fr,"f")}get aborted(){return S(this,hr,"f")}abort(){this.controller.abort()}on(e,t){return(S(this,Ee,"f")[e]||(S(this,Ee,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=S(this,Ee,"f")[e];if(!r)return this;let s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(S(this,Ee,"f")[e]||(S(this,Ee,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{oe(this,Xt,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){oe(this,Xt,!0,"f"),await S(this,gn,"f")}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new v("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),S(this,G,"m",ei).call(this)}async finalMessage(){return await this.done(),S(this,G,"m",pr).call(this)}async finalFunctionCall(){return await this.done(),S(this,G,"m",ti).call(this)}async finalFunctionCallResult(){return await this.done(),S(this,G,"m",ni).call(this)}async totalUsage(){return await this.done(),S(this,G,"m",ri).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(S(this,yn,"f"))return;e==="end"&&(oe(this,yn,!0,"f"),S(this,dr,"f").call(this));let r=S(this,Ee,"f")[e];if(r&&(S(this,Ee,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!S(this,Xt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),S(this,mn,"f").call(this,s),S(this,xn,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!S(this,Xt,"f")&&!(r!=null&&r.length)&&Promise.reject(s),S(this,mn,"f").call(this,s),S(this,xn,"f").call(this,s),this._emit("end")}}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=S(this,G,"m",pr).call(this);t&&this._emit("finalMessage",t);let r=S(this,G,"m",ei).call(this);r&&this._emit("finalContent",r);let s=S(this,G,"m",ti).call(this);s&&this._emit("finalFunctionCall",s);let i=S(this,G,"m",ni).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",S(this,G,"m",ri).call(this))}async _createChatCompletion(e,t,r){let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),S(this,G,"m",ll).call(this,t);let i=await e.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;let s="function",{function_call:i="auto",stream:o,...a}=t,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:c=al}=r||{},u={};for(let p of t.functions)u[p.name||p.function.name]=p;let d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){let m=(f=(await this._createChatCompletion(e,{...a,function_call:i,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!m)throw new v("missing message in ChatCompletion response");if(!m.function_call)return;let{name:x,arguments:y}=m.function_call,g=u[x];if(g){if(l&&l!==x){let P=`Invalid function_call: ${JSON.stringify(x)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:x,content:P});continue}}else{let P=`Invalid function_call: ${JSON.stringify(x)}. Available options are: ${d.map(j=>JSON.stringify(j.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:x,content:P});continue}let _;try{_=Ys(g)?await g.parse(y):y}catch(P){this._addMessage({role:s,name:x,content:P instanceof Error?P.message:String(P)});continue}let b=await g.function(_,this),I=S(this,G,"m",ii).call(this,b);if(this._addMessage({role:s,name:x,content:I}),l)return}}async _runTools(e,t,r){var f,p;let s="tool",{tool_choice:i="auto",stream:o,...a}=t,l=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:c=al}=r||{},u={};for(let h of t.tools)h.type==="function"&&(u[h.function.name||h.function.function.name]=h.function);let d="tools"in t?t.tools.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description}}:h):void 0;for(let h of t.messages)this._addMessage(h,!1);for(let h=0;h<c;++h){let x=(p=(await this._createChatCompletion(e,{...a,tool_choice:i,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:p.message;if(!x)throw new v("missing message in ChatCompletion response");if(!x.tool_calls)return;for(let y of x.tool_calls){if(y.type!=="function")continue;let g=y.id,{name:_,arguments:b}=y.function,I=u[_];if(I){if(l&&l!==_){let w=`Invalid tool_call: ${JSON.stringify(_)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:g,content:w});continue}}else{let w=`Invalid tool_call: ${JSON.stringify(_)}. Available options are: ${d.map(E=>JSON.stringify(E.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:g,content:w});continue}let P;try{P=Ys(I)?await I.parse(b):b}catch(w){let E=w instanceof Error?w.message:String(w);this._addMessage({role:s,tool_call_id:g,content:E});continue}let j=await I.function(P,this),V=S(this,G,"m",ii).call(this,j);if(this._addMessage({role:s,tool_call_id:g,content:V}),l)return}}}};cr=new WeakMap,ur=new WeakMap,mn=new WeakMap,gn=new WeakMap,dr=new WeakMap,xn=new WeakMap,Ee=new WeakMap,yn=new WeakMap,fr=new WeakMap,hr=new WeakMap,Xt=new WeakMap,si=new WeakMap,G=new WeakSet,ei=function(){var e;return(e=S(this,G,"m",pr).call(this).content)!=null?e:null},pr=function(){var t;let e=this.messages.length;for(;e-- >0;){let r=this.messages[e];if(Ue(r))return{...r,content:(t=r.content)!=null?t:null}}throw new v("stream ended without producing a ChatCompletionMessage with role=assistant")},ti=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){let s=this.messages[r];if(Ue(s)&&(s!=null&&s.function_call))return s.function_call;if(Ue(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ni=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Qs(t)&&t.content!=null||Zs(t)&&t.content!=null&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},ri=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ll=function(e){if(e.n!=null&&e.n>1)throw new v("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ii=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var _n=class n extends Kt{static runFunctions(e,t,r){let s=new n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){let s=new n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),Ue(e)&&e.content&&this._emit("content",e.content)}};var ae=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},oi=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},me,Be,ai,li,mr,cl,Jt=class n extends Kt{constructor(){super(...arguments),me.add(this),Be.set(this,void 0)}get currentChatCompletionSnapshot(){return ae(this,Be,"f")}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var o;let s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),ae(this,me,"m",ai).call(this);let i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let a of i)ae(this,me,"m",li).call(this,a);if((o=i.controller.signal)!=null&&o.aborted)throw new ee;return this._addChatCompletion(ae(this,me,"m",mr).call(this))}async _fromReadableStream(e,t){var o;let r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),ae(this,me,"m",ai).call(this),this._connected();let s=st.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(ae(this,me,"m",mr).call(this)),ae(this,me,"m",li).call(this,a),i=a.id;if((o=s.controller.signal)!=null&&o.aborted)throw new ee;return this._addChatCompletion(ae(this,me,"m",mr).call(this))}[(Be=new WeakMap,me=new WeakSet,ai=function(){this.ended||oi(this,Be,void 0,"f")},li=function(t){var o,a,l;if(this.ended)return;let r=ae(this,me,"m",cl).call(this,t);this._emit("chunk",t,r);let s=(a=(o=t.choices[0])==null?void 0:o.delta)==null?void 0:a.content,i=(l=r.choices[0])==null?void 0:l.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},mr=function(){if(this.ended)throw new v("stream has ended, this shouldn't happen");let t=ae(this,Be,"f");if(!t)throw new v("request ended without sending any chunks");return oi(this,Be,void 0,"f"),af(t)},cl=function(t){var c,u,d,f;var r,s,i;let o=ae(this,Be,"f"),{choices:a,...l}=t;o?Object.assign(o,l):o=oi(this,Be,{...l,choices:[]},"f");for(let{delta:p,finish_reason:h,index:m,logprobs:x=null,...y}of t.choices){let g=o.choices[m];if(g||(g=o.choices[m]={finish_reason:h,index:m,message:{},logprobs:x,...y}),x)if(!g.logprobs)g.logprobs=Object.assign({},x);else{let{content:V,...w}=x;Object.assign(g.logprobs,w),V&&((c=(r=g.logprobs).content)!=null||(r.content=[]),g.logprobs.content.push(...V))}if(h&&(g.finish_reason=h),Object.assign(g,y),!p)continue;let{content:_,function_call:b,role:I,tool_calls:P,...j}=p;if(Object.assign(g.message,j),_&&(g.message.content=(g.message.content||"")+_),I&&(g.message.role=I),b&&(g.message.function_call?(b.name&&(g.message.function_call.name=b.name),b.arguments&&((u=(s=g.message.function_call).arguments)!=null||(s.arguments=""),g.message.function_call.arguments+=b.arguments)):g.message.function_call=b),P){g.message.tool_calls||(g.message.tool_calls=[]);for(let{index:V,id:w,type:E,function:A,...D}of P){let M=(d=(i=g.message.tool_calls)[V])!=null?d:i[V]={};Object.assign(M,D),w&&(M.id=w),E&&(M.type=E),A&&((f=M.function)!=null||(M.function={arguments:""})),A!=null&&A.name&&(M.function.name=A.name),A!=null&&A.arguments&&(M.function.arguments+=A.arguments)}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let i=t.shift();i?i(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s(void 0);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise(i=>t.push(i)).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0})}}toReadableStream(){return new st(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function af(n){let{id:e,choices:t,created:r,model:s,system_fingerprint:i,...o}=n;return{...o,id:e,choices:t.map(({message:a,finish_reason:l,index:c,logprobs:u,...d})=>{if(!l)throw new v(`missing finish_reason for choice ${c}`);let{content:f=null,function_call:p,tool_calls:h,...m}=a,x=a.role;if(!x)throw new v(`missing role for choice ${c}`);if(p){let{arguments:y,name:g}=p;if(y==null)throw new v(`missing function_call.arguments for choice ${c}`);if(!g)throw new v(`missing function_call.name for choice ${c}`);return{...d,message:{content:f,function_call:{arguments:y,name:g},role:x},finish_reason:l,index:c,logprobs:u}}return h?{...d,index:c,finish_reason:l,logprobs:u,message:{...m,role:x,content:f,tool_calls:h.map((y,g)=>{let{function:_,type:b,id:I,...P}=y,{arguments:j,name:V,...w}=_||{};if(I==null)throw new v(`missing choices[${c}].tool_calls[${g}].id
${gr(n)}`);if(b==null)throw new v(`missing choices[${c}].tool_calls[${g}].type
${gr(n)}`);if(V==null)throw new v(`missing choices[${c}].tool_calls[${g}].function.name
${gr(n)}`);if(j==null)throw new v(`missing choices[${c}].tool_calls[${g}].function.arguments
${gr(n)}`);return{...P,id:I,type:b,function:{...w,name:V,arguments:j}}})}}:{...d,message:{...m,content:f,role:x},finish_reason:l,index:c,logprobs:u}}),created:r,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function gr(n){return JSON.stringify(n)}var wn=class n extends Jt{static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let s=new n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){let s=new n,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var bn=class extends C{runFunctions(e,t){return e.stream?wn.runFunctions(this._client.chat.completions,e,t):_n.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?wn.runTools(this._client.chat.completions,e,t):_n.runTools(this._client.chat.completions,e,t)}stream(e,t){return Jt.createChatCompletion(this._client.chat.completions,e,t)}};var ht=class extends C{constructor(){super(...arguments),this.completions=new bn(this._client)}};(function(n){n.Completions=bn})(ht||(ht={}));var pt=class extends C{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/messages/${t}/files/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,r={},s){return H(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/messages/${t}/files`,mt,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},mt=class extends W{};(function(n){n.MessageFilesPage=mt})(pt||(pt={}));var gt=class extends C{constructor(){super(...arguments),this.files=new pt(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},r){return H(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,xt,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}},xt=class extends W{};(function(n){n.ThreadMessagesPage=xt,n.Files=pt,n.MessageFilesPage=mt})(gt||(gt={}));var yt=class extends C{retrieve(e,t,r,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t,r={},s){return H(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,_t,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},_t=class extends W{};(function(n){n.RunStepsPage=_t})(yt||(yt={}));var wt=class extends C{constructor(){super(...arguments),this.steps=new yt(this._client)}create(e,t,r){return this._client.post(`/threads/${e}/runs`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}list(e,t={},r){return H(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,bt,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v1",...s==null?void 0:s.headers}})}},bt=class extends W{};(function(n){n.RunsPage=bt,n.Steps=yt,n.RunStepsPage=_t})(wt||(wt={}));var Ct=class extends C{constructor(){super(...arguments),this.runs=new wt(this._client),this.messages=new gt(this._client)}create(e={},t){return H(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v1",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v1",...t==null?void 0:t.headers}})}};(function(n){n.Runs=wt,n.RunsPage=bt,n.Messages=gt,n.ThreadMessagesPage=xt})(Ct||(Ct={}));var $e=class extends C{constructor(){super(...arguments),this.chat=new ht(this._client),this.assistants=new dt(this._client),this.threads=new Ct(this._client)}};(function(n){n.Chat=ht,n.Assistants=dt,n.AssistantsPage=ft,n.Threads=Ct})($e||($e={}));var je=class extends C{create(e,t){var r;return this._client.post("/completions",{body:e,...t,stream:(r=e.stream)!=null?r:!1})}};je||(je={});var ze=class extends C{create(e,t){return this._client.post("/embeddings",{body:e,...t})}};ze||(ze={});var qe=class extends C{create(e,t){return this._client.post("/files",pe({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/files",He,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),o=await this.retrieve(e);for(;!o.status||!s.has(o.status);)if(await Gs(t),o=await this.retrieve(e),Date.now()-i>r)throw new ve({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}},He=class extends ke{};(function(n){n.FileObjectsPage=He})(qe||(qe={}));var vt=class extends C{create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return H(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Et,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return H(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,At,{query:t,...r})}},Et=class extends W{},At=class extends W{};(function(n){n.FineTuningJobsPage=Et,n.FineTuningJobEventsPage=At})(vt||(vt={}));var We=class extends C{constructor(){super(...arguments),this.jobs=new vt(this._client)}};(function(n){n.Jobs=vt,n.FineTuningJobsPage=Et,n.FineTuningJobEventsPage=At})(We||(We={}));var Ve=class extends C{createVariation(e,t){return this._client.post("/images/variations",pe({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",pe({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};Ve||(Ve={});var Xe=class extends C{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ke,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},Ke=class extends ke{};(function(n){n.ModelsPage=Ke})(Xe||(Xe={}));var Je=class extends C{create(e,t){return this._client.post("/moderations",{body:e,...t})}};Je||(Je={});var ml,B=class extends ar{constructor({baseURL:e=lr("OPENAI_BASE_URL"),apiKey:t=lr("OPENAI_API_KEY"),organization:r=(i=>(i=lr("OPENAI_ORG_ID"))!=null?i:null)(),...s}={}){var a;if(t===void 0)throw new v("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let o={apiKey:t,organization:r,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&sl())throw new v(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:(a=o.timeout)!=null?a:6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new je(this),this.chat=new Le(this),this.embeddings=new ze(this),this.files=new qe(this),this.images=new Ve(this),this.audio=new Me(this),this.moderations=new Je(this),this.models=new Xe(this),this.fineTuning=new We(this),this.beta=new $e(this),this._options=o,this.apiKey=t,this.organization=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};ml=B;B.OpenAI=ml;B.OpenAIError=v;B.APIError=q;B.APIConnectionError=Ce;B.APIConnectionTimeoutError=ve;B.APIUserAbortError=ee;B.NotFoundError=$t;B.ConflictError=jt;B.RateLimitError=qt;B.BadRequestError=Mt;B.AuthenticationError=Ut;B.InternalServerError=Ht;B.PermissionDeniedError=Bt;B.UnprocessableEntityError=zt;var{OpenAIError:f0,APIError:h0,APIConnectionError:p0,APIConnectionTimeoutError:m0,APIUserAbortError:g0,NotFoundError:x0,ConflictError:y0,RateLimitError:_0,BadRequestError:w0,AuthenticationError:b0,InternalServerError:C0,PermissionDeniedError:v0,UnprocessableEntityError:E0}=zs;(function(n){n.toFile=Vs,n.fileFromPath=tr,n.Page=ke,n.CursorPage=W,n.Completions=je,n.Chat=Le,n.Embeddings=ze,n.Files=qe,n.FileObjectsPage=He,n.Images=Ve,n.Audio=Me,n.Moderations=Je,n.Models=Xe,n.ModelsPage=Ke,n.FineTuning=We,n.Beta=$e})(B||(B={}));var Gt=class{get key(){return this._key}constructor(e){if(!e)throw new Error("key must be a non-empty string");this._key=e}update(e){this._key=e}};var Ae=class extends Error{constructor(e){super(e),this.name="AbortError"}};function ci(n,e){return n=Math.ceil(n),e=Math.floor(e),Math.floor(Math.random()*(e-n+1))+n}function Cn(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}function Yt(n){if(Cn(n)){let e=typeof n.name=="string",t=typeof n.message=="string";return e&&t}return!1}function Qt(n){if(Yt(n))return n.message;{let e;try{typeof n=="object"&&n?e=JSON.stringify(n):e=String(n)}catch(t){e="[unable to stringify input]"}return`Unknown error ${e}`}}function ge(n,e){switch(e){case"utf-8":return pf(n);case"base64":return xl(n);case"base64url":return mf(n);case"hex":return gf(n)}}function pf(n){return new TextEncoder().encode(n)}function xl(n){return new Uint8Array([...atob(n)].map(e=>e.charCodeAt(0)))}function mf(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");return xl(e)}var gl=new Set("0123456789abcdefABCDEF");function gf(n){let e=new Uint8Array(n.length/2);for(let t=0;t<n.length/2;++t){let r=n[2*t],s=n[2*t+1];if(!gl.has(r)||!gl.has(s))return e.slice(0,t);e[t]=parseInt(`${r}${s}`,16)}return e}function yl(){let n="";for(let e=0;e<32;e++){let t=Math.floor(Math.random()*16);e===12?n+="4":e===16?n+=t&3|8:n+=t.toString(16),(e===7||e===11||e===15||e===19)&&(n+="-")}return n}var ui,xf=typeof((ui=globalThis==null?void 0:globalThis.crypto)===null||ui===void 0?void 0:ui.randomUUID)=="function"?globalThis.crypto.randomUUID.bind(globalThis.crypto):yl;function vn(){return xf()}var di,fi,hi,pi,yf=typeof window!="undefined"&&typeof window.document!="undefined",_f=typeof self=="object"&&typeof(self==null?void 0:self.importScripts)=="function"&&(((di=self.constructor)===null||di===void 0?void 0:di.name)==="DedicatedWorkerGlobalScope"||((fi=self.constructor)===null||fi===void 0?void 0:fi.name)==="ServiceWorkerGlobalScope"||((hi=self.constructor)===null||hi===void 0?void 0:hi.name)==="SharedWorkerGlobalScope"),_l=typeof Deno!="undefined"&&typeof Deno.version!="undefined"&&typeof Deno.version.deno!="undefined",xr=typeof process!="undefined"&&!!process.version&&!!(!((pi=process.versions)===null||pi===void 0)&&pi.node)&&!_l,wf=typeof Bun!="undefined"&&typeof Bun.version!="undefined",bf=typeof navigator!="undefined"&&(navigator==null?void 0:navigator.product)==="ReactNative";function St(n){let e=n;return e&&typeof e.getToken=="function"&&(e.signRequest===void 0||e.getToken.length>0)}function L(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t}function wl(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function $(n){return this instanceof $?(this.v=n,this):new $(n)}function Pt(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){r[f]&&(s[f]=function(p){return new Promise(function(h,m){i.push([f,p,h,m])>1||a(f,p)})})}function a(f,p){try{l(r[f](p))}catch(h){d(i[0][3],h)}}function l(f){f.value instanceof $?Promise.resolve(f.value.v).then(c,u):d(i[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,p){f(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}function mi(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof wl=="function"?wl(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,l){o=n[i](o),s(a,l,o.done,o.value)})}}function s(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}}var bl=new Set(["Deserialize","Serialize","Retry","Sign"]),gi=class n{constructor(e){var t;this._policies=[],this._policies=(t=e==null?void 0:e.slice(0))!==null&&t!==void 0?t:[],this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!bl.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!bl.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){let t=[];return this._policies=this._policies.filter(r=>e.name&&r.policy.name===e.name||e.phase&&r.options.phase===e.phase?(t.push(r.policy),!1):!0),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((i,o)=>a=>o.sendRequest(a,i),i=>e.sendRequest(i))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new n(this._policies)}static create(){return new n}orderPolicies(){let e=[],t=new Map;function r(h){return{name:h,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}let s=r("Serialize"),i=r("None"),o=r("Deserialize"),a=r("Retry"),l=r("Sign"),c=[s,i,o,a,l];function u(h){return h==="Retry"?a:h==="Serialize"?s:h==="Deserialize"?o:h==="Sign"?l:i}for(let h of this._policies){let m=h.policy,x=h.options,y=m.name;if(t.has(y))throw new Error("Duplicate policy names not allowed in pipeline");let g={policy:m,dependsOn:new Set,dependants:new Set};x.afterPhase&&(g.afterPhase=u(x.afterPhase),g.afterPhase.hasAfterPolicies=!0),t.set(y,g),u(x.phase).policies.add(g)}for(let h of this._policies){let{policy:m,options:x}=h,y=m.name,g=t.get(y);if(!g)throw new Error(`Missing node for policy ${y}`);if(x.afterPolicies)for(let _ of x.afterPolicies){let b=t.get(_);b&&(g.dependsOn.add(b),b.dependants.add(g))}if(x.beforePolicies)for(let _ of x.beforePolicies){let b=t.get(_);b&&(b.dependsOn.add(g),g.dependants.add(b))}}function d(h){h.hasRun=!0;for(let m of h.policies)if(!(m.afterPhase&&(!m.afterPhase.hasRun||m.afterPhase.policies.size))&&m.dependsOn.size===0){e.push(m.policy);for(let x of m.dependants)x.dependsOn.delete(m);t.delete(m.policy.name),h.policies.delete(m)}}function f(){for(let h of c){if(d(h),h.policies.size>0&&h!==i){i.hasRun||d(i);return}h.hasAfterPolicies&&d(i)}}let p=0;for(;t.size>0;){p++;let h=e.length;if(f(),e.length<=h&&p>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}};function Cl(){return gi.create()}function vl(...n){if(n.length>0){let e=String(n[0]);e.includes(":error")?console.error(...n):e.includes(":warning")?console.warn(...n):e.includes(":info")?console.info(...n):e.includes(":verbose")?console.debug(...n):console.debug(...n)}}var El=typeof process!="undefined"&&process.env&&process.env.DEBUG||void 0,Al,xi=[],yi=[],yr=[];El&&_i(El);var Sl=Object.assign(n=>Pl(n),{enable:_i,enabled:wi,disable:Cf,log:vl});function _i(n){Al=n,xi=[],yi=[];let e=/\*/g,t=n.split(",").map(r=>r.trim().replace(e,".*?"));for(let r of t)r.startsWith("-")?yi.push(new RegExp(`^${r.substr(1)}$`)):xi.push(new RegExp(`^${r}$`));for(let r of yr)r.enabled=wi(r.namespace)}function wi(n){if(n.endsWith("*"))return!0;for(let e of yi)if(e.test(n))return!1;for(let e of xi)if(e.test(n))return!0;return!1}function Cf(){let n=Al||"";return _i(""),n}function Pl(n){let e=Object.assign(t,{enabled:wi(n),destroy:vf,log:Sl.log,namespace:n,extend:Ef});function t(...r){e.enabled&&(r.length>0&&(r[0]=`${n} ${r[0]}`),e.log(...r))}return yr.push(e),e}function vf(){let n=yr.indexOf(this);return n>=0?(yr.splice(n,1),!0):!1}function Ef(n){let e=Pl(`${this.namespace}:${n}`);return e.log=this.log,e}var Zt=Sl;var Tl=new Set,_r=typeof process!="undefined"&&process.env&&process.env.AZURE_LOG_LEVEL||void 0,bi,Ci=Zt("azure");Ci.log=(...n)=>{Zt.log(...n)};var vi=["verbose","info","warning","error"];_r&&(Ol(_r)?Af(_r):console.error(`AZURE_LOG_LEVEL set to unknown log level '${_r}'; logging is not enabled. Acceptable values: ${vi.join(", ")}.`));function Af(n){if(n&&!Ol(n))throw new Error(`Unknown log level '${n}'. Acceptable values: ${vi.join(",")}`);bi=n;let e=[];for(let t of Tl)Fl(t)&&e.push(t.namespace);Zt.enable(e.join(","))}var Rl={verbose:400,info:300,warning:200,error:100};function en(n){let e=Ci.extend(n);return Il(Ci,e),{error:wr(e,"error"),warning:wr(e,"warning"),info:wr(e,"info"),verbose:wr(e,"verbose")}}function Il(n,e){e.log=(...t)=>{n.log(...t)}}function wr(n,e){let t=Object.assign(n.extend(e),{level:e});if(Il(n,t),Fl(t)){let r=Zt.disable();Zt.enable(r+","+t.namespace)}return Tl.add(t),t}function Fl(n){return!!(bi&&Rl[n.level]<=Rl[bi])}function Ol(n){return vi.includes(n)}var Se=en("core-rest-pipeline");var Ei="REDACTED",Sf=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],Pf=["api-version"],tn=class{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=Sf.concat(e),t=Pf.concat(t),this.allowedHeaderNames=new Set(e.map(r=>r.toLowerCase())),this.allowedQueryParameters=new Set(t.map(r=>r.toLowerCase()))}sanitize(e){let t=new Set;return JSON.stringify(e,(r,s)=>{if(s instanceof Error)return Object.assign(Object.assign({},s),{name:s.name,message:s.message});if(r==="headers")return this.sanitizeHeaders(s);if(r==="url")return this.sanitizeUrl(s);if(r==="query")return this.sanitizeQuery(s);if(r==="body")return;if(r==="response")return;if(r==="operationSpec")return;if(Array.isArray(s)||Cn(s)){if(t.has(s))return"[Circular]";t.add(s)}return s},2)}sanitizeHeaders(e){let t={};for(let r of Object.keys(e))this.allowedHeaderNames.has(r.toLowerCase())?t[r]=e[r]:t[r]=Ei;return t}sanitizeQuery(e){if(typeof e!="object"||e===null)return e;let t={};for(let r of Object.keys(e))this.allowedQueryParameters.has(r.toLowerCase())?t[r]=e[r]:t[r]=Ei;return t}sanitizeUrl(e){if(typeof e!="string"||e===null)return e;let t=new URL(e);if(!t.search)return e;for(let[r]of t.searchParams)this.allowedQueryParameters.has(r.toLowerCase())||t.searchParams.set(r,Ei);return t.toString()}};var Rf="logPolicy";function Nl(n={}){var e;let t=(e=n.logger)!==null&&e!==void 0?e:Se.info,r=new tn({additionalAllowedHeaderNames:n.additionalAllowedHeaderNames,additionalAllowedQueryParameters:n.additionalAllowedQueryParameters});return{name:Rf,async sendRequest(s,i){if(!t.enabled)return i(s);t(`Request: ${r.sanitize(s)}`);let o=await i(s);return t(`Response status code: ${o.status}`),t(`Headers: ${r.sanitize(o.headers)}`),o}}}var Tf="redirectPolicy",Dl=["GET","HEAD"];function kl(n={}){let{maxRetries:e=20}=n;return{name:Tf,async sendRequest(t,r){let s=await r(t);return Ll(r,s,e)}}}async function Ll(n,e,t,r=0){let{request:s,status:i,headers:o}=e,a=o.get("location");if(a&&(i===300||i===301&&Dl.includes(s.method)||i===302&&Dl.includes(s.method)||i===303&&s.method==="POST"||i===307)&&r<t){let l=new URL(a,s.url);s.url=l.toString(),i===303&&(s.method="GET",s.headers.delete("Content-Length"),delete s.body),s.headers.delete("Authorization");let c=await n(s);return Ll(n,c,t,r+1)}return e}function Ml(){return"x-ms-useragent"}function Ul(n){var e,t,r;let s=globalThis.navigator;n.set("OS",((r=(t=(e=s==null?void 0:s.userAgentData)===null||e===void 0?void 0:e.platform)!==null&&t!==void 0?t:s==null?void 0:s.platform)!==null&&r!==void 0?r:"unknown").replace(" ",""))}var br="1.12.3";function If(n){let e=[];for(let[t,r]of n){let s=r?`${t}/${r}`:t;e.push(s)}return e.join(" ")}function Bl(){return Ml()}function Cr(n){let e=new Map;e.set("core-rest-pipeline",br),Ul(e);let t=If(e);return n?`${n} ${t}`:t}var $l=Bl(),Ff="userAgentPolicy";function jl(n={}){let e=Cr(n.userAgentPrefix);return{name:Ff,async sendRequest(t,r){return t.headers.has($l)||t.headers.set($l,e),r(t)}}}function zl(){throw new Error("decompressResponsePolicy is not supported in browser environment")}var Of="The operation was aborted.";function vr(n,e,t){return new Promise((r,s)=>{let i,o,a=()=>s(new Ae(t!=null&&t.abortErrorMsg?t==null?void 0:t.abortErrorMsg:Of)),l=()=>{t!=null&&t.abortSignal&&o&&t.abortSignal.removeEventListener("abort",o)};if(o=()=>(i&&clearTimeout(i),l(),a()),t!=null&&t.abortSignal&&t.abortSignal.aborted)return a();i=setTimeout(()=>{l(),r(e)},n),t!=null&&t.abortSignal&&t.abortSignal.addEventListener("abort",o)})}function ql(n,e){let t=n.headers.get(e);if(!t)return;let r=Number(t);if(!Number.isNaN(r))return r}var Ai="Retry-After",Nf=["retry-after-ms","x-ms-retry-after-ms",Ai];function Hl(n){if(n&&[429,503].includes(n.status))try{for(let s of Nf){let i=ql(n,s);if(i===0||i)return i*(s===Ai?1e3:1)}let e=n.headers.get(Ai);if(!e)return;let r=Date.parse(e)-Date.now();return Number.isFinite(r)?Math.max(0,r):void 0}catch(e){return}}function Wl(n){return Number.isFinite(Hl(n))}function Vl(){return{name:"throttlingRetryStrategy",retry({response:n}){let e=Hl(n);return Number.isFinite(e)?{retryAfterInMs:e}:{skipStrategy:!0}}}}var Df=1e3,kf=1e3*64;function Xl(n={}){var e,t;let r=(e=n.retryDelayInMs)!==null&&e!==void 0?e:Df,s=(t=n.maxRetryDelayInMs)!==null&&t!==void 0?t:kf,i=r;return{name:"exponentialRetryStrategy",retry({retryCount:o,response:a,responseError:l}){let c=Mf(l),u=c&&n.ignoreSystemErrors,d=Lf(a),f=d&&n.ignoreHttpStatusCodes;if(a&&(Wl(a)||!d)||f||u)return{skipStrategy:!0};if(l&&!c&&!d)return{errorToThrow:l};let h=i*Math.pow(2,o),m=Math.min(s,h);return i=m/2+ci(0,m/2),{retryAfterInMs:i}}}}function Lf(n){return!!(n&&n.status!==void 0&&(n.status>=500||n.status===408)&&n.status!==501&&n.status!==505)}function Mf(n){return n?n.code==="ETIMEDOUT"||n.code==="ESOCKETTIMEDOUT"||n.code==="ECONNREFUSED"||n.code==="ECONNRESET"||n.code==="ENOENT"||n.code==="ENOTFOUND":!1}var Jl=en("core-rest-pipeline retryPolicy"),Uf="retryPolicy";function Gl(n,e={maxRetries:3}){let t=e.logger||Jl;return{name:Uf,async sendRequest(r,s){var i,o;let a,l,c=-1;e:for(;;){c+=1,a=void 0,l=void 0;try{t.info(`Retry ${c}: Attempting to send request`,r.requestId),a=await s(r),t.info(`Retry ${c}: Received a response from request`,r.requestId)}catch(u){if(t.error(`Retry ${c}: Received an error from request`,r.requestId),l=u,!u||l.name!=="RestError")throw u;a=l.response}if(!((i=r.abortSignal)===null||i===void 0)&&i.aborted)throw t.error(`Retry ${c}: Request aborted.`),new Ae;if(c>=((o=e.maxRetries)!==null&&o!==void 0?o:3)){if(t.info(`Retry ${c}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),l)throw l;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}t.info(`Retry ${c}: Processing ${n.length} retry strategies.`);t:for(let u of n){let d=u.logger||Jl;d.info(`Retry ${c}: Processing retry strategy ${u.name}.`);let f=u.retry({retryCount:c,response:a,responseError:l});if(f.skipStrategy){d.info(`Retry ${c}: Skipped.`);continue t}let{errorToThrow:p,retryAfterInMs:h,redirectTo:m}=f;if(p)throw d.error(`Retry ${c}: Retry strategy ${u.name} throws error:`,p),p;if(h||h===0){d.info(`Retry ${c}: Retry strategy ${u.name} retries after ${h}`),await vr(h,void 0,{abortSignal:r.abortSignal});continue e}if(m){d.info(`Retry ${c}: Retry strategy ${u.name} redirects to ${m}`),r.url=m;continue e}}if(l)throw t.info("None of the retry strategies could work with the received error. Throwing it."),l;if(a)return t.info("None of the retry strategies could work with the received response. Returning it."),a}}}}var Bf="defaultRetryPolicy";function Yl(n={}){var e;return{name:Bf,sendRequest:Gl([Vl(),Xl(n)],{maxRetries:(e=n.maxRetries)!==null&&e!==void 0?e:3}).sendRequest}}function Er(n){return n.toLowerCase()}function*$f(n){for(let e of n.values())yield[e.name,e.value]}var Si=class{constructor(e){if(this._headersMap=new Map,e)for(let t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(Er(e),{name:e,value:String(t).trim()})}get(e){var t;return(t=this._headersMap.get(Er(e)))===null||t===void 0?void 0:t.value}has(e){return this._headersMap.has(Er(e))}delete(e){this._headersMap.delete(Er(e))}toJSON(e={}){let t={};if(e.preserveCase)for(let r of this._headersMap.values())t[r.name]=r.value;else for(let[r,s]of this._headersMap)t[r]=s.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return $f(this._headersMap)}};function xe(n){return new Si(n)}var jf="formDataPolicy";function Ql(){return{name:jf,async sendRequest(n,e){if(n.formData){let t=n.headers.get("Content-Type");t&&t.indexOf("application/x-www-form-urlencoded")!==-1?n.body=zf(n.formData):await qf(n.formData,n),n.formData=void 0}return e(n)}}}function zf(n){let e=new URLSearchParams;for(let[t,r]of Object.entries(n))if(Array.isArray(r))for(let s of r)e.append(t,s.toString());else e.append(t,r.toString());return e.toString()}async function qf(n,e){let t=e.headers.get("Content-Type");if(t&&!t.startsWith("multipart/form-data"))return;e.headers.set("Content-Type",t!=null?t:"multipart/form-data");let r=[];for(let[s,i]of Object.entries(n)){for(let o of Array.isArray(i)?i:[i])if(typeof o=="string")r.push({headers:xe({"Content-Disposition":`form-data; name="${s}"`}),body:ge(o,"utf-8")});else{let a=o.name||"blob",l=xe();l.set("Content-Disposition",`form-data; name="${s}"; filename="${a}"`),o.type&&l.set("Content-Type",o.type),r.push({headers:l,body:o})}e.multipartBody={parts:r}}}var Hf="proxyPolicy is not supported in browser environment";function Zl(){throw new Error(Hf)}var Wf="setClientRequestIdPolicy";function ec(n="x-ms-client-request-id"){return{name:Wf,async sendRequest(e,t){return e.headers.has(n)||e.headers.set(n,e.requestId),t(e)}}}var Vf="tlsPolicy";function tc(n){return{name:Vf,sendRequest:async(e,t)=>(e.tlsSettings||(e.tlsSettings=n),t(e))}}var nn={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function nc(n={}){let e=new Pi(n.parentContext);return n.span&&(e=e.setValue(nn.span,n.span)),n.namespace&&(e=e.setValue(nn.namespace,n.namespace)),e}var Pi=class n{constructor(e){this._contextMap=e instanceof n?new Map(e._contextMap):new Map}setValue(e,t){let r=new n(this);return r._contextMap.set(e,t),r}getValue(e){return this._contextMap.get(e)}deleteValue(e){let t=new n(this);return t._contextMap.delete(e),t}};function Xf(){return{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}}}function Kf(){return{createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(n,e)=>({span:Xf(),tracingContext:nc({parentContext:e.tracingContext})}),withContext(n,e,...t){return e(...t)}}}var Ri;function En(){return Ri||(Ri=Kf()),Ri}function Ti(n){let{namespace:e,packageName:t,packageVersion:r}=n;function s(c,u,d){var f;let p=En().startSpan(c,Object.assign(Object.assign({},d),{packageName:t,packageVersion:r,tracingContext:(f=u==null?void 0:u.tracingOptions)===null||f===void 0?void 0:f.tracingContext})),h=p.tracingContext,m=p.span;h.getValue(nn.namespace)||(h=h.setValue(nn.namespace,e)),m.setAttribute("az.namespace",h.getValue(nn.namespace));let x=Object.assign({},u,{tracingOptions:Object.assign(Object.assign({},u==null?void 0:u.tracingOptions),{tracingContext:h})});return{span:m,updatedOptions:x}}async function i(c,u,d,f){let{span:p,updatedOptions:h}=s(c,u,f);try{let m=await o(h.tracingOptions.tracingContext,()=>Promise.resolve(d(h,p)));return p.setStatus({status:"success"}),m}catch(m){throw p.setStatus({status:"error",error:m}),m}finally{p.end()}}function o(c,u,...d){return En().withContext(c,u,...d)}function a(c){return En().parseTraceparentHeader(c)}function l(c){return En().createRequestHeaders(c)}return{startSpan:s,withSpan:i,withContext:o,parseTraceparentHeader:a,createRequestHeaders:l}}var rc={};var Jf=new tn,ne=class n extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,this.request=t.request,this.response=t.response,Object.setPrototypeOf(this,n.prototype)}[rc](){return`RestError: ${this.message} 
 ${Jf.sanitize(this)}`}};ne.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";ne.PARSE_ERROR="PARSE_ERROR";function Ii(n){return n instanceof ne?!0:Yt(n)&&n.name==="RestError"}var Gf="tracingPolicy";function sc(n={}){let e=Cr(n.userAgentPrefix),t=Yf();return{name:Gf,async sendRequest(r,s){var i,o;if(!t||!(!((i=r.tracingOptions)===null||i===void 0)&&i.tracingContext))return s(r);let{span:a,tracingContext:l}=(o=Qf(t,r,e))!==null&&o!==void 0?o:{};if(!a||!l)return s(r);try{let c=await t.withContext(l,s,r);return eh(a,c),c}catch(c){throw Zf(a,c),c}}}}function Yf(){try{return Ti({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:br})}catch(n){Se.warning(`Error when creating the TracingClient: ${Qt(n)}`);return}}function Qf(n,e,t){try{let{span:r,updatedOptions:s}=n.startSpan(`HTTP ${e.method}`,{tracingOptions:e.tracingOptions},{spanKind:"client",spanAttributes:{"http.method":e.method,"http.url":e.url,requestId:e.requestId}});if(!r.isRecording()){r.end();return}t&&r.setAttribute("http.user_agent",t);let i=n.createRequestHeaders(s.tracingOptions.tracingContext);for(let[o,a]of Object.entries(i))e.headers.set(o,a);return{span:r,tracingContext:s.tracingOptions.tracingContext}}catch(r){Se.warning(`Skipping creating a tracing span due to an error: ${Qt(r)}`);return}}function Zf(n,e){try{n.setStatus({status:"error",error:Yt(e)?e:void 0}),Ii(e)&&e.statusCode&&n.setAttribute("http.status_code",e.statusCode),n.end()}catch(t){Se.warning(`Skipping tracing span processing due to an error: ${Qt(t)}`)}}function eh(n,e){try{n.setAttribute("http.status_code",e.status);let t=e.headers.get("x-ms-request-id");t&&n.setAttribute("serviceRequestId",t),n.setStatus({status:"success"}),n.end()}catch(t){Se.warning(`Skipping tracing span processing due to an error: ${Qt(t)}`)}}function ic(n){return!!(n&&typeof n.pipe=="function")}function An(n){return!!(n&&typeof n.getReader=="function"&&typeof n.tee=="function")}function Ar(n){return typeof n.stream=="function"}function oc(n){if(n instanceof Uint8Array)return new Blob([n]).stream();if(An(n))return n;if(Ar(n))return n.stream();throw new Error("Unsupported type. Only ReadableStream, Uint8Array and Blob are supported in browser")}function ac(n){var e;let t=Array.from(n),r=(e=t.shift())===null||e===void 0?void 0:e.getReader();async function s(i){var o;if(!r){i.close();return}let a,l;try{({value:a,done:l}=await r.read())}catch(c){i.error(c),r.releaseLock();return}l?(r.releaseLock(),r=(o=t.shift())===null||o===void 0?void 0:o.getReader(),await s(i)):i.enqueue(a)}return new ReadableStream({pull(i){return s(i)},cancel(i){r==null||r.cancel(i)}})}function th(){return`----AzSDKFormBoundary${vn()}`}function nh(n){let e="";for(let[t,r]of n)e+=`${t}: ${r}\r
`;return e}function rh(n){return n instanceof Uint8Array?n.byteLength:Ar(n)?n.size===-1?void 0:n.size:void 0}function sh(n){let e=0;for(let t of n){let r=rh(t);if(r===void 0)return;e+=r}return e}function ih(n,e,t){let r=[ge(`--${t}`,"utf-8"),...e.flatMap(i=>[ge(`\r
`,"utf-8"),ge(nh(i.headers),"utf-8"),ge(`\r
`,"utf-8"),i.body,ge(`\r
--${t}`,"utf-8")]),ge(`--\r
\r
`,"utf-8")],s=sh(r);s&&n.headers.set("Content-Length",s),n.body=()=>ac(r.map(i=>typeof i=="function"?i():i).map(oc))}var oh="multipartPolicy",ah=70,lh=new Set("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'()+,-./:=?");function ch(n){if(n.length>ah)throw new Error(`Multipart boundary "${n}" exceeds maximum length of 70 characters`);if(Array.from(n).some(e=>!lh.has(e)))throw new Error(`Multipart boundary "${n}" contains invalid characters`)}function lc(){return{name:oh,sendRequest(n,e){var t;if(!n.multipartBody)return e(n);if(n.body)throw new Error("multipartBody and regular body cannot be set at the same time");let r=n.multipartBody.boundary,s=(t=n.headers.get("Content-Type"))!==null&&t!==void 0?t:"multipart/mixed",i=s.match(/^(multipart\/[^ ;]+)(?:; *boundary=(.+))?$/);if(!i)throw new Error(`Got multipart request body, but content-type header was not multipart: ${s}`);let[,o,a]=i;if(a&&r&&a!==r)throw new Error(`Multipart boundary was specified as ${a} in the header, but got ${r} in the request body`);return r!=null||(r=a),r?ch(r):r=th(),n.headers.set("Content-Type",`${o}; boundary=${r}`),ih(n,n.multipartBody.parts,r),n.multipartBody=void 0,e(n)}}}function Fi(n){var e;let t=Cl();return xr&&(n.tlsOptions&&t.addPolicy(tc(n.tlsOptions)),t.addPolicy(Zl(n.proxyOptions)),t.addPolicy(zl())),t.addPolicy(Ql()),t.addPolicy(jl(n.userAgentOptions)),t.addPolicy(ec((e=n.telemetryOptions)===null||e===void 0?void 0:e.clientRequestIdHeaderName)),t.addPolicy(lc(),{afterPhase:"Deserialize"}),t.addPolicy(Yl(n.retryOptions),{phase:"Retry"}),t.addPolicy(sc(n.userAgentOptions),{afterPhase:"Retry"}),xr&&t.addPolicy(kl(n.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(Nl(n.loggingOptions),{afterPhase:"Sign"}),t}function uh(n){return(typeof Blob=="function"||typeof Blob=="object")&&n instanceof Blob}var Oi=class{async sendRequest(e){if(new URL(e.url).protocol!=="https:"&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await dh(e)}catch(s){throw ph(s,e)}}};async function dh(n){let{abortController:e,abortControllerCleanup:t}=hh(n);try{let r=mh(n.headers),{streaming:s,body:i}=xh(n),o=Object.assign(Object.assign({body:i,method:n.method,headers:r,signal:e.signal},"credentials"in Request.prototype?{credentials:n.withCredentials?"include":"same-origin"}:{}),"cache"in Request.prototype?{cache:"no-store"}:{});s&&(o.duplex="half");let a=await fetch(n.url,o);return uh(n.body)&&n.onUploadProgress&&n.onUploadProgress({loadedBytes:n.body.size}),fh(a,n,t)}catch(r){throw t==null||t(),r}}async function fh(n,e,t){var r,s;let i=gh(n),o={request:e,headers:i,status:n.status},a=An(n.body)?cc(n.body,{onProgress:e.onDownloadProgress,onEnd:t}):n.body;if(!((r=e.streamResponseStatusCodes)===null||r===void 0)&&r.has(Number.POSITIVE_INFINITY)||!((s=e.streamResponseStatusCodes)===null||s===void 0)&&s.has(o.status))if(e.enableBrowserStreams)o.browserStreamBody=a!=null?a:void 0;else{let l=new Response(a);o.blobBody=l.blob(),t==null||t()}else{let l=new Response(a);o.bodyAsText=await l.text(),t==null||t()}return o}function hh(n){let e=new AbortController,t,r;if(n.abortSignal){if(n.abortSignal.aborted)throw new Ae("The operation was aborted.");r=s=>{s.type==="abort"&&e.abort()},n.abortSignal.addEventListener("abort",r),t=()=>{var s;r&&((s=n.abortSignal)===null||s===void 0||s.removeEventListener("abort",r))}}return n.timeout>0&&setTimeout(()=>{e.abort()},n.timeout),{abortController:e,abortControllerCleanup:t}}function ph(n,e){var t;return n&&(n==null?void 0:n.name)==="AbortError"?n:new ne(`Error sending request: ${n.message}`,{code:(t=n==null?void 0:n.code)!==null&&t!==void 0?t:ne.REQUEST_SEND_ERROR,request:e})}function mh(n){let e=new Headers;for(let[t,r]of n)e.append(t,r);return e}function gh(n){let e=xe();for(let[t,r]of n.headers)e.set(t,r);return e}function xh(n){let e=typeof n.body=="function"?n.body():n.body;if(ic(e))throw new Error("Node streams are not supported in browser environment.");return An(e)?{streaming:!0,body:cc(e,{onProgress:n.onUploadProgress})}:{streaming:!1,body:e}}function cc(n,e={}){let t=0,{onProgress:r,onEnd:s}=e;if(yh(n))return n.pipeThrough(new TransformStream({transform(i,o){if(i===null){o.terminate();return}o.enqueue(i),t+=i.length,r&&r({loadedBytes:t})},flush(){s==null||s()}}));{let i=n.getReader();return new ReadableStream({async pull(o){var a;let{done:l,value:c}=await i.read();if(l||!c){s==null||s(),o.close(),i.releaseLock();return}t+=(a=c==null?void 0:c.length)!==null&&a!==void 0?a:0,o.enqueue(c),r&&r({loadedBytes:t})},cancel(o){return s==null||s(),i.cancel(o)}})}}function uc(){return new Oi}function yh(n){return n.pipeThrough!==void 0&&self.TransformStream!==void 0}function Ni(){return uc()}var Di=class{constructor(e){var t,r,s,i,o,a,l;this.url=e.url,this.body=e.body,this.headers=(t=e.headers)!==null&&t!==void 0?t:xe(),this.method=(r=e.method)!==null&&r!==void 0?r:"GET",this.timeout=(s=e.timeout)!==null&&s!==void 0?s:0,this.multipartBody=e.multipartBody,this.formData=e.formData,this.disableKeepAlive=(i=e.disableKeepAlive)!==null&&i!==void 0?i:!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=(o=e.withCredentials)!==null&&o!==void 0?o:!1,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||vn(),this.allowInsecureConnection=(a=e.allowInsecureConnection)!==null&&a!==void 0?a:!1,this.enableBrowserStreams=(l=e.enableBrowserStreams)!==null&&l!==void 0?l:!1}};function ki(n){return new Di(n)}var _h={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:1e3*60*2};async function wh(n,e,t){async function r(){if(Date.now()<t)try{return await n()}catch(i){return null}else{let i=await n();if(i===null)throw new Error("Failed to refresh access token.");return i}}let s=await r();for(;s===null;)await vr(e),s=await r();return s}function dc(n,e){let t=null,r=null,s,i=Object.assign(Object.assign({},_h),e),o={get isRefreshing(){return t!==null},get shouldRefresh(){var l;return!o.isRefreshing&&((l=r==null?void 0:r.expiresOnTimestamp)!==null&&l!==void 0?l:0)-i.refreshWindowInMs<Date.now()},get mustRefresh(){return r===null||r.expiresOnTimestamp-i.forcedRefreshWindowInMs<Date.now()}};function a(l,c){var u;return o.isRefreshing||(t=wh(()=>n.getToken(l,c),i.retryIntervalInMs,(u=r==null?void 0:r.expiresOnTimestamp)!==null&&u!==void 0?u:Date.now()).then(f=>(t=null,r=f,s=c.tenantId,r)).catch(f=>{throw t=null,r=null,s=void 0,f})),t}return async(l,c)=>s!==c.tenantId||!!c.claims||o.mustRefresh?a(l,c):(o.shouldRefresh&&a(l,c),r)}var fc="bearerTokenAuthenticationPolicy";async function bh(n){let{scopes:e,getAccessToken:t,request:r}=n,s={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions},i=await t(e,s);i&&n.request.headers.set("Authorization",`Bearer ${i.token}`)}function Ch(n){let e=n.headers.get("WWW-Authenticate");if(n.status===401&&e)return e}function Li(n){var e;let{credential:t,scopes:r,challengeCallbacks:s}=n,i=n.logger||Se,o=Object.assign({authorizeRequest:(e=s==null?void 0:s.authorizeRequest)!==null&&e!==void 0?e:bh,authorizeRequestOnChallenge:s==null?void 0:s.authorizeRequestOnChallenge},s),a=t?dc(t):()=>Promise.resolve(null);return{name:fc,async sendRequest(l,c){if(!l.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");await o.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:l,getAccessToken:a,logger:i});let u,d;try{u=await c(l)}catch(f){d=f,u=f.response}if(o.authorizeRequestOnChallenge&&(u==null?void 0:u.status)===401&&Ch(u)&&await o.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:l,response:u,getAccessToken:a,logger:i}))return c(l);if(d)throw d;return u}}}var vh={arrayBuffer:()=>{throw new Error("Not implemented")},slice:()=>{throw new Error("Not implemented")},text:()=>{throw new Error("Not implemented")}};function Sr(n,e,t={}){var r,s,i;return Object.assign(Object.assign({},vh),{type:(r=t.type)!==null&&r!==void 0?r:"",lastModified:(s=t.lastModified)!==null&&s!==void 0?s:new Date().getTime(),webkitRelativePath:(i=t.webkitRelativePath)!==null&&i!==void 0?i:"",size:n.byteLength,name:e,arrayBuffer:async()=>n.buffer,stream:()=>new Blob([n]).stream()})}var Eh="ApiVersionPolicy";function hc(n){return{name:Eh,sendRequest:(e,t)=>{let r=new URL(e.url);return!r.searchParams.get("api-version")&&n.apiVersion&&(e.url=`${e.url}${Array.from(r.searchParams.keys()).length>0?"&":"?"}api-version=${n.apiVersion}`),t(e)}}}var Ah="keyCredentialAuthenticationPolicy";function pc(n,e){return{name:Ah,async sendRequest(t,r){return t.headers.set(e,n.key),r(t)}}}var Mi;function Sh(n,e,t={}){var r,s,i,o;let{credential:a,clientOptions:l}=t;if(a){if(St(a)){let c=Li({credential:a,scopes:(s=(r=l==null?void 0:l.credentials)===null||r===void 0?void 0:r.scopes)!==null&&s!==void 0?s:`${e}/.default`});n.addPolicy(c)}else if(Ph(a)){if(!(!((i=l==null?void 0:l.credentials)===null||i===void 0)&&i.apiKeyHeaderName))throw new Error("Missing API Key Header Name");let c=pc(a,(o=l==null?void 0:l.credentials)===null||o===void 0?void 0:o.apiKeyHeaderName);n.addPolicy(c)}}}function mc(n,e,t={}){let r=Fi(t);return r.addPolicy(hc(t)),Sh(r,n,{credential:e,clientOptions:t}),r}function Ph(n){return n.key!==void 0}function gc(){return Mi||(Mi=Ni()),Mi}function Pe(n){var e,t,r,s,i,o;return{allowInsecureConnection:(e=n.requestOptions)===null||e===void 0?void 0:e.allowInsecureConnection,timeout:(t=n.requestOptions)===null||t===void 0?void 0:t.timeout,skipUrlEncoding:(r=n.requestOptions)===null||r===void 0?void 0:r.skipUrlEncoding,abortSignal:n.abortSignal,onUploadProgress:(s=n.requestOptions)===null||s===void 0?void 0:s.onUploadProgress,onDownloadProgress:(i=n.requestOptions)===null||i===void 0?void 0:i.onDownloadProgress,tracingOptions:n.tracingOptions,headers:Object.assign({},(o=n.requestOptions)===null||o===void 0?void 0:o.headers),onResponse:n.onResponse}}function xc(n){return!!(n&&typeof n.getReader=="function"&&typeof n.tee=="function")}async function Pr(n,e,t,r={},s){var i;let o=s!=null?s:gc(),a=Th(n,e,r),l=await t.sendRequest(o,a),c=l.headers.toJSON(),u=(i=l.readableStreamBody)!==null&&i!==void 0?i:l.browserStreamBody,d=r.responseAsStream||u!==void 0?void 0:Nh(l),f=u!=null?u:d;return r!=null&&r.onResponse&&r.onResponse(Object.assign(Object.assign({},l),{request:a,rawHeaders:c,parsedBody:d})),{request:a,headers:c,status:`${l.status}`,body:f}}function Rh(n){return ArrayBuffer.isView(n)?"application/octet-stream":"application/json; charset=UTF-8"}function Th(n,e,t={}){var r,s;let{body:i,formData:o}=Ih(t.body,t.contentType),a=i!==void 0||o!==void 0,l=xe(Object.assign(Object.assign(Object.assign({},t.headers?t.headers:{}),{accept:(r=t.accept)!==null&&r!==void 0?r:"application/json"}),a&&{"content-type":(s=t.contentType)!==null&&s!==void 0?s:Rh(t.body)}));return ki({url:e,method:n,body:i,formData:o,headers:l,allowInsecureConnection:t.allowInsecureConnection,tracingOptions:t.tracingOptions,abortSignal:t.abortSignal,onUploadProgress:t.onUploadProgress,onDownloadProgress:t.onDownloadProgress,timeout:t.timeout,enableBrowserStreams:!0,streamResponseStatusCodes:t.responseAsStream?new Set([Number.POSITIVE_INFINITY]):void 0})}function Ih(n,e=""){if(n===void 0)return{body:void 0};if(xc(n))return{body:n};if(!e&&typeof n=="string")return{body:n};let t=e.split(";")[0];if(t==="application/json")return{body:JSON.stringify(n)};if(ArrayBuffer.isView(n))return{body:n instanceof Uint8Array?n:JSON.stringify(n)};switch(t){case"multipart/form-data":return Fh(n)?{formData:Oh(n)}:{body:JSON.stringify(n)};case"text/plain":return{body:String(n)};default:return typeof n=="string"?{body:n}:{body:JSON.stringify(n)}}}function Fh(n){return n instanceof Object&&Object.keys(n).length>0}function Oh(n){if(!n)return n;let e={};for(let t in n){let r=n[t];r instanceof Uint8Array?e[t]=new Blob([r]):e[t]=r}return e}function Nh(n){var e,t;let s=((e=n.headers.get("content-type"))!==null&&e!==void 0?e:"").split(";")[0],i=(t=n.bodyAsText)!==null&&t!==void 0?t:"";if(s==="text/plain")return String(i);try{return i?JSON.parse(i):void 0}catch(o){if(s==="application/json")throw Dh(n,o);return String(i)}}function Dh(n,e){var t;let r=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,s=(t=e.code)!==null&&t!==void 0?t:ne.PARSE_ERROR;return new ne(r,{code:s,statusCode:n.status,request:n.request,response:n})}function yc(n,e,t,r={}){if(e.startsWith("https://")||e.startsWith("http://"))return e;n=Mh(n,r),e=Uh(e,t,r);let s=kh(`${n}/${e}`,r);return new URL(s).toString().replace(/([^:]\/)\/+/g,"$1")}function kh(n,e={}){if(!e.queryParameters)return n;let t=new URL(n),r=e.queryParameters;for(let s of Object.keys(r)){let i=r[s];if(i==null)continue;if(!i.toString||typeof i.toString!="function")throw new Error(`Query parameters must be able to be represented as string, ${s} can't`);let o=i.toISOString!==void 0?i.toISOString():i.toString();t.searchParams.append(s,o)}return e.skipUrlEncoding&&(t=Lh(t)),t.toString()}function Lh(n){if(!n)return n;let e=[];for(let[t,r]of n.searchParams)e.push(`${t}=${r}`);return n.search=e.length?`?${e.join("&")}`:"",n}function Mh(n,e){var t;if(!e.pathParameters)return n;let r=e.pathParameters;for(let[s,i]of Object.entries(r)){if(i==null)throw new Error(`Path parameters ${s} must not be undefined or null`);if(!i.toString||typeof i.toString!="function")throw new Error(`Path parameters must be able to be represented as string, ${s} can't`);let o=i.toISOString!==void 0?i.toISOString():String(i);e.skipUrlEncoding||(o=encodeURIComponent(i)),n=(t=Bh(n,`{${s}}`,o))!==null&&t!==void 0?t:""}return n}function Uh(n,e,t={}){for(let r of e){let s=r;t.skipUrlEncoding||(s=encodeURIComponent(r)),n=n.replace(/\{\w+\}/,s)}return n}function Bh(n,e,t){return!n||!e?n:n.split(e).join(t||"")}function _c(n,e,t={}){var r;let s;e&&($h(e)?s=e:t=e!=null?e:{});let i=mc(n,s,t);if(!((r=t.additionalPolicies)===null||r===void 0)&&r.length)for(let{policy:c,position:u}of t.additionalPolicies){let d=u==="perRetry"?"Sign":void 0;i.addPolicy(c,{afterPhase:d})}let{allowInsecureConnection:o,httpClient:a}=t,l=(c,...u)=>{let d=f=>yc(n,c,u,Object.assign({allowInsecureConnection:o},f));return{get:(f={})=>Ge("GET",d(f),i,f,o,a),post:(f={})=>Ge("POST",d(f),i,f,o,a),put:(f={})=>Ge("PUT",d(f),i,f,o,a),patch:(f={})=>Ge("PATCH",d(f),i,f,o,a),delete:(f={})=>Ge("DELETE",d(f),i,f,o,a),head:(f={})=>Ge("HEAD",d(f),i,f,o,a),options:(f={})=>Ge("OPTIONS",d(f),i,f,o,a),trace:(f={})=>Ge("TRACE",d(f),i,f,o,a)}};return{path:l,pathUnchecked:l,pipeline:i}}function Ge(n,e,t,r,s,i){var o;return s=(o=r.allowInsecureConnection)!==null&&o!==void 0?o:s,{then:function(a,l){return Pr(n,e,t,Object.assign(Object.assign({},r),{allowInsecureConnection:s}),i).then(a,l)},async asBrowserStream(){return Pr(n,e,t,Object.assign(Object.assign({},r),{allowInsecureConnection:s,responseAsStream:!0}),i)},async asNodeStream(){return Pr(n,e,t,Object.assign(Object.assign({},r),{allowInsecureConnection:s,responseAsStream:!0}),i)}}}function $h(n){return!!(n.key!==void 0||St(n))}var wc=en("openai");function Ui(n,e,t={}){var r,s,i,o,a,l,c,u;let d=(r=t.baseUrl)!==null&&r!==void 0?r:`${n}/openai`;t.apiVersion=(s=t.apiVersion)!==null&&s!==void 0?s:"2023-12-01-preview";let f="azsdk-js-openai-rest/1.0.0-beta.9",p=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${f}`:`${f}`;return t=Object.assign(Object.assign({},t),{userAgentOptions:{userAgentPrefix:p},loggingOptions:{logger:(o=(i=t.loggingOptions)===null||i===void 0?void 0:i.logger)!==null&&o!==void 0?o:wc.info},credentials:{scopes:(l=(a=t.credentials)===null||a===void 0?void 0:a.scopes)!==null&&l!==void 0?l:["https://cognitiveservices.azure.com/.default"],apiKeyHeaderName:(u=(c=t.credentials)===null||c===void 0?void 0:c.apiKeyHeaderName)!==null&&u!==void 0?u:"api-key"}}),_c(d,e,t)}var bc={"POST /deployments/{deploymentId}/audio/transcriptions":["200"],"POST /deployments/{deploymentId}/audio/translations":["200"],"POST /deployments/{deploymentId}/completions":["200"],"POST /deployments/{deploymentId}/chat/completions":["200"],"POST /deployments/{deploymentId}/extensions/chat/completions":["200"],"POST /deployments/{deploymentId}/images/generations":["200"],"POST /deployments/{deploymentId}/embeddings":["200"],"GET /operations/images/{operationId}":["200"],"POST /images/generations:submit":["202"],"GET /images/generations:submit":["200","202"]};function Sn(n){let e=n.headers["x-ms-original-url"],t=new URL(e!=null?e:n.request.url),r=n.request.method,s=bc[`${r} ${t.pathname}`];return s||(s=jh(r,t.pathname)),!s.includes(n.status)}function jh(n,e){var t,r,s,i;let o=e.split("/"),a=-1,l=[];for(let[c,u]of Object.entries(bc)){if(!c.startsWith(n))continue;let d=zh(c),f=d.split("/"),p=!0;for(let h=f.length-1,m=o.length-1;h>=1&&m>=1;h--,m--){if(!((t=f[h])===null||t===void 0)&&t.startsWith("{")&&((r=f[h])===null||r===void 0?void 0:r.indexOf("}"))!==-1){let x=f[h].indexOf("}")+1,y=(s=f[h])===null||s===void 0?void 0:s.length;if(!new RegExp(`${(i=f[h])===null||i===void 0?void 0:i.slice(x,y)}`).test(o[m]||"")){p=!1;break}continue}if(f[h]!==o[m]){p=!1;break}}p&&d.length>a&&(a=d.length,l=u)}return l}function zh(n){let e=n.indexOf("/");return n.slice(e)}var Cc=Ui;function Bi(n,e,t={}){return Cc(n,e,t)}function Rr(n,e){try{return n()}catch(t){throw new Error(`${e}: ${t}`,{cause:t})}}function te(n){if(typeof n!="object"||!n)return n;if(Array.isArray(n))return n.map(e=>te(e));for(let e of Object.keys(n)){let t=n[e],r=qh(e);r!==e&&delete n[e],n[r]=typeof n[r]=="object"?te(t):t}return n}function Re(n){if(typeof n!="object"||!n)return n;if(Array.isArray(n))return n.map(e=>Re(e));for(let e of Object.keys(n)){let t=n[e],r=Hh(e);r!==e&&delete n[e],n[r]=typeof n[r]=="object"?Re(t):t}return n}function qh(n){return n.toLowerCase().replace(/([_][a-z])/g,e=>e.toUpperCase().replace("_",""))}function Hh(n){return n.replace(/([A-Z])/g,e=>`_${e.toLowerCase()}`).replace(/^_/,"")}function Ec(n,e){return Vh(n),Wh(n,e),n}function Wh(n,e){var t;(t=Symbol.asyncDispose)!==null&&t!==void 0||(Symbol.asyncDispose=Symbol("Symbol.asyncDispose")),n[Symbol.asyncDispose]||(n[Symbol.asyncDispose]=()=>e())}function Vh(n){n[Symbol.asyncIterator]||(n[Symbol.asyncIterator]=()=>vc(n)),n.values||(n.values=()=>vc(n))}function vc(n){return Pt(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:r,done:s}=yield $(t.read());if(s)return yield $(void 0);yield yield $(r)}}finally{let r=t.cancel();t.releaseLock(),yield $(r)}})}async function Ac(n){let e=n.getReader(),t=[],r=0;try{for(;;){let{value:s,done:i}=await e.read();if(i)return new TextDecoder().decode(Kh(t,r));r+=s.length,t.push(s)}}finally{e.releaseLock()}}function Xh(n){return n.reduce((e,t)=>e+t.length,0)}function Kh(n,e){let t=e!=null?e:Xh(n),r=new Uint8Array(t);for(let s=0,i=0;s<n.length;s++){let o=n[s];r.set(o,i),i+=o.length}return r}async function Sc(n){let{body:e,status:t}=await n.asBrowserStream();if(t!=="200"&&e!==void 0){let r=await Ac(e);throw Rr(()=>JSON.parse(r).error,"Error parsing response body")}if(!e)throw new Error("No stream found in response. Did you enable the stream option?");return e}function Rc(n,e){let t=Yh(n,e);return Jh(t,e)}function Jh(n,e){return Tc(n),Gh(n,e),n}function Gh(n,e){var t;(t=Symbol.asyncDispose)!==null&&t!==void 0||(Symbol.asyncDispose=Symbol("Symbol.asyncDispose")),n[Symbol.asyncDispose]||(n[Symbol.asyncDispose]=()=>e())}function Tc(n){n[Symbol.asyncIterator]||(n[Symbol.asyncIterator]=()=>Pc(n)),n.values||(n.values=()=>Pc(n))}function Yh(n,e){return new ReadableStream({async pull(t){let{value:r,done:s}=await n.next();s?t.close():t.enqueue(r)},cancel:e})}function Ic(n){return Qh(n)?(Tc(n),{cancel:()=>n.cancel(),iterable:n}):{cancel:async()=>{n.socket.end()},iterable:n}}function Qh(n){return!!(n&&typeof n.getReader=="function"&&typeof n.tee=="function")}function Pc(n){return Pt(this,arguments,function*(){let t=n.getReader();try{for(;;){let{value:r,done:s}=yield $(t.read());if(s)return yield $(void 0);yield yield $(r)}}finally{let r=t.cancel();t.releaseLock(),yield $(r)}})}function $i(n){let{cancel:e,iterable:t}=Ic(n),r=tp(ep(t));return Rc(r,e)}function Zh(n,e){let t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function Fc(){return{data:void 0,event:"",id:"",retry:void 0}}function ep(n){return Pt(this,arguments,function*(){var t,r,s,i;let o,a=0,l=-1,c=!1;try{for(var u=!0,d=mi(n),f;f=yield $(d.next()),t=f.done,!t;u=!0){i=f.value,u=!1;let p=i;o===void 0?(o=p,a=0,l=-1):o=Zh(o,p);let h=o.length,m=0;for(;a<h;){c&&(o[a]===10&&(m=++a),c=!1);let x=-1;for(;a<h&&x===-1;++a)switch(o[a]){case 58:l===-1&&(l=a-m);break;case 13:c=!0,x=a;break;case 10:x=a;break}if(x===-1)break;yield yield $({line:o.subarray(m,x),fieldLen:l}),m=a,l=-1}m===h?o=void 0:m!==0&&(o=o.subarray(m),a-=m)}}catch(p){r={error:p}}finally{try{!u&&!t&&(s=d.return)&&(yield $(s.call(d)))}finally{if(r)throw r.error}}})}function tp(n){return Pt(this,arguments,function*(){var t,r,s,i;let o=Fc(),a=new TextDecoder;try{for(var l=!0,c=mi(n),u;u=yield $(c.next()),t=u.done,!t;l=!0){i=u.value,l=!1;let{line:d,fieldLen:f}=i;if(d.length===0&&o.data!==void 0)yield yield $(o),o=Fc();else if(f>0){let p=a.decode(d.subarray(0,f)),h=f+(d[f+1]===32?2:1),m=a.decode(d.subarray(h));switch(p){case"data":o.data=o.data?o.data+`
`+m:m;break;case"event":o.event=m;break;case"id":o.id=m;break;case"retry":{let x=parseInt(m,10);isNaN(x)||(o.retry=x);break}}}}}catch(d){r={error:d}}finally{try{!l&&!t&&(s=c.return)&&(yield $(s.call(c)))}finally{if(r)throw r.error}}})}async function ji(n,e){let t=await Sc(n),r=$i(t),s=new TransformStream({transform:async(i,o)=>{if(i.data==="[DONE]")return o.terminate(),r[Symbol.asyncDispose]();o.enqueue(e(Rr(()=>JSON.parse(i.data),"Error parsing an event. See 'cause' for more details")))}});return Ec(r.pipeThrough(s),()=>r.cancel())}function Oc({prompt_annotations:n,prompt_filter_results:e}){var t;let r=e!=null?e:n;return(t=r==null?void 0:r.map(s=>{var{content_filter_results:i}=s,o=L(s,["content_filter_results"]);return Object.assign(Object.assign({},te(o)),{contentFilterResults:np(i)})}))!==null&&t!==void 0?t:[]}function qi(n){let{created:e,choices:t,prompt_filter_results:r,prompt_annotations:s}=n,i=L(n,["created","choices","prompt_filter_results","prompt_annotations"]);return Object.assign(Object.assign({},te(i)),{created:new Date(e),promptFilterResults:Oc({prompt_filter_results:r,prompt_annotations:s}),choices:t.map(o=>{var{content_filter_results:a}=o,l=L(o,["content_filter_results"]);return Object.assign(Object.assign({},te(l)),a?{contentFilterResults:Dc(a)}:{})})})}function Hi(n){let{created:e,choices:t,prompt_filter_results:r,prompt_annotations:s}=n,i=L(n,["created","choices","prompt_filter_results","prompt_annotations"]);return Object.assign(Object.assign({},te(i)),{created:new Date(e),promptFilterResults:Oc({prompt_filter_results:r,prompt_annotations:s}),choices:t.map(o=>{var{content_filter_results:a,delta:l,message:c}=o,u=L(o,["content_filter_results","delta","message"]);return Object.assign(Object.assign(Object.assign(Object.assign({},te(u)),l?{delta:zi(l)}:{}),c?{message:zi(c)}:{}),a?{contentFilterResults:Dc(a)}:{})})})}function zi(n){let{context:e,tool_calls:t}=n,r=L(n,["context","tool_calls"]);return Object.assign(Object.assign(Object.assign({},te(r)),{toolCalls:t!=null?t:[]}),e?{context:Object.assign({},e.messages?{messages:e.messages.map(zi)}:{})}:{})}function Nc(n){var e;return{error:Object.assign(Object.assign({},n),{details:(e=n.details)!==null&&e!==void 0?e:[]})}}function np(n={}){var{error:e}=n,t=L(n,["error"]);return e?Nc(e):te(t)}function Dc(n={}){var{error:e}=n,t=L(n,["error"]);return e?Nc(e):te(t)}function kc(n,e,t,r={requestOptions:{}}){return n.path("/deployments/{deploymentId}/completions",e).post(Object.assign(Object.assign({},Pe(r)),{body:{prompt:t.prompt,max_tokens:t.maxTokens,temperature:t.temperature,top_p:t.topP,logit_bias:t.logitBias,user:t.user,n:t.n,logprobs:t.logprobs,echo:t.echo,stop:t.stop,presence_penalty:t.presencePenalty,frequency_penalty:t.frequencyPenalty,best_of:t.bestOf,stream:t.stream,model:t.model}}))}async function Wi(n,e,t,r={requestOptions:{}}){let{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a}=r,l=L(r,["abortSignal","onResponse","requestOptions","tracingOptions"]),c=await kc(n,e,Object.assign({prompt:t},l),{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a});return rp(c)}async function rp(n){if(Sn(n))throw n.body.error;return qi(n.body)}async function sp(n){if(Sn(n))throw n.body.error;return Hi(n.body)}function ip(n,e,t,r={requestOptions:{}}){return n.path("/deployments/{deploymentId}/images/generations",e).post(Object.assign(Object.assign({},Pe(r)),{body:{model:t.model,prompt:t.prompt,n:t.n,size:t.size,response_format:t.responseFormat,quality:t.quality,style:t.style,user:t.user}}))}async function op(n){if(Sn(n))throw n.body.error;return{created:new Date(n.body.created),data:n.body.data.map(e=>({url:e.url,base64Data:e.b64_json,revisedPrompt:e.revised_prompt}))}}function ap(n,e,t,r={requestOptions:{}}){return n.path("/deployments/{deploymentId}/embeddings",e).post(Object.assign(Object.assign({},Pe(r)),{body:{user:t.user,model:t.model,input:t.input}}))}async function lp(n){if(Sn(n))throw n.body.error;return{data:n.body.data.map(e=>({embedding:e.embedding,index:e.index})),usage:{promptTokens:n.body.usage.prompt_tokens,totalTokens:n.body.usage.total_tokens}}}async function Vi(n,e,t,r={requestOptions:{}}){let s=await ap(n,e,t,r);return lp(s)}function Xi(n,e,t,r={requestOptions:{}}){let{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a}=r,l=L(r,["abortSignal","onResponse","requestOptions","tracingOptions"]),c=kc(n,e,Object.assign(Object.assign({prompt:t},l),{stream:!0}),{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a});return ji(c,qi)}async function Ki(n,e,t,r={requestOptions:{}}){let{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a}=r,l=L(r,["abortSignal","onResponse","requestOptions","tracingOptions"]),c=await ip(n,e,Object.assign({prompt:t},l),{abortSignal:s,onResponse:i,requestOptions:o,tracingOptions:a});return op(c)}function Ji(n,e,t,r={requestOptions:{}}){let s=Lc(n,e,t,Object.assign(Object.assign({},r),{stream:!0}));return ji(s,Hi)}async function Gi(n,e,t,r={requestOptions:{}}){let s=await Lc(n,e,t,r);return sp(s)}async function Tr(n,e,t,r,s){let i=s!=null?s:typeof r=="string"?{}:r!=null?r:{},o=typeof r=="string"?r:void 0,{abortSignal:a,onResponse:l,requestOptions:c,tracingOptions:u}=i,d=L(i,["abortSignal","onResponse","requestOptions","tracingOptions"]),{body:f,status:p}=await n.pathUnchecked("deployments/{deploymentName}/audio/translations",e).post(Object.assign(Object.assign({},Pe({abortSignal:a,onResponse:l,tracingOptions:u,requestOptions:c})),{contentType:"multipart/form-data",body:Object.assign(Object.assign(Object.assign({},Re(d)),{file:Sr(t,"placeholder.wav")}),o?{response_format:o}:{})}));if(p!=="200")throw f.error;return o!=="verbose_json"?f:te(f)}async function Ir(n,e,t,r,s){let i=s!=null?s:typeof r=="string"?{}:r!=null?r:{},o=typeof r=="string"?r:void 0,{abortSignal:a,onResponse:l,requestOptions:c,tracingOptions:u}=i,d=L(i,["abortSignal","onResponse","requestOptions","tracingOptions"]),{body:f,status:p}=await n.pathUnchecked("deployments/{deploymentName}/audio/transcriptions",e).post(Object.assign(Object.assign({},Pe({abortSignal:a,onResponse:l,tracingOptions:u,requestOptions:c})),{contentType:"multipart/form-data",body:Object.assign(Object.assign(Object.assign({},Re(d)),{file:Sr(t,"placeholder.wav")}),o?{response_format:o}:{})}));if(p!=="200")throw f.error;return o!=="verbose_json"?f:te(f)}function Lc(n,e,t,r={requestOptions:{}}){let{azureExtensionOptions:s,abortSignal:i,onResponse:o,requestOptions:a,tracingOptions:l}=r,c=L(r,["azureExtensionOptions","abortSignal","onResponse","requestOptions","tracingOptions"]),u={abortSignal:i,onResponse:o,requestOptions:a,tracingOptions:l},d=Object.assign(Object.assign({},s!=null&&s.extensions?{dataSources:s.extensions}:{}),s!=null&&s.enhancements?{enhancements:s.enhancements}:{});return d.dataSources||d.enhancements?cp(n,e,Object.assign(Object.assign({messages:t},c),d),u):up(n,e,Object.assign({messages:t},c),u)}function cp(n,e,t,r={requestOptions:{}}){let{functions:s,functionCall:i,messages:o,dataSources:a}=t,l=L(t,["functions","functionCall","messages","dataSources"]);return n.path("/deployments/{deploymentId}/extensions/chat/completions",e).post(Object.assign(Object.assign({},Pe(r)),{body:Object.assign(Object.assign({},Re(l)),{dataSources:a==null?void 0:a.map(c=>{var{type:u}=c,d=L(c,["type"]);return{type:u,parameters:d}}),functions:s,function_call:i,messages:o.map(Mc)})}))}function Mc(n){switch(n.content===void 0&&(n.content=null),n.role){case"assistant":{let{functionCall:e,toolCalls:t}=n,r=L(n,["functionCall","toolCalls"]);return Object.assign(Object.assign(Object.assign({},Re(r)),!t||t.length===0?{}:{tool_calls:t}),e?{function_call:e}:{})}default:return Re(n)}}function up(n,e,t,r={requestOptions:{}}){let{functions:s,functionCall:i,messages:o}=t,a=L(t,["functions","functionCall","messages"]);return n.path("/deployments/{deploymentId}/chat/completions",e).post(Object.assign(Object.assign({},Pe(r)),{body:Object.assign(Object.assign({},Re(a)),{functions:s,function_call:i,messages:o.map(Mc)})}))}function Uc(){return{name:"openAiEndpoint",sendRequest:(e,t)=>{let r=new URL(e.url),s=r.pathname.split("/");switch(s[s.length-1]){case"completions":s[s.length-2]==="chat"?r.pathname=`${s[1]}/chat/completions`:r.pathname=`${s[1]}/completions`;break;case"embeddings":r.pathname=`${s[1]}/embeddings`;break;case"generations":if(s[s.length-2]==="images")r.pathname=`${s[1]}/images/generations`;else throw new Error("Unexpected path");break;case"transcriptions":r.pathname=`${s[1]}/audio/transcriptions`;break;case"translations":r.pathname=`${s[1]}/audio/translations`;break}return r.searchParams.delete("api-version"),e.url=r.toString(),t(e)}}}var Pn=class{constructor(e,t={},r={}){var s,i;this._isAzure=!1;let o,a,l;if(fp(t))a=e,l=t,o=r,this._isAzure=!0;else{a=dp(1),l=e;let{credentials:c}=t,u=L(t,["credentials"]);o=Object.assign({credentials:{apiKeyHeaderName:(s=c==null?void 0:c.apiKeyHeaderName)!==null&&s!==void 0?s:"Authorization",scopes:c==null?void 0:c.scopes}},u)}this._client=Bi(a,l,Object.assign(Object.assign({},o),this._isAzure?{}:{additionalPolicies:[...(i=o.additionalPolicies)!==null&&i!==void 0?i:[],{position:"perCall",policy:Uc()}]}))}getCompletions(e,t,r={requestOptions:{}}){return this.setModel(e,r),Wi(this._client,e,t,r)}streamCompletions(e,t,r={}){return this.setModel(e,r),Xi(this._client,e,t,r)}getEmbeddings(e,t,r={requestOptions:{}}){return this.setModel(e,r),Vi(this._client,e,Object.assign({input:t},r),r)}getChatCompletions(e,t,r={requestOptions:{}}){return this.setModel(e,r),Gi(this._client,e,t,r)}streamChatCompletions(e,t,r={requestOptions:{}}){return this.setModel(e,r),Ji(this._client,e,t,r)}getImages(e,t,r={requestOptions:{}}){return this.setModel(e,r),Ki(this._client,e,t,r)}async getAudioTranscription(e,t,r,s){let i=s!=null?s:typeof r=="string"?{}:r!=null?r:{},o=typeof r=="string"?r:void 0;return this.setModel(e,i),o===void 0?Ir(this._client,e,t,i):Ir(this._client,e,t,o,i)}async getAudioTranslation(e,t,r,s){let i=s!=null?s:typeof r=="string"?{}:r!=null?r:{},o=typeof r=="string"?r:void 0;return this.setModel(e,i),o===void 0?Tr(this._client,e,t,i):Tr(this._client,e,t,o,i)}setModel(e,t){this._isAzure||(t.model=e)}};function dp(n){return`https://api.openai.com/v${n}`}function fp(n){return St(n)||n.key!==void 0}function Bc(n){var r,s,i,o,a;let e=[];if(n.system){let l={role:"system",content:n.system||""};e.push(l)}if((r=n.user)!=null&&r.user_prompt){let l={role:"user",content:((s=n.user)==null?void 0:s.user_prompt)||""};e.push(l)}if((i=n.user)!=null&&i.additional_context)for(let[l,c]of Object.entries((o=n.user)==null?void 0:o.additional_context)){let u={role:"user",content:`additional_context -${l}: ${c}
`};e.push(u)}let t={role:"user",content:((a=n.user)==null?void 0:a.input)||""};return e.push(t),e}async function $c(n,e,t,r,s){var l;let i=new Pn(t,new Gt(n)),o=Bc(r);return(l=(await i.getChatCompletions(e,o,s)).choices[0].message)==null?void 0:l.content}async function jc(n,e,t,r){let s=new B({apiKey:n,dangerouslyAllowBrowser:!0}),i=Bc(t);return(await s.chat.completions.create({model:e,messages:i,...r})).choices[0].message.content}var ye=require("obsidian"),Rn="flow-view",Fr=class extends ye.ItemView{constructor(e,t){super(e),this.plugin=t}getViewType(){return Rn}getIcon(){return"workflow"}getDisplayText(){return"Cloud Atlas flows view"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.createEl("h4",{text:"Cloud Atlas flows"});let t=this.app.vault.getMarkdownFiles();console.debug(`Found ${t.length} vault files`);let r=t.filter(i=>i.path.startsWith("CloudAtlas/")&&i.path.endsWith(".flow.md")).map(i=>i.path.split("/")[1].split(".flow.md")[0]).sort();console.debug(`Found ${r.length} CloudAtlas flows`);let s=e.createEl("ul");r.forEach(i=>{let o=s.createEl("table");o.addClass("cloud-atlas-flow-table");let a=o.createEl("tr"),l=a.createEl("td"),c=l.createEl("button",{text:"Run"});(0,ye.setIcon)(c,"play"),c.addClass("cloud-atlas-flow-btn-primary"),c.addEventListener("click",async()=>{await this.plugin.runFlow(null,i)});let u=l.createEl("button",{text:"Upload"});(0,ye.setIcon)(u,"upload"),u.addClass("cloud-atlas-flow-btn-primary"),u.addEventListener("click",async()=>{await this.plugin.uploadFlow(i)});let d=l.createEl("button",{text:"Deploy"});(0,ye.setIcon)(d,"cloud-cog"),d.addClass("cloud-atlas-flow-btn-primary"),d.addEventListener("click",async()=>{(0,ye.setIcon)(d,"cog"),d.addClass("rotate");let p=await this.plugin.deployFlow(i);d.removeClass("rotate"),(0,ye.setIcon)(d,"cloud-cog"),new ye.Notice(`Flow has been deployed to ${p}, it should be available in a few minutes`)});let f=a.createEl("td");f.addClass("cloud-atlas-flow-td-half"),f.createEl("span",{text:i})})}async onClose(){}};var re=require("obsidian"),zc=Lr(ks()),Tn="interactive-panel",qc,Hc=n=>{let e=n.noticeEl.innerText,t=[...e].filter(r=>r===".").length;t==0?e=e.replace("    "," .  "):t==1?e=e.replace(" .  "," .. "):t==2?e=e.replace(" .. "," ..."):t==3&&(e=e.replace(" ...","    ")),n.setMessage(e),qc=setTimeout(()=>Hc(n),500)},Or=class extends re.ItemView{constructor(e,t){super(e),this.plugin=t,this.settings=this.plugin.settings,this.attachedFiles=new Set}setLoading(e){e?this.loadingIndicator.style.display="block":this.loadingIndicator.style.display="none"}getViewType(){return Tn}getIcon(){return"cloud-cog"}getDisplayText(){return"Cloud Atlas Interactive Mode"}createUserPromptTextbox(){let e=document.createElement("textarea");return e.placeholder="Enter your prompt here...",e.classList.add("ca-interactive-prompt-textbox"),this.containerEl.appendChild(e),e}createAttachedFilesList(){let e=this.containerEl.createDiv({cls:"attached-notes-list"}),t=e.createEl("h4",{text:"Attached Notes"});t.style.marginBottom="1em";let r=e.createEl("ul");return r.style.height="200px",r.style.overflowY="auto",r}updateAttachedFilesList(e){e.empty(),this.attachedFiles.size===0?e.createEl("li",{text:"No notes attached."}):this.attachedFiles.forEach(t=>{e.createEl("li",{text:t}).createEl("button",{text:"Remove",cls:"remove-button"}).onClickEvent(()=>{this.attachedFiles.delete(t),this.updateAttachedFilesList(e)})})}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.createEl("h4",{text:"Cloud Atlas Interactive Mode"});let t=this.createUserPromptTextbox();e.appendChild(t);let r=e.createEl("button",{cls:"ca-attach-note-button",text:"+"});e.createDiv();let s=e.createEl("button",{cls:"send-button",text:"Send to LLM"}),i=this.createAttachedFilesList();this.updateAttachedFilesList(i);let o=e.createEl("h4",{text:"Response"});this.copyButton=e.createEl("button",{text:"Copy to Clipboard",cls:"ca-a-interactive-copy-button"}),this.copyButton.hide(),o.insertAdjacentElement("afterend",this.copyButton),this.copyButton.onClickEvent(()=>{this.responseCode&&navigator.clipboard.writeText(this.responseCode.innerText).then(()=>{new re.Notice("Response copied to clipboard.")},a=>{console.error("Could not copy text: ",a),new re.Notice("Failed to copy response to clipboard.")})}),this.responseContainer=e.createDiv({cls:"response-container"}),this.responsePre=this.responseContainer.createEl("pre",{cls:"ca-scrollable-response"}),this.responseCode=this.responsePre.createEl("code"),this.responseCode.addClass("ca-response-code"),this.loadingIndicator=e.createDiv({cls:"loading-indicator"}),(0,re.setIcon)(this.loadingIndicator,"sync"),this.loadingIndicator.setText(" Waiting for response"),this.setLoading(!1),s.onClickEvent(async()=>{if(t.value.trim()===""){new re.Notice("Please enter a prompt before sending.");return}await this.handleSendClick(t.value)}),r.onClickEvent(()=>{let a=this.app.workspace.getActiveFile();a?(this.attachedFiles.add(a.path),new re.Notice(`Attached file: ${a.path}`),this.updateAttachedFilesList(i)):new re.Notice("No file is currently open.")})}async handleSendClick(e){let t={user:{user_prompt:e,input:"See Additional Context and Respond to Prompt",additional_context:{}},system:null,options:{generate_embeddings:this.settings.generateEmbeddings,entity_recognition:this.settings.entityRecognition,wikify:this.settings.wikify},provider:this.settings.useOpenAi?"openai":"azureai",llmOptions:{temperature:this.settings.llmOptions.temperature,max_tokens:this.settings.llmOptions.max_tokens},requestId:new zc.default({length:10}).rnd()};t.user.additional_context||(t.user.additional_context={});for(let s of this.attachedFiles){let i=await this.plugin.readAndFilterContent(s,[]);i!==null&&(t.user.additional_context[s]=i)}this.setLoading(!0);let r=new re.Notice("Running Interactive flow ...",0);Hc(r);try{let s=await this.plugin.caApiFetch(t);this.setLoading(!1),r.hide(),clearTimeout(qc),this.renderResponse(s),this.copyButton.show()}catch(s){this.setLoading(!1),r.hide(),console.error("Failed to fetch response from Cloud Atlas:",s),new re.Notice("Failed to send payload to Cloud Atlas. Check the console for more details.")}}renderResponse(e){this.responseCode.setText(e)}async onClose(){}};var Yi,Qi=n=>{let e=n.noticeEl.innerText,t=[...e].filter(r=>r===".").length;t==0?e=e.replace("    "," .  "):t==1?e=e.replace(" .  "," .. "):t==2?e=e.replace(" .. "," ..."):t==3&&(e=e.replace(" ...","    ")),n.setMessage(e),Yi=setTimeout(()=>Qi(n),500)},Dr=class extends N.Plugin{constructor(){super(...arguments);this.getFlowFilePath=t=>(0,N.normalizePath)(`CloudAtlas/${t}.flow.md`);this.getFlowdataFilePath=t=>(0,N.normalizePath)(`CloudAtlas/${t}.flowdata.md`);this.collectInputsIntoPayload=async(t,r,s)=>{let i=this.getFlowFilePath(s),o=this.getFlowdataFilePath(s),a=[i,o,r.path];return await this.combineFlows(a,t)};this.combineFlows=async(t,r)=>{let s=[...new Set(t)],i={payload:{user:{input:r,user_prompt:null},system:null,options:{generate_embeddings:this.settings.generateEmbeddings,entity_recognition:this.settings.entityRecognition,wikify:this.settings.wikify},provider:this.settings.useOpenAi?"openai":"azureai",llmOptions:{temperature:this.settings.llmOptions.temperature,max_tokens:this.settings.llmOptions.max_tokens},requestId:new Nr.default({length:10}).rnd()},config:{userPrompt:null,system_instructions:null,mode:null,resolveBacklinks:!0,resolveForwardLinks:!0,exclusionPatterns:[],frontMatterOffset:0,llmOptions:{temperature:this.settings.llmOptions.temperature,max_tokens:this.settings.llmOptions.max_tokens},additional_context:{}}},o={selectionInput:r,is_prompt:!0},a=s.length-1,l=0;for(let c of s){l==a&&(o.is_prompt=!1);let{payload:u,config:d}=await this.pathToPayload(c,i,o);u&&(i.payload=Oa(i.payload,u),i.config=d),l++}return i.payload};this.pathToPayload=async(t,r,s)=>{let i=r.config,o=r.payload;try{let a=await this.flowConfigFromPath(t),l=he(t,this.app);i&&((a==null?void 0:a.resolveForwardLinks)===void 0&&(a.resolveForwardLinks=i.resolveForwardLinks),(a==null?void 0:a.resolveBacklinks)===void 0&&(a.resolveBacklinks=i.resolveBacklinks));let c=await this.app.vault.read(l);c=c.substring(a.frontMatterOffset).trim();let u,d;s!=null&&s.is_prompt?d=Qn(a.userPrompt,c):(d=a.userPrompt,u=s!=null&&s.selectionInput?s==null?void 0:s.selectionInput:c),u=u||null;let f={user_prompt:d,input:u,additional_context:{}},p=this.parseExclusionPatterns(a==null?void 0:a.exclusionPatterns)||[],h=a.additional_context||{};if(a.resolveForwardLinks){let x=await this.resolveLinksForPath(t,p);Object.assign(h,x)}if(a.resolveBacklinks){let x=await this.resolveBacklinksForPath(t,p);Object.assign(h,x)}return f.additional_context=h,{payload:{user:f,system:a.system_instructions,options:{entity_recognition:o.options.entity_recognition,generate_embeddings:o.options.generate_embeddings,wikify:o.options.wikify},provider:o.provider,llmOptions:{temperature:Number(a.llmOptions.temperature)||o.llmOptions.temperature,max_tokens:Number(a.llmOptions.max_tokens)||o.llmOptions.max_tokens},requestId:o.requestId},config:a}}catch(a){return console.debug(a),{payload:o,config:i}}};this.flowConfigFromPath=async t=>{var o,a,l,c,u,d,f,p,h,m,x,y;let r=this.app.metadataCache.getFileCache(he(t,this.app)),s={};if(r!=null&&r.frontmatter){let _=(r==null?void 0:r.frontmatter)["ca-url"];_&&_.map(b=>{s[b]=b}),console.debug(s)}let i={};return(o=r==null?void 0:r.frontmatter)!=null&&o.temperature&&(i.temperature=(a=r==null?void 0:r.frontmatter)==null?void 0:a.temperature),(l=r==null?void 0:r.frontmatter)!=null&&l.max_tokens&&(i.max_tokens=(c=r==null?void 0:r.frontmatter)==null?void 0:c.max_tokens),{userPrompt:(u=r==null?void 0:r.frontmatter)==null?void 0:u.userPrompt,system_instructions:(d=r==null?void 0:r.frontmatter)==null?void 0:d.system_instructions,mode:(f=r==null?void 0:r.frontmatter)==null?void 0:f.mode,resolveBacklinks:(p=r==null?void 0:r.frontmatter)==null?void 0:p.resolveBacklinks,resolveForwardLinks:(h=r==null?void 0:r.frontmatter)==null?void 0:h.resolveForwardLinks,exclusionPatterns:((m=r==null?void 0:r.frontmatter)==null?void 0:m.exclusionPatterns)||[],frontMatterOffset:((y=(x=r==null?void 0:r.frontmatterPosition)==null?void 0:x.end)==null?void 0:y.offset)||0,llmOptions:i,additional_context:s}};this.parseExclusionPatterns=t=>t.map(r=>new RegExp(r));this.flowToResponse=async(t,r)=>{let s=await this.collectInputsIntoPayload(null,t,r);if(!s)throw new Error("Could not construct payload!");return await this.apiFetch(s)};this.deployFlow=async t=>{await this.uploadFlow(t);let r=this.apiUrl(),i=await(await fetch(`${r}/deploy`,{headers:{"x-api-key":this.settings.apiKey,"Content-Type":"application/json"},method:"POST",body:JSON.stringify({flow:t})})).text();return await this.createFolder("CloudAtlas/deploy-info"),await this.app.vault.create(`CloudAtlas/deploy-info/${t}.flowdeploy.md`,JSON.stringify({project_url:i})),i};this.uploadFlow=async t=>{let r=this.getFlowFilePath(t),s=this.getFlowdataFilePath(t),i=[r,s].filter(Boolean),o=await this.combineFlows(i,null);if(console.log(o),o){let a=await Ba(this.settings.apiKey,t,o);console.debug("Payload insert: ",a.status)}};this.runFlow=async(t,r)=>{console.log("Running flow: ",r);let s=this.app.workspace.getActiveFile();if(!s)return console.debug("No active file"),new N.Notice("No active file in the editor, open one and try again."),null;let i=t==null?void 0:t.getSelection(),o=!!i;if(t)if(o)t.replaceSelection(i+`

---

`+fn+`

---
`);else{let l=t.getCursor(),c=`
---

`+fn+`

---
`;t.replaceRange(c,l)}else{let c=await this.app.vault.read(s)+`
---
`+fn+`

---
`;await this.app.vault.modify(s,c)}let a=new N.Notice(`Running ${r} flow ...`,0);Qi(a);try{let l=await this.flowToResponse(s,r),u=(await this.app.vault.read(s)).replace(fn,l);this.app.vault.modify(s,u)}catch(l){console.error(l),a.hide(),new N.Notice("Something went wrong. Check the console.")}a.hide(),clearTimeout(Yi)};this.readNote=async t=>await this.app.vault.read(he(t,this.app));this.readAndFilterContent=async(t,r)=>{if(r.some(s=>s.test(t)))return"";try{if(Na(t)){let s=t.split("."),i=s[s.length-3];return console.log(i),await this.flowToResponse(he(t,this.app),i)}if(Da(t))return await this.canvasOps(he(t,this.app));if(Is(t))return await Ts(t);if(ka(t)){let s=this.app.vault.adapter,i=null;if(s instanceof N.FileSystemAdapter&&(i=s.getBasePath()),i==null)throw new Error("Could not get vault base path");return await Ma(i,t)}return La(t)?Ua(t):await this.readNote(t)}catch(s){return console.error(s),""}};this.resolveBacklinksForPath=async(t,r)=>{let s={},i=he(t,this.app),o=Fa(i,this.app),a=Array.from((await o).keys()).map(async l=>{let c=await this.readAndFilterContent(l,r);c&&(s[l]=c)});return await Promise.all(a),s};this.resolveLinksForPath=async(t,r)=>{let s={},i=await this.app.metadataCache.resolvedLinks[t],o=Object.keys(i).map(async a=>{var u;let l=await this.readAndFilterContent(a,r);l&&(s[a]=l);let c=this.app.metadataCache.getFileCache(he(a,this.app));if((u=c==null?void 0:c.frontmatter)!=null&&u.recurseLinks){console.debug("Recursing links for: ",a);let d=await this.resolveLinksForPath(a,r);Object.assign(s,d)}});return await Promise.all(o),s};this.fetchResponse=async t=>await(await fetch(`https://${Yn}/rest/v1/atlas_responses?request_id=eq.${t}&select=response`,{headers:{apikey:kt,Authorization:`Bearer ${kt}`,"Content-Type":"application/json","x-api-key":this.settings.apiKey},method:"GET"})).json();this.executeCanvasFlow=async(t,r)=>{let s=await this.apiFetch(t),i=await this.getCanvasContent(r);if(!i)return null;let o=Os(i.nodes),a=i,l=Lt(s,o[0].x+o[0].width+100,o[0].y);return a==null||a.edges.push({id:Te(),fromNode:o[0].id,fromSide:"right",toNode:l.id,toSide:"left"}),a==null||a.nodes.push(l),this.app.vault.modify(r,JSON.stringify(a)),s};this.apiFetch=async t=>this.settings.openAiSettings.apiKey&&this.settings.provider==="openai"?await jc(this.settings.openAiSettings.apiKey,this.settings.openAiSettings.modelId,t,this.settings.llmOptions)||"":this.settings.azureAiSettings.apiKey&&this.settings.provider==="azureai"?await $c(this.settings.azureAiSettings.apiKey,this.settings.azureAiSettings.deploymentId,this.settings.azureAiSettings.endpoint,t,this.settings.llmOptions)||"":this.settings.provider==="cloudatlas"&&this.settings.apiKey?await this.caApiFetch(t):(new N.Notice("No LLM service selected, please chose one in settings"),"");this.apiUrl=()=>{let t=this.settings.previewMode?"https://dev-api.cloud-atlas.ai":"https://api.cloud-atlas.ai";return this.settings.developmentMode?"http://localhost:8787":t};this.caApiFetch=async t=>{t.version="V2",console.debug(t);let r=`${this.apiUrl()}/run`,s=await fetch(r,{headers:{"x-api-key":this.settings.apiKey,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)});if(s.status!=200)throw console.error(s),new Error("API request failed");{let i=await this.fetchResponse(t.requestId),o=0,a=5e3,u=this.settings.timeoutMins*60*1e3/a;for(;i.length==0;)if(o++,console.debug(`Waiting for response... ${o}/${u}`),await sleep(a),i=await this.fetchResponse(t.requestId),o>u)throw new Error("Timeout out waiting for results");return i[0].response}};this.getNodeContent=async t=>(console.log("Getting node content: ",t),t.type=="text"?this.getTextNodeContent(t):t.type=="file"?await this.getFileNodeContent(t):null);this.getTextNodeContent=t=>t.text;this.getFileNodeContent=async t=>await this.readAndFilterContent(t.file,[]);this.createFlow=async t=>{await this.create(`CloudAtlas/${t}.flow.canvas`,JSON.stringify(Ra))};this.createFolder=async t=>{try{await this.app.vault.createFolder(t)}catch(r){console.debug(r)}};this.create=async(t,r)=>{try{await this.app.vault.create(t,r)}catch(s){console.debug(s)}};this.canvasOps=async t=>{let r=await this.runCanvasFlow(t);if(!r)return null;let s=Object.keys(r.payload.user.additional_context).filter(l=>l.endsWith(".index.md")),i=[];if(s.length==1){let l=s[0],c=await this.resolveLinksForPath(l,[]);for(let[u,d]of Object.entries(c)){let f=JSON.parse(JSON.stringify(r.payload));f.user.additional_context[u]=d,f.requestId=new Nr.default({length:10}).rnd(),delete f.user.additional_context[l],i.push(f)}}i.length==0&&i.push(r.payload);let o=new N.Notice("Running Canvas flow ...",0);Qi(o);let a=[];for(;i.length;){let c=i.splice(0,3).map(async u=>{try{let d=await this.executeCanvasFlow(u,t);d&&a.push(d),a.push()}catch(d){console.error(d),o.hide(),new N.Notice("Something went wrong. Check the console.")}});await Promise.all(c)}return o.hide(),clearTimeout(Yi),a.join(`
`)};this.getCanvasContent=async t=>{let r=await this.app.vault.read(t);return JSON.parse(r)};this.runCanvasFlow=async t=>{let r=await this.getCanvasContent(t),s=Os(r.nodes);if(s){if(s.length>1){new N.Notice("Found multiple Input(Red) nodes, only one is allowed.");return}}else{new N.Notice("Could not find Input(Red) node.");return}let i=s[0],o=await this.getNodeContent(i),a=[];for(let f of hn(3,r.nodes)){let p=await this.getNodeContent(f);p&&a.push(p)}let l=[];for(let f of hn(1,r.nodes)){let p=await this.getNodeContent(f);p&&l.push(p)}l.push(Sa);let c={},u=hn(2,r.nodes).map(async f=>{var h;let p=await this.getNodeContent(f);if(p){let m=Fs(f)?f.file:f.id;c[m]=p}if(Fs(f)){let m=this.app.metadataCache.getFileCache(he(f.file,this.app));if((h=m==null?void 0:m.frontmatter)!=null&&h.recurseLinks){console.debug("Recursing links for: ",f.file);let x=await this.resolveLinksForPath(f.file,[]);Object.assign(c,x)}}});if(await Promise.all(u),i.file){if(this.settings.canvasResolveLinks){let f=await this.resolveLinksForPath(i.file,[]);Object.assign(c,f)}if(this.settings.canvasResolveBacklinks){let f=await this.resolveBacklinksForPath(i.file,[]);Object.assign(c,f)}}return{payload:{user:{user_prompt:a.join(`
`),input:o||"",additional_context:c},system:l.join(`
`),options:{entity_recognition:this.settings.entityRecognition,generate_embeddings:this.settings.generateEmbeddings,wikify:this.settings.wikify},provider:this.settings.useOpenAi?"openai":"azureai",llmOptions:{temperature:this.settings.llmOptions.temperature,max_tokens:this.settings.llmOptions.max_tokens},requestId:new Nr.default({length:10}).rnd()},canvas:r}};this.editorExtension=[];this.addFlowCommands=()=>{console.debug("Registered flows: ",this.settings.registeredFlows),this.settings.registeredFlows.forEach(t=>{this.addNewCommand(this,t)})}}updateEditorExtension(){this.editorExtension.length=0;let t=this.createEditorExtension();this.editorExtension.push(t),this.app.workspace.updateOptions()}createEditorExtension(){let t=this.app;return Wc.ViewPlugin.fromClass(class{constructor(r){this.updateHeader(r,t)}update(r){this.updateHeader(r.view,t)}updateHeader(r,s){let i=s.workspace.getActiveViewOfType(N.MarkdownView);if(i&&i.file){let o=i.file.path;o.endsWith(".flow.md")?r.dom.classList.add("cloud-atlas-flow-file"):o.endsWith(".flowdata.md")?r.dom.classList.add("cloud-atlas-flowdata-file"):o.endsWith(".flowrun.md")?r.dom.classList.add("cloud-atlas-flowrun-file"):o.endsWith(".flowdeploy.md")?r.dom.classList.add("cloud-atlas-flowdeploy-file"):r.dom.classList.remove("cloud-atlas-flow-file","cloud-atlas-flowdata-file")}}})}async activateView(t){let{workspace:r}=this.app,s=null,i=r.getLeavesOfType(Rn);i.length>0?(s=i[0],t&&r.revealLeaf(s)):(s=r.getRightLeaf(!1),await(s==null?void 0:s.setViewState({type:Rn,active:!0})))}async activateInteractivePanel(t){let{workspace:r}=this.app,s=null,i=r.getLeavesOfType(Tn);i.length>0?(s=i[0],t&&r.revealLeaf(s)):(s=r.getRightLeaf(!1),await(s==null?void 0:s.setViewState({type:Tn,active:!0})))}async onload(){console.debug("Entering onLoad"),this.addRibbonIcon("workflow","Cloud Atlas flows",()=>{try{this.activateView(!0)}catch(t){console.debug(t)}}),this.addRibbonIcon("cloud-cog","Cloud Atlas panel",()=>{try{this.activateInteractivePanel(!0)}catch(t){console.debug(t)}}),await this.loadSettings(),console.debug("Loaded settings");try{this.registerEditorExtension(this.editorExtension),this.updateEditorExtension(),this.app.workspace.onLayoutReady(()=>{this.updateFlowCanvasClass(this.app.workspace.getActiveFile())}),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{let r=(t==null?void 0:t.view)instanceof N.FileView?t.view:null,s=r?r.file:null;(s==null?void 0:s.extension)==="canvas"&&this.updateFlowCanvasClass(s)})),await this.createFolder("CloudAtlas"),await this.create("CloudAtlas/example.flow.md",Rs),new N.Notice("Created CloudAtlas folder with an example flow. Please configure the plugin to use it.")}catch(t){console.debug("Could not create folder, it likely already exists")}console.debug("Bootstraped CloudAtlas folder"),this.addCommand({id:"create-flow",name:"Create new flow",callback:async()=>{let t=Ha();this.app.vault.create(`CloudAtlas/${t}.flow.md`,Rs),this.app.vault.create(`CloudAtlas/${t}.flowdata.md`,"")}}),this.addFlowCommands(),this.activateView(!1),this.addCommand({id:"run-canvas-flow",name:"Run Canvas flow",checkCallback:t=>{let r=this.app.workspace.getActiveFile();if(r&&r.path.endsWith(".canvas"))return t||this.canvasOps(r).then(()=>{}),!0}}),this.registerView(Rn,t=>new Fr(t,this)),this.registerView(Tn,t=>new Or(t,this)),this.addSettingTab(new Zn(this.app,this))}updateFlowCanvasClass(t){var s;let r=(s=this.app.workspace.getActiveViewOfType(N.ItemView))==null?void 0:s.getViewType();activeDocument.body.classList.remove("cloud-atlas-flow-canvas"),t&&t.extension==="canvas"&&r==="canvas"&&t.name.endsWith(".flow.canvas")&&activeDocument.body.addClass("cloud-atlas-flow-canvas")}addNewCommand(t,r){console.debug("Adding command for flow: ",r),this.addCommand({id:`run-flow-${r}`,name:`Run ${r} flow`,editorCallback:async(s,i)=>{await this.runFlow(s,r)}}),this.addCommand({id:`compile-flow-${r}`,name:`Compile ${r} flow`,editorCallback:async(s,i)=>{let o=s.getSelection(),a=this.app.workspace.getActiveFile();if(!a)return null;let l=await this.collectInputsIntoPayload(o,a,r);if(!l)throw new Error("Could not construct payload!");let c=$a(l),u=`CloudAtlas/${r}.flow.canvas`,d=await he(u,this.app);d?this.app.vault.modify(d,JSON.stringify(c)):this.app.vault.create(`CloudAtlas/${r}.flow.canvas`,JSON.stringify(c))}})}onunload(){}async loadSettings(){this.settings=Object.assign({},Pa,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

xmlchars/xml/1.0/ed5.js:
  (**
   * Character classes and associated utilities for the 5th edition of XML 1.0.
   *
   * @author Louis-Dominique Dubeau
   * @license MIT
   * @copyright Louis-Dominique Dubeau
   *)

xmlchars/xml/1.1/ed2.js:
  (**
   * Character classes and associated utilities for the 2nd edition of XML 1.1.
   *
   * @author Louis-Dominique Dubeau
   * @license MIT
   * @copyright Louis-Dominique Dubeau
   *)

xmlchars/xmlns/1.0/ed3.js:
  (**
   * Character class utilities for XML NS 1.0 edition 3.
   *
   * @author Louis-Dominique Dubeau
   * @license MIT
   * @copyright Louis-Dominique Dubeau
   *)
*/

/* nosourcemap */